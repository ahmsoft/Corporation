(function(){Type.registerNamespace("Telerik.Web.UI");
var b=Telerik.Web.UI,a=$telerik.$,c=b.TreeList;
Telerik.Web.UI.TreeListMobileColumnsView=function(d){b.TreeListMobileColumnsView.initializeBase(this,[d]);
this._indexes=[];
this._uniqueNames=[];
this._changes=null;
this._dropValue=null;
this._$columns=null;
};
b.TreeListMobileColumnsView.prototype={initialize:function(){b.TreeListMobileColumnsView.callBaseMethod(this,"initialize");
},dispose:function(){b.TreeListMobileColumnsView.callBaseMethod(this,"dispose");
},onInit:function(){this._initDragDrop();
},onShown:function(){this._changes=[];
this._$clone=this.get_$element().children().clone();
this._$columns=this.get_$element().find(".rtlColumnItem");
this._initPositions();
},onApplyChanges:function(){var d=this.get_owner();
this._changes.forEach(function(e){d.reorderColumns(this._uniqueNames[e[0]],this._uniqueNames[e[1]]);
this._updateMetadata();
},this);
if(d._clientSettings._allowColumnHide){this._$columns.each(function(){var e=a(this);
var g=e.data("columnIndex");
var f=e.find("input").prop("checked");
if(f){d.showColumn(g);
}else{d.hideColumn(g);
}});
}},onCancelChanges:function(){this.get_$element().html(this._$clone);
this._changes=[];
},_initDragDrop:function(){this._draggable=new c.Draggable({container:this.get_element(),thisArg:this,canDrag:function(d){if(a(d.target).hasClass("rtlDrag")){return true;
}},createDraggable:function(g){var f=a(g.target).parent();
var d=f.clone();
f.css("visibility","hidden");
return a("<div>").data("owner",f).addClass(a(this.get_owner().get_element()).attr("class")).addClass("RadTreeList_Drag").width(f[0].offsetWidth).append(d);
},createDropClue:function(){return a("<div>").addClass(a(this.get_owner().get_element()).attr("class")).addClass("RadTreeList_Drag").append(a("<span>").addClass("rtlDragClue"));
},dragging:function(h,g){var d=g.$dropClue;
var i=this._findClosest($telerik.getEventLocation(h).pageY);
var f=g.$dragElement.data("owner");
if(f.is(i.$element)||(f.next().is(i.$element)&&!i.isBottom)){d.hide();
this._dropValue=null;
}else{d.show().offset({top:i.position,left:this.get_$element().find(".rtlColumnItem").offset().left});
this._dropValue=i;
}},stopDragging:function(j,h){var f=h.$dragElement.data("owner").css("visibility","visible");
var g;
var d;
var i=this._dropValue;
if(i){d=g=i.$element;
if(d.data("index")>f.data("index")){g=d.prev().is("label")&&!i.isBottom?d.prev():d;
}this._changes.push([f.data("index"),g.data("index")]);
if(i.isBottom){d.after(f);
}else{d.before(f);
}this.changed();
}this._dropValue=null;
this._initPositions();
}});
},_updateMetadata:function(){var e=this.get_owner();
var d=e.get_columns();
this._uniqueNames=[];
this._indexes=[];
d.forEach(function(f,g){if(f._data.ColumnType!="TreeListDragDropColumn"){this._indexes.push(g);
this._uniqueNames.push(f.get_uniqueName());
}},this);
},_initPositions:function(){this._updateMetadata();
var f=this._dragData=[];
var d=this.get_$element().find(".rtlColumnItem");
var e=d.last();
var g=this._indexes;
d.each(function(i){var h=a(this);
var j=h.offset().top;
f.push({position:j,$element:h.data("columnIndex",g[i]).data("index",i)});
});
f.push({position:e.offset().top+e.outerHeight(),$element:e.data("columnIndex",g[g.length-1]).data("index",g.length-1),isBottom:true});
},_findClosest:function(f){var d=Number.MAX_VALUE;
var e;
var g;
this._dragData.forEach(function(h){e=Math.abs(h.position-f);
if(d>e){d=e;
g=h;
}},this);
return g;
}};
b.TreeListMobileColumnsView.registerClass("Telerik.Web.UI.TreeListMobileColumnsView",Telerik.Web.UI.TreeListMobileView);
})();
