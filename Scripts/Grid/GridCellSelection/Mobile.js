(function(a,c){Type.registerNamespace("Telerik.Web.UI");
var b="rgActiveCell";
Telerik.Web.UI.GridCellSelection=function(){Telerik.Web.UI.GridCellSelection.initializeBase(this);
this._owner={};
this._currentTableView;
this._lastActiveHeader=null;
this.options=null;
this._multiple=false;
this._columnSelect=false;
this._multiColumnSelect=false;
this._masterTable=null;
this._current=null;
this.selectable=null;
this.wrapper=null;
this._cellSelectedDelegate=null;
this._cellSelectingDelegate=null;
this._cellDeselectingDelegate=null;
this._cellDeselectedDelegate=null;
this._upDelegate=null;
};
Telerik.Web.UI.GridCellSelection.prototype={initialize:function(){Telerik.Web.UI.GridCellSelection.callBaseMethod(this,"initialize");
this._cellSelectingDelegate=Function.createDelegate(this,this._cellSelecting);
this._cellSelectedDelegate=Function.createDelegate(this,this._cellSelected);
this._cellDeselectingDelegate=Function.createDelegate(this,this._cellDeselecting);
this._cellDeselectedDelegate=Function.createDelegate(this,this._cellDeselected);
this.wrapper=a(this._owner.get_element());
this._masterTable=$get(this._owner._masterClientID).tBodies[0];
this._selectable();
},_selectable:function(){var f=this;
var e="rgCellSelectorArea rgCellSelectorArea_"+f._owner.Skin;
f.selectable=new Telerik.Web.UI.Extensions.Selectable(f._owner.get_element(),{filter:"tr[id]:not(.rgDeletedRow) > td:visible",multiple:f.get_multiple(),multiColumnSelect:f.get_multiColumnSelect(),owner:f._owner,styles:{SELECTED:"rgSelectedCell",ACTIVE:"rgFocusedCell",UNSELECTING:"web-ui-state-unselecting",MARQUEE:e},change:function(){}});
f.options=f.selectable.options;
var d=a.proxy(f._getGridTableFromElement,f);
a.extend(f.selectable,{getParentTable:function(g){return d(g);
}});
f.selectable.bind("select",f._cellSelectingDelegate);
f.selectable.bind("selected",f._cellSelectedDelegate);
f.selectable.bind("deselect",f._cellDeselectingDelegate);
f.selectable.bind("deselected",f._cellDeselectedDelegate);
if(f.get_columnSelect()){f.wrapper.delegate("th","touchstart",a.proxy(f._thMouseDown,f));
f._upDelegate=a.proxy(f.selectable._up,f.selectable);
}},_thMouseDown:function(g){var i=this,f=g.target;
if(i._owner._isResize){return;
}do{if(Telerik.Web.UI.RadGrid.isInstanceOfType($find(f.id))){if($find(f.id)!==i._owner){return;
}break;
}f=f.parentNode;
}while(f);
if(!a(g.target).is(":button,a,:input, textarea")&&!(a(g.target).is("span")&&a(g.target).attr("onclick")!=c&&a(g.target).attr("onclick")!="")){var d=g.ctrlKey,h=g.shiftKey;
i._shiftPressed=g.shiftKey;
i._downTarget=a(g.currentTarget);
i.wrapper.undelegate("th","touchend",i._upDelegate);
i.wrapper.delegate("th","touchend",i._upDelegate);
if(i.options.multiColumnSelect){i._prepareCellsForMultiColumnSelection(h,d);
}else{i._prepareCellsForSingleColumnSelection(h,d);
}i._lastActiveHeader=i._downTarget;
}},select:function(d){var f=this,e=f.selectable;
d=a(d);
if(d.length){if(!e.options.multiple){e.clear();
d=d.first();
}e.value(d);
return;
}return e.value();
},deselect:function(d){var f=this,e=f.selectable;
d=a(d);
if(d.length){e.unselect(d);
}},current:function(e){var f=this,d=f._current;
if(e!==c&&e.length){if(!d||d[0]!==e[0]&&!e.closest("tr").hasClass("rgDeletedRow")){e.addClass(b);
if(d){d.removeClass(b);
}f._current=e;
if(f.get_owner().ClientSettings.Scrolling.AllowScroll){f._scrollTo(e.parent()[0],e[0]);
}}}return f._current;
},_cellSelecting:function(d){var f=this;
if(!f._owner._getGridRow({target:d.element})){d.preventDefault();
return;
}var e=new Telerik.Web.UI.GridCellSelectCancelEventArgs(d.element,a);
f._owner.raise_cellSelecting(e);
if(e.get_cancel()||!e.get_column().get_selectable()){d.preventDefault();
}},_cellSelected:function(d){var e=new Telerik.Web.UI.GridCellSelectEventArgs(d.element,a);
if(!Array.contains(this._owner._selectedCellsIndexes,e.get_cellIndexHierarchical())){Array.add(this._owner._selectedCellsIndexes,e.get_cellIndexHierarchical());
this._owner.raise_cellSelected(e);
this._owner.updateClientState();
e.get_column()._selectedCellsCount++;
}},_cellDeselecting:function(d){var e=new Telerik.Web.UI.GridCellSelectCancelEventArgs(d.element,a);
this._owner.raise_cellDeselecting(e);
if(e.get_cancel()||!e.get_column().get_selectable()){d.preventDefault();
}},_cellDeselected:function(d){var e=new Telerik.Web.UI.GridCellSelectEventArgs(d.element,a);
if(Array.contains(this._owner._selectedCellsIndexes,e.get_cellIndexHierarchical())){Array.remove(this._owner._selectedCellsIndexes,e.get_cellIndexHierarchical());
this._owner.raise_cellDeselected(e);
this._owner.updateClientState();
e.get_column()._selectedCellsCount--;
}},_prepareCellsForSingleColumnSelection:function(n,g){var q=this;
var m=q._getGridTableFromElement(q._downTarget);
var p=q._downTarget;
if(m!=null){var d;
var k=q._getHeaderSettings(m);
var j=k.getHeaderIndex(p);
if(g){d=a(m).find(">tbody>"+q.options.filter+":nth-child("+(j+1)+")");
q._setActiveOrUnselecting(d);
q._setActiveCellUponColumnSelection(d);
var o=q.get_currentTableView(p[0]);
var f=o.get_columns();
for(var l=0;
l<f.length;
l++){var e=f[l];
if(e.get_selected()){p=e.get_element();
d=a(m).find(">tbody>"+q.options.filter+":nth-child("+(k.getHeaderIndex(p)+1)+")");
q._setUnselecting(d);
}}}else{d=a(m).find(">tbody>"+q.options.filter+":nth-child("+(j+1)+")");
q._setActive(d);
var h=q.wrapper.find(q.options.filter+"."+q.options.styles.SELECTED).not(d);
q.selectable.unselect(h);
h.last().removeClass(b);
q._setActiveCellUponColumnSelection(d);
}}},_prepareCellsForMultiColumnSelection:function(o,e){var r=this;
var n=r._getGridTableFromElement(r._downTarget);
if(n!=null){var d;
var p;
var j=r._getHeaderSettings(n);
var g;
if(o){if(r._lastActiveHeader==c||r._lastActiveHeader.length==0){p=r._downTarget;
g=j.getHeaderIndex(p);
d=a(n).find(">tbody>"+r.options.filter+":nth-child("+(g+1)+")");
r._setActiveOrUnselecting(d);
if(this._owner.ClientSettings.AllowKeyboardNavigation){r._setActiveCellUponColumnSelection(d);
}}else{if(r._lastActiveHeader[0]==r._downTarget[0]){return;
}else{p=r._downTarget;
var h;
r.selectable._shiftPressed=false;
if(j.hasMultiHeaders){var m=j.multiHeaders;
var q=a.inArray(p[0],m);
var l=a.inArray(r._lastActiveHeader[0],m);
if(q>l){h=m.slice(l+1,q+1);
}else{h=m.slice(q,l).reverse();
}}else{if(p.index()>r._lastActiveHeader.index()){h=r._lastActiveHeader.nextAll();
}else{h=r._lastActiveHeader.prevAll();
}}var k=0;
while(k<h.length){p=a(h[k]);
g=j.getHeaderIndex(p);
d=a(n).find(">tbody>"+r.options.filter+":nth-child("+(g+1)+")");
r._setActiveOrUnselecting(d);
if(p[0]===r._downTarget[0]){if(this._owner.ClientSettings.AllowKeyboardNavigation){r._setActiveCellUponColumnSelection(d);
}break;
}k++;
}}}}else{if(e){p=r._downTarget;
g=j.getHeaderIndex(p);
d=a(n).find(">tbody>"+r.options.filter+":nth-child("+(g+1)+")");
r._setActiveOrUnselecting(d);
if(this._owner.ClientSettings.AllowKeyboardNavigation){r._setActiveCellUponColumnSelection(d);
}}else{p=r._downTarget;
g=j.getHeaderIndex(p);
d=a(n).find(">tbody>"+r.options.filter+":nth-child("+(g+1)+")");
r._setActive(d);
var f=r.wrapper.find(r.options.filter+"."+r.options.styles.SELECTED).not(d);
r.selectable.unselect(f);
f.last().removeClass(b);
if(this._owner.ClientSettings.AllowKeyboardNavigation){r._setActiveCellUponColumnSelection(d);
}}}}},_setActiveCellUponColumnSelection:function(d){var e=this;
e.selectable._downTarget=e.current(d.first());
},_setActiveCellElement:function(d){var e=this;
e.selectable._downTarget=e.current(a(d));
},_setActiveOrUnselecting:function(d){var f=this;
for(var e=0;
e<d.length;
e++){if(a(d[e]).hasClass(f.options.styles.SELECTED)){a(d[e]).addClass(f.options.styles.UNSELECTING);
}else{a(d[e]).addClass(f.options.styles.ACTIVE);
}}},_setActive:function(d){var f=this;
for(var e=0;
e<d.length;
e++){if(!a(d[e]).hasClass(f.options.styles.SELECTED)){a(d[e]).addClass(f.options.styles.ACTIVE);
}}},_setUnselecting:function(d){var f=this;
for(var e=0;
e<d.length;
e++){if(a(d[e]).hasClass(f.options.styles.SELECTED)){a(d[e]).addClass(f.options.styles.UNSELECTING);
}}},_scrollTo:function(p,e){var m=p.offsetTop,f=$get(this._owner.get_id()+"_GridData"),l=e.offsetLeft,k=p.offsetHeight,n=e.offsetWidth,j=f.scrollTop,i=f.scrollLeft,g=f.clientHeight,h=f.clientWidth,d=m+k,o=l+n;
f.scrollTop=j>m?m:d>(j+g)?d-g:j;
f.scrollLeft=i>l?l:o>(i+h)?o-h:i;
},_selectColumnByHeaderElement:function(e,d){var f=this;
if(e.get_element!=null){f._selectColumnCells(d,e.get_element());
}else{f._selectColumnCells(d,e);
}},_deselectColumnByHeaderElement:function(e,d){var f=this;
if(e.get_element!=null){f._deselectColumnCells(d,e.get_element());
}else{f._deselectColumnCells(d,e);
}},_selectColumnCells:function(h,f){var g=this;
if(f==null){f=g._getGridTableFromElement(h);
}if(f){var e=g._getHeaderSettings(f).getHeaderIndex(h);
var d=a(f).find(">tbody>"+g.options.filter+":nth-child("+(e+1)+")");
g.selectable.value(d);
}},_deselectColumnCells:function(h,f){var g=this;
if(f==null){f=g._getGridTableFromElement(h);
}if(f){var e=g._getHeaderSettings(f).getHeaderIndex(h);
var d=a(f).find(">tbody>"+g.options.filter+":nth-child("+(e+1)+")");
g.selectable.unselect(d);
}},_deselectTableViewCells:function(e){var f=this;
if(e){if(e.get_element!=c){e=e.get_element();
}var d=a(e).find(">tbody>"+f.options.filter+"."+f.options.styles.SELECTED);
f.selectable.unselect(d);
}},_clear:function(){var d=this;
d.selectable.clear();
},_isMasterTable:function(e){var d=false;
if(e.id==this._owner._masterClientID){d=true;
}return d;
},_isDetailTable:function(e){var d=new RegExp(this.get_owner().get_id()+".+Detail.+");
return d.test(e.id);
},_isHeaderTable:function(e){var d=new RegExp(this.get_owner().get_id()+".+Header");
return d.test(e.id);
},_getGridTableFromElement:function(d){var h=this;
var g;
var f=a(d).parents("table");
for(var e=0;
e<f.length;
e++){if(h._isMasterTable(f[e])||h._isDetailTable(f[e])){g=f[e];
break;
}else{if(h._isHeaderTable(f[e])){g=a(f[e]).parents('div[id="'+this.get_owner().get_id()+'"]').find('div[id="'+this.get_owner().get_id()+'_GridData"]').find('table[id*="'+this.get_owner().get_id()+'"]');
if(g.length>0){g=g[0];
}}}}return g;
},_getHeaderSettings:function(i){var h={hasMultiHeaders:false,multiHeaders:[],getHeaderIndex:function(j){return a(j).index();
}};
if(!!i.id){var d=$find(i.id);
var e=this._owner;
if(d&&!d.get_parentView()){d=e.MasterTableViewHeader?e.MasterTableViewHeader:e.MasterTableView;
}var f=d._hasMultiHeaders,g=d.MultiHeaderCells;
if(f){h.hasMultiHeaders=true;
h.multiHeaders=g;
h.getHeaderIndex=function(k){var j=a(k);
return a.inArray(j[0],g);
};
}}return h;
},get_currentTableView:function(f){var e=this;
var d;
d=e._getGridTableFromElement(f).id;
if(e._currentTableView==null||e._currentTableView.get_id()!=d){e._currentTableView=$find(d);
}return e._currentTableView;
},get_column:function(h){var g=this;
var e=g.get_currentTableView().get_columns();
var d;
for(var f=0;
f<e.length;
f++){if(e[f].get_uniqueName()==h){d=e[f];
break;
}}return d;
},get_owner:function(){return this._owner;
},set_owner:function(d){this._owner=d;
},get_multiple:function(){return this._multiple;
},set_multiple:function(d){this._multiple=d;
},get_columnSelect:function(){return this._columnSelect;
},set_columnSelect:function(d){this._columnSelect=d;
},get_multiColumnSelect:function(){return this._multiColumnSelect;
},set_multiColumnSelect:function(d){this._multiColumnSelect=d;
}};
Telerik.Web.UI.GridCellSelection.registerClass("Telerik.Web.UI.GridCellSelection",Sys.Component);
})($telerik.$);
