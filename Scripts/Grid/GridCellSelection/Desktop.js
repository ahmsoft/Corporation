(function(a,i){Type.registerNamespace("Telerik.Web.UI");
var e="rgFocusable",f="rgActiveCell",h="tr:visible",c=":visible",b=h+">td"+c,d=b+":first",g={BACKSPACE:8,TAB:9,ENTER:13,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,END:35,HOME:36,SPACEBAR:32,PAGEUP:33,PAGEDOWN:34,F12:123};
Telerik.Web.UI.GridCellSelection=function(){Telerik.Web.UI.GridCellSelection.initializeBase(this);
this._owner={};
this._currentTableView;
this._lastActiveHeader=null;
this.options=null;
this._multiple=false;
this._columnSelect=false;
this._multiColumnSelect=false;
this._masterTable=null;
this._current=null;
this.selectable=null;
this.wrapper=null;
this._cellSelectedDelegate=null;
this._cellSelectingDelegate=null;
this._cellDeselectingDelegate=null;
this._cellDeselectedDelegate=null;
this._upDelegate=null;
};
Telerik.Web.UI.GridCellSelection.prototype={initialize:function(){Telerik.Web.UI.GridCellSelection.callBaseMethod(this,"initialize");
this._cellSelectingDelegate=Function.createDelegate(this,this._cellSelecting);
this._cellSelectedDelegate=Function.createDelegate(this,this._cellSelected);
this._cellDeselectingDelegate=Function.createDelegate(this,this._cellDeselecting);
this._cellDeselectedDelegate=Function.createDelegate(this,this._cellDeselected);
this.wrapper=a(this._owner.get_element());
this._masterTable=$get(this._owner._masterClientID).tBodies[0];
window.$addHandlers(this._masterTable,{mousedown:function(j){var l=Telerik.Web.UI.Grid.GetCurrentElement(j);
if(!Telerik.Web.UI.Grid.IsEditableControl(l)){Telerik.Web.UI.Grid.ClearDocumentEvents();
}function k(){a(document).unbind("mouseup",k);
Telerik.Web.UI.Grid.RestoreDocumentEvents();
}a(document).bind("mouseup",k);
}});
if(this._owner.ClientSettings.AllowKeyboardNavigation){this._navigatable();
}this._selectable();
},_navigatable:function(){var n=this,o=n.wrapper,m=a(n._masterTable).addClass(e),k=a.proxy(n.current,n),l="."+e+" "+b,j=function(p){if(!n._owner._getGridRow(p)){return;
}if(a(p.currentTarget).parent().attr("id")!=i){k(a(p.currentTarget));
if(!a(p.target).is(":button,a,:input, textarea")){o.focus();
}}};
o.bind({focus:function(q){var p=n._current;
if(p&&p.is(":visible")){p.addClass(f);
}else{if(n.get_owner().ClientSettings.Scrolling.EnableVirtualScrollPaging){var r=a(n._masterTable).find(d);
if(r!=i&&r.length){r.addClass(f);
n._current=r;
}}else{k(a(n._masterTable).find(d));
}}},focusout:function(){if(n._current){n._current.removeClass(f);
}},keydown:function(s){var w=s.keyCode,q=n.current(),B=s.shiftKey,p=!a(s.target).is(":button,a,:input,a>.t-icon"),u=false;
var v;
var y;
var r;
var A;
var t;
if(!q||!p){return;
}if(B){if(!q.hasClass(n.options.styles.SELECTED)&&s.keyCode!=16){n.select(q);
}}if(g.UP===w){A=q.parent().prevAll(h).first();
t=m.find(d);
if(A.length!=0&&A.attr("id")==null){r=A.find('table[id*="Detail"]');
A=r.find("tr[id]:visible").last();
t=A.find(d);
}else{if(A.length==0){A=q.parent();
y=A.parents('table[id*="Detail"]').parents("tr");
var z;
for(v=0;
v<y.length;
v++){z=a(y[v]).prev("tr[id]");
if(z!=null){A=z;
break;
}}}}k(q?A.children(":eq("+q.index()+"),:eq(0)").last():t);
u=true;
}else{if(g.DOWN===w){A=q.parent().nextAll(h).first();
t=m.find(d);
if(A.length!=0&&A.attr("id")==null){r=A.find('table[id*="Detail"]');
A=r.find("tr[id]:visible").first();
t=A.find(d);
}else{if(A.length==0){A=q.parent();
y=A.parents('table[id*="Detail"]').parents("tr");
var x;
for(v=0;
v<y.length;
v++){x=a(y[v]).next("tr[id]");
if(x!=null){A=x;
break;
}}}}k(q?A.children(":eq("+q.index()+"),:eq(0)").last():t);
u=true;
}else{if(g.LEFT===w){k(q?q.prevAll(c+":first"):m.find(d));
u=true;
}else{if(g.RIGHT===w){k(q?q.nextAll(":visible:first"):m.find(d));
u=true;
}}}}if(u){s.preventDefault();
if(B){n.select(n.current());
}}}});
o.delegate(l,"mousedown",j);
},_selectable:function(){var l=this;
var k="rgCellSelectorArea rgCellSelectorArea_"+l._owner.Skin;
l.selectable=new Telerik.Web.UI.Extensions.Selectable(l._owner.get_element(),{filter:"tr[id]:not(.rgDeletedRow) > td:visible",multiple:l.get_multiple(),multiColumnSelect:l.get_multiColumnSelect(),owner:l._owner,styles:{SELECTED:"rgSelectedCell",ACTIVE:"rgFocusedCell",UNSELECTING:"web-ui-state-unselecting",MARQUEE:k},change:function(){}});
l.options=l.selectable.options;
var j=a.proxy(l._getGridTableFromElement,l);
a.extend(l.selectable,{getParentTable:function(m){return j(m);
}});
l.selectable.bind("select",l._cellSelectingDelegate);
l.selectable.bind("selected",l._cellSelectedDelegate);
l.selectable.bind("deselect",l._cellDeselectingDelegate);
l.selectable.bind("deselected",l._cellDeselectedDelegate);
if(l.get_columnSelect()){l.wrapper.delegate("th","mousedown",a.proxy(l._thMouseDown,l));
l._upDelegate=a.proxy(l.selectable._up,l.selectable);
}if(l._owner.ClientSettings.AllowKeyboardNavigation){l.wrapper.keydown(function(o){var m=!a(o.target).is(":button,a,:input,a>.t-icon"),p=$find(o.target.id);
if(!m||(p&&Telerik.Web.UI.RadGrid.isInstanceOfType(p)&&p.get_id()!=l._owner.get_id())){return;
}var n=l.current();
if(o.keyCode===g.SPACEBAR){o.preventDefault();
if(l.get_multiple()){if(!o.ctrlKey){l.selectable.clear();
}else{if(n.hasClass(l.options.styles.SELECTED)){l.deselect(n);
n.removeClass(l.options.styles.SELECTED);
n=null;
}}}else{l.selectable.clear();
}l.select(n);
}});
}},_thMouseDown:function(l){var n=this,k=l.target;
if(n._owner._isResize){return;
}do{if(Telerik.Web.UI.RadGrid.isInstanceOfType($find(k.id))){if($find(k.id)!==n._owner){return;
}break;
}k=k.parentNode;
}while(k);
if(!a(l.target).is(":button,a,:input, textarea")&&!(a(l.target).is("span")&&a(l.target).attr("onclick")!=i&&a(l.target).attr("onclick")!="")){var j=l.ctrlKey,m=l.shiftKey;
n._shiftPressed=l.shiftKey;
n._downTarget=a(l.currentTarget);
n.wrapper.undelegate("th","mouseup",n._upDelegate);
n.wrapper.delegate("th","mouseup",n._upDelegate);
if(n.options.multiColumnSelect){n._prepareCellsForMultiColumnSelection(m,j);
}else{n._prepareCellsForSingleColumnSelection(m,j);
}n._lastActiveHeader=n._downTarget;
}},select:function(j){var l=this,k=l.selectable;
j=a(j);
if(j.length){if(!k.options.multiple){k.clear();
j=j.first();
}k.value(j);
return;
}return k.value();
},deselect:function(j){var l=this,k=l.selectable;
j=a(j);
if(j.length){k.unselect(j);
}},current:function(k){var l=this,j=l._current;
if(k!==i&&k.length){if(!j||j[0]!==k[0]&&!k.closest("tr").hasClass("rgDeletedRow")){k.addClass(f);
if(j){j.removeClass(f);
}l._current=k;
if(l.get_owner().ClientSettings.Scrolling.AllowScroll){l._scrollTo(k.parent()[0],k[0]);
}}}return l._current;
},_cellSelecting:function(j){var l=this;
if(!l._owner._getGridRow({target:j.element})){j.preventDefault();
return;
}var k=new Telerik.Web.UI.GridCellSelectCancelEventArgs(j.element,a);
l._owner.raise_cellSelecting(k);
if(k.get_cancel()||!k.get_column().get_selectable()){j.preventDefault();
}},_cellSelected:function(j){var k=new Telerik.Web.UI.GridCellSelectEventArgs(j.element,a);
if(!Array.contains(this._owner._selectedCellsIndexes,k.get_cellIndexHierarchical())){Array.add(this._owner._selectedCellsIndexes,k.get_cellIndexHierarchical());
this._owner.raise_cellSelected(k);
this._owner.updateClientState();
k.get_column()._selectedCellsCount++;
}},_cellDeselecting:function(j){var k=new Telerik.Web.UI.GridCellSelectCancelEventArgs(j.element,a);
this._owner.raise_cellDeselecting(k);
if(k.get_cancel()||!k.get_column().get_selectable()){j.preventDefault();
}},_cellDeselected:function(j){var k=new Telerik.Web.UI.GridCellSelectEventArgs(j.element,a);
if(Array.contains(this._owner._selectedCellsIndexes,k.get_cellIndexHierarchical())){Array.remove(this._owner._selectedCellsIndexes,k.get_cellIndexHierarchical());
this._owner.raise_cellDeselected(k);
this._owner.updateClientState();
k.get_column()._selectedCellsCount--;
}},_prepareCellsForSingleColumnSelection:function(s,m){var v=this;
var r=v._getGridTableFromElement(v._downTarget);
var u=v._downTarget;
if(r!=null){var j;
var p=v._getHeaderSettings(r);
var o=p.getHeaderIndex(u);
if(m){j=a(r).find(">tbody>"+v.options.filter+":nth-child("+(o+1)+")");
v._setActiveOrUnselecting(j);
v._setActiveCellUponColumnSelection(j);
var t=v.get_currentTableView(u[0]);
var l=t.get_columns();
for(var q=0;
q<l.length;
q++){var k=l[q];
if(k.get_selected()){u=k.get_element();
j=a(r).find(">tbody>"+v.options.filter+":nth-child("+(p.getHeaderIndex(u)+1)+")");
v._setUnselecting(j);
}}}else{j=a(r).find(">tbody>"+v.options.filter+":nth-child("+(o+1)+")");
v._setActive(j);
var n=v.wrapper.find(v.options.filter+"."+v.options.styles.SELECTED).not(j);
v.selectable.unselect(n);
n.last().removeClass(f);
v._setActiveCellUponColumnSelection(j);
}}},_prepareCellsForMultiColumnSelection:function(t,k){var w=this;
var s=w._getGridTableFromElement(w._downTarget);
if(s!=null){var j;
var u;
var o=w._getHeaderSettings(s);
var m;
if(t){if(w._lastActiveHeader==i||w._lastActiveHeader.length==0){u=w._downTarget;
m=o.getHeaderIndex(u);
j=a(s).find(">tbody>"+w.options.filter+":nth-child("+(m+1)+")");
w._setActiveOrUnselecting(j);
if(this._owner.ClientSettings.AllowKeyboardNavigation){w._setActiveCellUponColumnSelection(j);
}}else{if(w._lastActiveHeader[0]==w._downTarget[0]){return;
}else{u=w._downTarget;
var n;
w.selectable._shiftPressed=false;
if(o.hasMultiHeaders){var r=o.multiHeaders;
var v=a.inArray(u[0],r);
var q=a.inArray(w._lastActiveHeader[0],r);
if(v>q){n=r.slice(q+1,v+1);
}else{n=r.slice(v,q).reverse();
}}else{if(u.index()>w._lastActiveHeader.index()){n=w._lastActiveHeader.nextAll();
}else{n=w._lastActiveHeader.prevAll();
}}var p=0;
while(p<n.length){u=a(n[p]);
m=o.getHeaderIndex(u);
j=a(s).find(">tbody>"+w.options.filter+":nth-child("+(m+1)+")");
w._setActiveOrUnselecting(j);
if(u[0]===w._downTarget[0]){if(this._owner.ClientSettings.AllowKeyboardNavigation){w._setActiveCellUponColumnSelection(j);
}break;
}p++;
}}}}else{if(k){u=w._downTarget;
m=o.getHeaderIndex(u);
j=a(s).find(">tbody>"+w.options.filter+":nth-child("+(m+1)+")");
w._setActiveOrUnselecting(j);
if(this._owner.ClientSettings.AllowKeyboardNavigation){w._setActiveCellUponColumnSelection(j);
}}else{u=w._downTarget;
m=o.getHeaderIndex(u);
j=a(s).find(">tbody>"+w.options.filter+":nth-child("+(m+1)+")");
w._setActive(j);
var l=w.wrapper.find(w.options.filter+"."+w.options.styles.SELECTED).not(j);
w.selectable.unselect(l);
l.last().removeClass(f);
if(this._owner.ClientSettings.AllowKeyboardNavigation){w._setActiveCellUponColumnSelection(j);
}}}}},_setActiveCellUponColumnSelection:function(j){var k=this;
k.selectable._downTarget=k.current(j.first());
},_setActiveCellElement:function(j){var k=this;
k.selectable._downTarget=k.current(a(j));
},_setActiveOrUnselecting:function(j){var l=this;
for(var k=0;
k<j.length;
k++){if(a(j[k]).hasClass(l.options.styles.SELECTED)){a(j[k]).addClass(l.options.styles.UNSELECTING);
}else{a(j[k]).addClass(l.options.styles.ACTIVE);
}}},_setActive:function(j){var l=this;
for(var k=0;
k<j.length;
k++){if(!a(j[k]).hasClass(l.options.styles.SELECTED)){a(j[k]).addClass(l.options.styles.ACTIVE);
}}},_setUnselecting:function(j){var l=this;
for(var k=0;
k<j.length;
k++){if(a(j[k]).hasClass(l.options.styles.SELECTED)){a(j[k]).addClass(l.options.styles.UNSELECTING);
}}},_scrollTo:function(v,k){var s=v.offsetTop,l=$get(this._owner.get_id()+"_GridData"),r=k.offsetLeft,q=v.offsetHeight,t=k.offsetWidth,p=l.scrollTop,o=l.scrollLeft,m=l.clientHeight,n=l.clientWidth,j=s+q,u=r+t;
l.scrollTop=p>s?s:j>(p+m)?j-m:p;
l.scrollLeft=o>r?r:u>(o+n)?u-n:o;
},_selectColumnByHeaderElement:function(k,j){var l=this;
if(k.get_element!=null){l._selectColumnCells(j,k.get_element());
}else{l._selectColumnCells(j,k);
}},_deselectColumnByHeaderElement:function(k,j){var l=this;
if(k.get_element!=null){l._deselectColumnCells(j,k.get_element());
}else{l._deselectColumnCells(j,k);
}},_selectColumnCells:function(n,l){var m=this;
if(l==null){l=m._getGridTableFromElement(n);
}if(l){var k=m._getHeaderSettings(l).getHeaderIndex(n);
var j=a(l).find(">tbody>"+m.options.filter+":nth-child("+(k+1)+")");
m.selectable.value(j);
}},_deselectColumnCells:function(n,l){var m=this;
if(l==null){l=m._getGridTableFromElement(n);
}if(l){var k=m._getHeaderSettings(l).getHeaderIndex(n);
var j=a(l).find(">tbody>"+m.options.filter+":nth-child("+(k+1)+")");
m.selectable.unselect(j);
}},_deselectTableViewCells:function(k){var l=this;
if(k){if(k.get_element!=i){k=k.get_element();
}var j=a(k).find(">tbody>"+l.options.filter+"."+l.options.styles.SELECTED);
l.selectable.unselect(j);
}},_clear:function(){var j=this;
j.selectable.clear();
},_isMasterTable:function(k){var j=false;
if(k.id==this._owner._masterClientID){j=true;
}return j;
},_isDetailTable:function(k){var j=new RegExp(this.get_owner().get_id()+".+Detail.+");
return j.test(k.id);
},_isHeaderTable:function(k){var j=new RegExp(this.get_owner().get_id()+".+Header");
return j.test(k.id);
},_getGridTableFromElement:function(j){var n=this;
var m;
var l=a(j).parents("table");
for(var k=0;
k<l.length;
k++){if(n._isMasterTable(l[k])||n._isDetailTable(l[k])){m=l[k];
break;
}else{if(n._isHeaderTable(l[k])){m=a(l[k]).parents('div[id="'+this.get_owner().get_id()+'"]').find('div[id="'+this.get_owner().get_id()+'_GridData"]').find('table[id*="'+this.get_owner().get_id()+'"]');
if(m.length>0){m=m[0];
}}}}return m;
},_getHeaderSettings:function(o){var n={hasMultiHeaders:false,multiHeaders:[],getHeaderIndex:function(p){return a(p).index();
}};
if(!!o.id){var j=$find(o.id);
var k=this._owner;
if(j&&!j.get_parentView()){j=k.MasterTableViewHeader?k.MasterTableViewHeader:k.MasterTableView;
}var l=j._hasMultiHeaders,m=j.MultiHeaderCells;
if(l){n.hasMultiHeaders=true;
n.multiHeaders=m;
n.getHeaderIndex=function(q){var p=a(q);
return a.inArray(p[0],m);
};
}}return n;
},get_currentTableView:function(l){var k=this;
var j;
j=k._getGridTableFromElement(l).id;
if(k._currentTableView==null||k._currentTableView.get_id()!=j){k._currentTableView=$find(j);
}return k._currentTableView;
},get_column:function(n){var m=this;
var k=m.get_currentTableView().get_columns();
var j;
for(var l=0;
l<k.length;
l++){if(k[l].get_uniqueName()==n){j=k[l];
break;
}}return j;
},get_owner:function(){return this._owner;
},set_owner:function(j){this._owner=j;
},get_multiple:function(){return this._multiple;
},set_multiple:function(j){this._multiple=j;
},get_columnSelect:function(){return this._columnSelect;
},set_columnSelect:function(j){this._columnSelect=j;
},get_multiColumnSelect:function(){return this._multiColumnSelect;
},set_multiColumnSelect:function(j){this._multiColumnSelect=j;
}};
Telerik.Web.UI.GridCellSelection.registerClass("Telerik.Web.UI.GridCellSelection",Sys.Component);
})($telerik.$);
