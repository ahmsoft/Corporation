(function(b,a){a(["./kendo.data","./kendo.draganddrop","./kendo.userevents","./kendo.mobile.scroller","./kendo.drawing","./kendo.core","./kendo.dataviz.core","./kendo.toolbar","./kendo.editable","./kendo.window","./kendo.dropdownlist","./kendo.dataviz.themes"],b);
})(function(){(function(){(function(a,l){var i=window.kendo,d=i.dataviz.diagram={},c=i.deepExtend,h=a.isArray,f=1e-06;
var m={};
c(m,{isNearZero:function(n){return Math.abs(n)<f;
},isDefined:function(n){return typeof n!=="undefined";
},isUndefined:function(n){return(typeof n==="undefined")||n===null;
},isObject:function(n){return n===Object(n);
},has:function(o,n){return Object.hasOwnProperty.call(o,n);
},isString:function(n){return Object.prototype.toString.call(n)=="[object String]";
},isBoolean:function(n){return Object.prototype.toString.call(n)=="[object Boolean]";
},isType:function(n,o){return Object.prototype.toString.call(n)=="[object "+o+"]";
},isNumber:function(n){return !isNaN(parseFloat(n))&&isFinite(n);
},isEmpty:function(o){if(o===null){return true;
}if(h(o)||m.isString(o)){return o.length===0;
}for(var n in o){if(m.has(o,n)){return false;
}}return true;
},simpleExtend:function(n,p){if(!m.isObject(p)){return;
}for(var o in p){n[o]=p[o];
}},initArray:function b(p,q){var n=[];
for(var o=0;
o<p;
++o){n[o]=q;
}return n;
},serializePoints:function(q){var r=[];
for(var n=0;
n<q.length;
n++){var o=q[n];
r.push(o.x+";"+o.y);
}return r.join(";");
},deserializePoints:function(p){var q=p.split(";"),o=[];
if(q.length%2!==0){throw"Not an array of points.";
}for(var n=0;
n<q.length;
n+=2){o.push(new d.Point(parseInt(q[n],10),parseInt(q[n+1],10)));
}return o;
},randomInteger:function(n,o){return parseInt(Math.floor(Math.random()*o)+n,10);
},DFT:function(n,o){o(n);
if(n.childNodes){for(var p=0;
p<n.childNodes.length;
p++){var q=n.childNodes[p];
this.DFT(q,o);
}}},getMatrixAngle:function(n){if(n===null||n.d===0){return 0;
}return Math.atan2(n.b,n.d)*180/Math.PI;
},getMatrixScaling:function(n){var o=Math.sqrt(n.a*n.a+n.c*n.c);
var p=Math.sqrt(n.b*n.b+n.d*n.d);
return[o,p];
}});
function j(s,u,t){if(typeof s=="undefined"||typeof u=="undefined"){return[];
}if(t&&m.sign(u-s)!=m.sign(t)){throw"The sign of the increment should allow to reach the stop-value.";
}t=t||1;
s=s||0;
u=u||s;
if((u-s)/t===Infinity){throw"Infinite range defined.";
}var q=[],n=-1,o;
function r(w){var v=1;
while(w*v%1){v*=10;
}return v;
}var p=r(Math.abs(t));
s*=p;
u*=p;
t*=p;
if(s>u&&t>0){t=-t;
}if(t<0){while((o=s+t*++n)>=u){q.push(o/p);
}}else{while((o=s+t*++n)<=u){q.push(o/p);
}}return q;
}function g(r,o){if(r==o){return 0;
}var p=o.x-r.x,q=r.y-o.y,n=Math.atan(p/q);
if(q>=0){return p<0?n+(2*Math.PI):n;
}return n+Math.PI;
}m.sign=function(n){return n?n<0?-1:1:0;
};
m.findAngle=function(n,o){return g(n,o)*180/Math.PI;
};
m.forEach=function(n,p,q){for(var o=0;
o<n.length;
o++){p.call(q,n[o],o,n);
}};
m.any=function(n,p){for(var o=0;
o<n.length;
++o){if(p(n[o])){return n[o];
}}return null;
};
m.remove=function(n,p){var o;
while((o=m.indexOf(n,p))!==-1){n.splice(o,1);
}return n;
};
m.contains=function(n,o){return m.indexOf(n,o)!==-1;
};
m.indexOf=function(n,o){return a.inArray(o,n);
};
m.fold=function(s,r,n,o){var q=arguments.length>2;
for(var p=0;
p<s.length;
p++){var t=s[p];
if(!q){n=t;
q=true;
}else{n=r.call(o,n,t,p,s);
}}if(!q){throw"Reduce of empty array with no initial value";
}return n;
};
m.find=function(n,p,o){var q;
m.any(n,function(t,r,s){if(p.call(o,t,r,s)){q=t;
return true;
}return false;
});
return q;
};
m.first=function(n,o,p){if(n.length===0){return null;
}if(m.isUndefined(o)){return n[0];
}return m.find(n,o,p);
};
m.insert=function(n,o,p){n.splice(p,0,o);
return n;
};
m.all=function(n,q,o){var r=true;
var s;
for(var p=0;
p<n.length;
p++){s=n[p];
r=r&&q.call(o,s,p,n);
if(!r){break;
}}return r;
};
m.clear=function(n){n.splice(0,n.length);
};
m.bisort=function(n,p,r){if(m.isUndefined(n)){throw"First array is not specified.";
}if(m.isUndefined(p)){throw"Second array is not specified.";
}if(n.length!=p.length){throw"The two arrays should have equal length";
}var o=[],q;
for(q=0;
q<n.length;
q++){o.push({x:n[q],y:p[q]});
}if(m.isUndefined(r)){o.sort(function(s,t){return s.x-t.x;
});
}else{o.sort(function(s,t){return r(s.x,t.x);
});
}m.clear(n);
m.clear(p);
for(q=0;
q<o.length;
q++){n.push(o[q].x);
p.push(o[q].y);
}};
m.addRange=function(n,o){n.push.apply(n,o);
};
var e={easeInOut:function(n){return((-Math.cos(n*Math.PI)/2)+0.5);
}};
var k=i.Class.extend({init:function(){this.adapters=[];
this.target=0;
this.tick=0;
this.interval=20;
this.duration=800;
this.lastTime=null;
this.handlers=[];
var n=this;
this.transition=e.easeInOut;
this.timerDelegate=function(){n.onTimerEvent();
};
},addAdapter:function(n){this.adapters.push(n);
},onComplete:function(n){this.handlers.push(n);
},removeHandler:function(n){this.handlers=a.grep(this.handlers,function(o){return o!==n;
});
},trigger:function(){var n=this;
if(this.handlers){m.forEach(this.handlers,function(o){return o.call(n.caller!==null?n.caller:n);
});
}},onStep:function(){},seekTo:function(n){this.seekFromTo(this.tick,n);
},seekFromTo:function(n,o){this.target=Math.max(0,Math.min(1,o));
this.tick=Math.max(0,Math.min(1,n));
this.lastTime=new Date().getTime();
if(!this.intervalId){this.intervalId=window.setInterval(this.timerDelegate,this.interval);
}},stop:function(){if(this.intervalId){window.clearInterval(this.intervalId);
this.intervalId=null;
this.trigger();
}},play:function(n){if(this.adapters.length===0){return;
}if(n!==null){this.caller=n;
}this.initState();
this.seekFromTo(0,1);
},reverse:function(){this.seekFromTo(1,0);
},initState:function(){if(this.adapters.length===0){return;
}for(var n=0;
n<this.adapters.length;
n++){this.adapters[n].initState();
}},propagate:function(){var o=this.transition(this.tick);
for(var n=0;
n<this.adapters.length;
n++){this.adapters[n].update(o);
}},onTimerEvent:function(){var o=new Date().getTime();
var p=o-this.lastTime;
this.lastTime=o;
var n=(p/this.duration)*(this.tick<this.target?1:-1);
if(Math.abs(n)>=Math.abs(this.tick-this.target)){this.tick=this.target;
}else{this.tick+=n;
}try{this.propagate();
}finally{this.onStep.call(this);
if(this.target==this.tick){this.stop();
}}}});
i.deepExtend(d,{init:function(n){i.init(n,d.ui);
},Utils:m,Range:j,Ticker:k});
})(window.kendo.jQuery);
})();
(function(){(function(a,I){var r=window.kendo,f=r.dataviz.diagram,b=r.Class,e=r.deepExtend,d=r.dataviz,J=f.Utils,A=d.Point2D,p=r.isFunction,c=J.contains,t=a.map;
var m=3,h=1e-06;
e(A.fn,{plus:function(K){return new A(this.x+K.x,this.y+K.y);
},minus:function(K){return new A(this.x-K.x,this.y-K.y);
},offset:function(K){return new A(this.x-K,this.y-K);
},times:function(K){return new A(this.x*K,this.y*K);
},normalize:function(){if(this.length()===0){return new A();
}return this.times(1/this.length());
},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y);
},toString:function(){return"("+this.x+","+this.y+")";
},lengthSquared:function(){return(this.x*this.x+this.y*this.y);
},middleOf:function w(K,L){return new A(L.x-K.x,L.y-K.y).times(0.5).plus(K);
},toPolar:function(O){var L=1;
if(O){L=180/Math.PI;
}var K=Math.atan2(Math.abs(this.y),Math.abs(this.x));
var M=Math.PI/2;
var N=this.length();
if(this.x===0){if(this.y===0){return new B(0,0);
}if(this.y>0){return new B(N,L*M);
}if(this.y<0){return new B(N,L*3*M);
}}else{if(this.x>0){if(this.y===0){return new B(N,0);
}if(this.y>0){return new B(N,L*K);
}if(this.y<0){return new B(N,L*(4*M-K));
}}else{if(this.y===0){return new B(N,2*M);
}if(this.y>0){return new B(N,L*(2*M-K));
}if(this.y<0){return new B(N,L*(2*M+K));
}}}},isOnLine:function(K,P){if(K.x>P.x){var O=P;
P=K;
K=O;
}var M=new E(K.x,K.y).inflate(m,m),N=new E(P.x,P.y).inflate(m,m),L,Q;
if(M.union(N).contains(this)){if(K.x===P.x||K.y===P.y){return true;
}else{if(K.y<P.y){L=M.x+(((N.x-M.x)*(this.y-(M.y+M.height)))/((N.y+N.height)-(M.y+M.height)));
Q=(M.x+M.width)+((((N.x+N.width)-(M.x+M.width))*(this.y-M.y))/(N.y-M.y));
}else{L=M.x+(((N.x-M.x)*(this.y-M.y))/(N.y-M.y));
Q=(M.x+M.width)+((((N.x+N.width)-(M.x+M.width))*(this.y-(M.y+M.height)))/((N.y+N.height)-(M.y+M.height)));
}}return(this.x>L&&this.x<Q);
}return false;
}});
e(A,{parse:function(K){var L=K.slice(1,K.length-1),N=L.split(","),M=parseInt(N[0],10),O=parseInt(N[1],10);
if(!isNaN(M)&&!isNaN(O)){return new A(M,O);
}}});
var z=b.extend({init:function(L,K,M){this.point=L;
this.left=K;
this.right=M;
}});
var E=b.extend({init:function(M,N,L,K){this.x=M||0;
this.y=N||0;
this.width=L||0;
this.height=K||0;
},contains:function(K){return((K.x>=this.x)&&(K.x<=(this.x+this.width))&&(K.y>=this.y)&&(K.y<=(this.y+this.height)));
},inflate:function(K,L){if(L===I){L=K;
}this.x-=K;
this.y-=L;
this.width+=2*K+1;
this.height+=2*L+1;
return this;
},offset:function(K,L){var M=K,N=L;
if(K instanceof A){M=K.x;
N=K.y;
}this.x+=M;
this.y+=N;
return this;
},union:function(K){var L=Math.min(this.x,K.x);
var N=Math.min(this.y,K.y);
var M=Math.max((this.x+this.width),(K.x+K.width));
var O=Math.max((this.y+this.height),(K.y+K.height));
return new E(L,N,M-L,O-N);
},center:function(){return new A(this.x+this.width/2,this.y+this.height/2);
},top:function(){return new A(this.x+this.width/2,this.y);
},right:function(){return new A(this.x+this.width,this.y+this.height/2);
},bottom:function(){return new A(this.x+this.width/2,this.y+this.height);
},left:function(){return new A(this.x,this.y+this.height/2);
},topLeft:function(){return new A(this.x,this.y);
},topRight:function(){return new A(this.x+this.width,this.y);
},bottomLeft:function(){return new A(this.x,this.y+this.height);
},bottomRight:function(){return new A(this.x+this.width,this.y+this.height);
},clone:function(){return new E(this.x,this.y,this.width,this.height);
},isEmpty:function(){return !this.width&&!this.height;
},equals:function(K){return this.x===K.x&&this.y===K.y&&this.width===K.width&&this.height===K.height;
},rotatedBounds:function(K){var O=this.clone(),N=this.rotatedPoints(K),P=N[0],Q=N[1],M=N[2],L=N[3];
O.x=Math.min(M.x,P.x,Q.x,L.x);
O.y=Math.min(M.y,P.y,Q.y,L.y);
O.width=Math.max(M.x,P.x,Q.x,L.x)-O.x;
O.height=Math.max(M.y,P.y,Q.y,L.y)-O.y;
return O;
},rotatedPoints:function(K){var O=this,N=O.center(),M=O.bottomRight().rotate(N,360-K),P=O.topLeft().rotate(N,360-K),Q=O.topRight().rotate(N,360-K),L=O.bottomLeft().rotate(N,360-K);
return[P,Q,M,L];
},toString:function(K){K=K||" ";
return this.x+K+this.y+K+this.width+K+this.height;
},scale:function(P,Q,R,K,L){var T=this.topLeft();
var S=this.center();
T.rotate(S,360-L).rotate(K,L);
var M=R.minus(T);
var O=new A(M.x*P,M.y*Q);
var N=M.minus(O);
T=T.plus(N);
T.rotate(K,360-L).rotate(S,L);
this.x=T.x;
this.y=T.y;
this.width*=P;
this.height*=Q;
},zoom:function(K){this.x*=K;
this.y*=K;
this.width*=K;
this.height*=K;
return this;
}});
var H=b.extend({init:function(L,K){this.width=L;
this.height=K;
}});
H.prototype.Empty=new H(0,0);
E.toRect=function(K){if(!(K instanceof E)){K=new E(K.x,K.y,K.width,K.height);
}return K;
};
E.empty=function(){return new E(0,0,0,0);
};
E.fromPoints=function(K,L){if(isNaN(K.x)||isNaN(K.y)||isNaN(L.x)||isNaN(L.y)){throw"Some values are NaN.";
}return new E(Math.min(K.x,L.x),Math.min(K.y,L.y),Math.abs(K.x-L.x),Math.abs(K.y-L.y));
};
function q(K){return Math.abs(K)<h;
}function o(R,K,S,L,M){var T=((K.x-R.x)*(L.y-S.y))-((K.y-R.y)*(L.x-S.x));
if(q(T)){return;
}var N=((R.y-S.y)*(L.x-S.x))-((R.x-S.x)*(L.y-S.y));
var O=((R.y-S.y)*(K.x-R.x))-((R.x-S.x)*(K.y-R.y));
var P=N/T;
var Q=O/T;
if(M&&(P<0||P>1||Q<0||Q>1)){return;
}return new A(R.x+(P*(K.x-R.x)),R.y+(P*(K.y-R.y)));
}var n={lines:function(M,K,N,L){return o(M,K,N,L);
},segments:function(M,K,N,L){return o(M,K,N,L,true);
},rectWithLine:function(L,M,K){return n.segments(M,K,L.topLeft(),L.topRight())||n.segments(M,K,L.topRight(),L.bottomRight())||n.segments(M,K,L.bottomLeft(),L.bottomRight())||n.segments(M,K,L.topLeft(),L.bottomLeft());
},rects:function(P,Q,K){var S=Q.topLeft(),T=Q.topRight(),L=Q.bottomLeft(),M=Q.bottomRight();
var N=Q.center();
if(K){S=S.rotate(N,K);
T=T.rotate(N,K);
L=L.rotate(N,K);
M=M.rotate(N,K);
}var O=P.contains(S)||P.contains(T)||P.contains(L)||P.contains(M)||n.rectWithLine(P,S,T)||n.rectWithLine(P,S,L)||n.rectWithLine(P,T,M)||n.rectWithLine(P,L,M);
if(!O){S=P.topLeft();
T=P.topRight();
L=P.bottomLeft();
M=P.bottomRight();
if(K){var R=360-K;
S=S.rotate(N,R);
T=T.rotate(N,R);
L=L.rotate(N,R);
M=M.rotate(N,R);
}O=Q.contains(S)||Q.contains(T)||Q.contains(L)||Q.contains(M);
}return O;
}};
var F=b.extend({init:function(K){this.container=E.toRect(K);
},align:function(M,K){var L=K.toLowerCase().split(" ");
for(var N=0;
N<L.length;
N++){M=this._singleAlign(M,L[N]);
}return M;
},_singleAlign:function(L,K){if(p(this[K])){return this[K](L);
}else{return L;
}},left:function(K){return this._align(K,this._left);
},center:function(K){return this._align(K,this._center);
},right:function(K){return this._align(K,this._right);
},stretch:function(K){return this._align(K,this._stretch);
},top:function(K){return this._align(K,this._top);
},middle:function(K){return this._align(K,this._middle);
},bottom:function(K){return this._align(K,this._bottom);
},_left:function(K,L){L.x=K.x;
},_center:function(K,L){L.x=((K.width-L.width)/2)||0;
},_right:function(K,L){L.x=K.width-L.width;
},_top:function(K,L){L.y=K.y;
},_middle:function(K,L){L.y=((K.height-L.height)/2)||0;
},_bottom:function(K,L){L.y=K.height-L.height;
},_stretch:function(K,L){L.x=0;
L.y=0;
L.height=K.height;
L.width=K.width;
},_align:function(L,K){L=E.toRect(L);
K(this.container,L);
return L;
}});
var B=b.extend({init:function(L,K){this.r=L;
this.angle=K;
}});
var u=b.extend({init:function(K,L,M,N,O,P){this.a=K||0;
this.b=L||0;
this.c=M||0;
this.d=N||0;
this.e=O||0;
this.f=P||0;
},plus:function(K){this.a+=K.a;
this.b+=K.b;
this.c+=K.c;
this.d+=K.d;
this.e+=K.e;
this.f+=K.f;
},minus:function(K){this.a-=K.a;
this.b-=K.b;
this.c-=K.c;
this.d-=K.d;
this.e-=K.e;
this.f-=K.f;
},times:function(K){return new u(this.a*K.a+this.c*K.b,this.b*K.a+this.d*K.b,this.a*K.c+this.c*K.d,this.b*K.c+this.d*K.d,this.a*K.e+this.c*K.f+this.e,this.b*K.e+this.d*K.f+this.f);
},apply:function(K){return new A(this.a*K.x+this.c*K.y+this.e,this.b*K.x+this.d*K.y+this.f);
},applyRect:function(K){return E.fromPoints(this.apply(K.topLeft()),this.apply(K.bottomRight()));
},toString:function(){return"matrix("+this.a+" "+this.b+" "+this.c+" "+this.d+" "+this.e+" "+this.f+")";
}});
e(u,{fromSVGMatrix:function(L){var K=new u();
K.a=L.a;
K.b=L.b;
K.c=L.c;
K.d=L.d;
K.e=L.e;
K.f=L.f;
return K;
},fromMatrixVector:function(L){var K=new u();
K.a=L.a;
K.b=L.b;
K.c=L.c;
K.d=L.d;
K.e=L.e;
K.f=L.f;
return K;
},fromList:function(L){if(L.length!==6){throw"The given list should consist of six elements.";
}var K=new u();
K.a=L[0];
K.b=L[1];
K.c=L[2];
K.d=L[3];
K.e=L[4];
K.f=L[5];
return K;
},translation:function(L,M){var K=new u();
K.a=1;
K.b=0;
K.c=0;
K.d=1;
K.e=L;
K.f=M;
return K;
},unit:function(){return new u(1,0,0,1,0,0);
},rotation:function(K,M,N){var L=new u();
L.a=Math.cos(K*Math.PI/180);
L.b=Math.sin(K*Math.PI/180);
L.c=-L.b;
L.d=L.a;
L.e=(M-M*L.a+N*L.b)||0;
L.f=(N-N*L.a-M*L.b)||0;
return L;
},scaling:function(L,M){var K=new u();
K.a=L;
K.b=0;
K.c=0;
K.d=M;
K.e=0;
K.f=0;
return K;
},parse:function(M){var L,K;
if(M){M=M.trim();
if(M.slice(0,6).toLowerCase()==="matrix"){K=M.slice(7,M.length-1).trim();
L=K.split(",");
if(L.length===6){return u.fromList(t(L,function(N){return parseFloat(N);
}));
}L=K.split(" ");
if(L.length===6){return u.fromList(t(L,function(N){return parseFloat(N);
}));
}}if(M.slice(0,1)==="("&&M.slice(M.length-1)===")"){M=M.substr(1,M.length-1);
}if(M.indexOf(",")>0){L=M.split(",");
if(L.length===6){return u.fromList(t(L,function(N){return parseFloat(N);
}));
}}if(M.indexOf(" ")>0){L=M.split(" ");
if(L.length===6){return u.fromList(t(L,function(N){return parseFloat(N);
}));
}}}return L;
}});
var v=b.extend({init:function(K,L,M,N,O,P){this.a=K||0;
this.b=L||0;
this.c=M||0;
this.d=N||0;
this.e=O||0;
this.f=P||0;
},fromMatrix:function i(K){var L=new v();
L.a=K.a;
L.b=K.b;
L.c=K.c;
L.d=K.d;
L.e=K.e;
L.f=K.f;
return L;
}});
function y(L,K){var N,O,M;
do{N=Math.random()*2-1;
O=Math.random()*2-1;
M=N*N+O*O;
}while(!M||M>1);
return L+K*N*Math.sqrt(-2*Math.log(M)/M);
}function D(M){if(J.isUndefined(M)){M=10;
}var N="";
var K="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
for(var L=M;
L>0;
--L){N+=K.charAt(Math.round(Math.random()*(K.length-1)));
}return N;
}var j={_distanceToLineSquared:function(O,K,L){function M(R,S){return(R.x-S.x)*(R.x-S.x)+(R.y-S.y)*(R.y-S.y);
}if(K===L){return M(O,K);
}var P=L.x-K.x,Q=L.y-K.y,N=(O.x-K.x)*P+(O.y-K.y)*Q;
if(N<0){return M(K,O);
}N=(L.x-O.x)*P+(L.y-O.y)*Q;
if(N<0){return M(L,O);
}N=(L.x-O.x)*Q-(L.y-O.y)*P;
return N*N/(P*P+Q*Q);
},distanceToLine:function(M,K,L){return Math.sqrt(this._distanceToLineSquared(M,K,L));
},distanceToPolyline:function(M,P){var L=Number.MAX_VALUE;
if(J.isUndefined(P)||P.length===0){return Number.MAX_VALUE;
}for(var Q=0;
Q<P.length-1;
Q++){var N=P[Q];
var O=P[Q+1];
var K=this._distanceToLineSquared(M,N,O);
if(K<L){L=K;
}}return Math.sqrt(L);
}};
var l=r.Class.extend({init:function(){this._buckets=[];
this.length=0;
},add:function(K,M){var L=this._createGetBucket(K);
if(J.isDefined(M)){L.value=M;
}return L;
},get:function(K){if(this._bucketExists(K)){return this._createGetBucket(K);
}return null;
},set:function(K,L){this.add(K,L);
},containsKey:function(K){return this._bucketExists(K);
},remove:function(L){if(this._bucketExists(L)){var K=this._hash(L);
delete this._buckets[K];
this.length--;
return L;
}},forEach:function(L){var N=this._hashes();
for(var O=0,P=N.length;
O<P;
O++){var M=N[O];
var K=this._buckets[M];
if(J.isUndefined(K)){continue;
}L(K);
}},clone:function(){var N=new l();
var M=this._hashes();
for(var O=0,P=M.length;
O<P;
O++){var L=M[O];
var K=this._buckets[L];
if(J.isUndefined(K)){continue;
}N.add(K.key,K.value);
}return N;
},_hashes:function(){var L=[];
for(var K in this._buckets){if(this._buckets.hasOwnProperty(K)){L.push(K);
}}return L;
},_bucketExists:function(L){var K=this._hash(L);
return J.isDefined(this._buckets[K]);
},_createGetBucket:function(M){var L=this._hash(M);
var K=this._buckets[L];
if(J.isUndefined(K)){K={key:M};
this._buckets[L]=K;
this.length++;
}return K;
},_hash:function(K){if(J.isNumber(K)){return K;
}if(J.isString(K)){return this._hashString(K);
}if(J.isObject(K)){return this._objectHashId(K);
}throw"Unsupported key type.";
},_hashString:function(N){var M=0;
if(N.length===0){return M;
}for(var L=0;
L<N.length;
L++){var K=N.charCodeAt(L);
M=((M*32)-M)+K;
}return M;
},_objectHashId:function(L){var K=L._hashId;
if(J.isUndefined(K)){K=D();
L._hashId=K;
}return K;
}});
var g=r.Observable.extend({init:function(K){var M=this;
r.Observable.fn.init.call(M);
this._hashTable=new l();
this.length=0;
if(J.isDefined(K)){if(a.isArray(K)){for(var L=0;
L<K.length;
L++){this.add(K[L]);
}}else{K.forEach(function(N,O){this.add(N,O);
},this);
}}},add:function(L,M){var K=this._hashTable.get(L);
if(!K){K=this._hashTable.add(L);
this.length++;
this.trigger("changed");
}K.value=M;
},set:function(K,L){this.add(K,L);
},get:function(L){var K=this._hashTable.get(L);
if(K){return K.value;
}throw new Error("Cannot find key "+L);
},containsKey:function(K){return this._hashTable.containsKey(K);
},remove:function(K){if(this.containsKey(K)){this.trigger("changed");
this.length--;
return this._hashTable.remove(K);
}},forEach:function(K,L){this._hashTable.forEach(function(M){K.call(L,M.key,M.value);
});
},forEachValue:function(K,L){this._hashTable.forEach(function(M){K.call(L,M.value);
});
},forEachKey:function(K,L){this._hashTable.forEach(function(M){K.call(L,M.key);
});
},keys:function(){var K=[];
this.forEachKey(function(L){K.push(L);
});
return K;
}});
var C=r.Class.extend({init:function(){this._tail=null;
this._head=null;
this.length=0;
},enqueue:function(L){var K={value:L,next:null};
if(!this._head){this._head=K;
this._tail=this._head;
}else{this._tail.next=K;
this._tail=this._tail.next;
}this.length++;
},dequeue:function(){if(this.length<1){throw new Error("The queue is empty.");
}var K=this._head.value;
this._head=this._head.next;
this.length--;
return K;
},contains:function(L){var K=this._head;
while(K){if(K.value===L){return true;
}K=K.next;
}return false;
}});
var G=r.Observable.extend({init:function(K){var L=this;
r.Observable.fn.init.call(L);
this._hashTable=new l();
this.length=0;
if(J.isDefined(K)){if(K instanceof l){K.forEach(function(M){this.add(M);
});
}else{if(K instanceof g){K.forEach(function(M,N){this.add({key:M,value:N});
},this);
}}}},contains:function(K){return this._hashTable.containsKey(K);
},add:function(L){var K=this._hashTable.get(L);
if(!K){this._hashTable.add(L,L);
this.length++;
this.trigger("changed");
}},get:function(K){if(this.contains(K)){return this._hashTable.get(K).value;
}else{return null;
}},hash:function(K){return this._hashTable._hash(K);
},remove:function(K){if(this.contains(K)){this._hashTable.remove(K);
this.length--;
this.trigger("changed");
}},forEach:function(L,K){this._hashTable.forEach(function(M){L(M.value);
},K);
},toArray:function(){var K=[];
this.forEach(function(L){K.push(L);
});
return K;
}});
var x=r.Class.extend({init:function(L,M){this.links=[];
this.outgoing=[];
this.incoming=[];
this.weight=1;
if(J.isDefined(L)){this.id=L;
}else{this.id=D();
}if(J.isDefined(M)){this.associatedShape=M;
var K=M.bounds();
this.width=K.width;
this.height=K.height;
this.x=K.x;
this.y=K.y;
}else{this.associatedShape=null;
}this.data=null;
this.type="Node";
this.shortForm="Node '"+this.id+"'";
this.isVirtual=false;
},isIsolated:function(){return J.isEmpty(this.links);
},bounds:function(K){if(!J.isDefined(K)){return new f.Rect(this.x,this.y,this.width,this.height);
}this.x=K.x;
this.y=K.y;
this.width=K.width;
this.height=K.height;
},isLinkedTo:function(K){var L=this;
return J.any(L.links,function(M){return M.getComplement(L)===K;
});
},getChildren:function(){if(this.outgoing.length===0){return[];
}var K=[];
for(var L=0,M=this.outgoing.length;
L<M;
L++){var N=this.outgoing[L];
K.push(N.getComplement(this));
}return K;
},getParents:function(){if(this.incoming.length===0){return[];
}var N=[];
for(var K=0,L=this.incoming.length;
K<L;
K++){var M=this.incoming[K];
N.push(M.getComplement(this));
}return N;
},clone:function(){var K=new x();
if(J.isDefined(this.weight)){K.weight=this.weight;
}if(J.isDefined(this.balance)){K.balance=this.balance;
}if(J.isDefined(this.owner)){K.owner=this.owner;
}K.associatedShape=this.associatedShape;
K.x=this.x;
K.y=this.y;
K.width=this.width;
K.height=this.height;
return K;
},adjacentTo:function(K){return this.isLinkedTo(K)!==null;
},removeLink:function(K){if(K.source===this){J.remove(this.links,K);
J.remove(this.outgoing,K);
K.source=null;
}if(K.target===this){J.remove(this.links,K);
J.remove(this.incoming,K);
K.target=null;
}},hasLinkTo:function(K){return J.any(this.outgoing,function(L){return L.target===K;
});
},degree:function(){return this.links.length;
},incidentWith:function(K){return c(this.links,K);
},getLinksWith:function(K){return J.all(this.links,function(L){return L.getComplement(this)===K;
},this);
},getNeighbors:function(){var K=[];
J.forEach(this.incoming,function(L){K.push(L.getComplement(this));
},this);
J.forEach(this.outgoing,function(L){K.push(L.getComplement(this));
},this);
return K;
}});
var s=r.Class.extend({init:function(M,O,L,K){if(J.isUndefined(M)){throw"The source of the new link is not set.";
}if(J.isUndefined(O)){throw"The target of the new link is not set.";
}var N,P;
if(J.isString(M)){N=new x(M);
}else{N=M;
}if(J.isString(O)){P=new x(O);
}else{P=O;
}this.source=N;
this.target=P;
this.source.links.push(this);
this.target.links.push(this);
this.source.outgoing.push(this);
this.target.incoming.push(this);
if(J.isDefined(L)){this.id=L;
}else{this.id=D();
}if(J.isDefined(K)){this.associatedConnection=K;
}else{this.associatedConnection=null;
}this.type="Link";
this.shortForm="Link '"+this.source.id+"->"+this.target.id+"'";
},getComplement:function(K){if(this.source!==K&&this.target!==K){throw"The given node is not incident with this link.";
}return this.source===K?this.target:this.source;
},getCommonNode:function(K){if(this.source===K.source||this.source===K.target){return this.source;
}if(this.target===K.source||this.target===K.target){return this.target;
}return null;
},isBridging:function(K,L){return this.source===K&&this.target===L||this.source===L&&this.target===K;
},getNodes:function(){return[this.source,this.target];
},incidentWith:function(K){return this.source===K||this.target===K;
},adjacentTo:function(K){return c(this.source.links,K)||c(this.target.links,K);
},changeSource:function(K){J.remove(this.source.links,this);
J.remove(this.source.outgoing,this);
K.links.push(this);
K.outgoing.push(this);
this.source=K;
},changeTarget:function(K){J.remove(this.target.links,this);
J.remove(this.target.incoming,this);
K.links.push(this);
K.incoming.push(this);
this.target=K;
},changesNodes:function(K,L){if(this.source===K){this.changeSource(L);
}else{if(this.target===K){this.changeTarget(L);
}}},reverse:function(){var K=this.source;
var L=this.target;
this.source=L;
J.remove(K.outgoing,this);
this.source.outgoing.push(this);
this.target=K;
J.remove(L.incoming,this);
this.target.incoming.push(this);
return this;
},directTo:function(K){if(this.source!==K&&this.target!==K){throw"The given node is not incident with this link.";
}if(this.target!==K){this.reverse();
}},createReverseEdge:function(){var K=this.clone();
K.reverse();
K.reversed=true;
return K;
},clone:function(){var K=new s(this.source,this.target);
return K;
}});
var k=r.Class.extend({init:function(K){this.links=[];
this.nodes=[];
this.diagram=null;
this._root=null;
if(J.isDefined(K)){if(J.isString(K)){this.id=K;
}else{this.diagram=K;
this.id=K.id;
}}else{this.id=D();
}this.bounds=new E();
this._hasCachedRelationships=false;
this.type="Graph";
},cacheRelationships:function(K){if(J.isUndefined(K)){K=false;
}if(this._hasCachedRelationships&&!K){return;
}for(var L=0,M=this.nodes.length;
L<M;
L++){var N=this.nodes[L];
N.children=this.getChildren(N);
N.parents=this.getParents(N);
}this._hasCachedRelationships=true;
},assignLevels:function(P,O,Q){if(!P){throw"Start node not specified.";
}if(J.isUndefined(O)){O=0;
}this.cacheRelationships();
if(J.isUndefined(Q)){Q=new g();
J.forEach(this.nodes,function(R){Q.add(R,false);
});
}Q.set(P,true);
P.level=O;
var L=P.children;
for(var M=0,N=L.length;
M<N;
M++){var K=L[M];
if(!K||Q.get(K)){continue;
}this.assignLevels(K,O+1,Q);
}},root:function(L){if(J.isUndefined(L)){if(!this._root){var K=J.first(this.nodes,function(M){return M.incoming.length===0;
});
if(K){return K;
}return J.first(this.nodes);
}else{return this._root;
}}else{this._root=L;
}},getConnectedComponents:function(){this.componentIndex=0;
this.setItemIndices();
var K=J.initArray(this.nodes.length,-1);
for(var O=0;
O<this.nodes.length;
O++){if(K[O]===-1){this._collectConnectedNodes(K,O);
this.componentIndex++;
}}var L=[],N;
for(N=0;
N<this.componentIndex;
++N){L[N]=new k();
}for(N=0;
N<K.length;
++N){var M=L[K[N]];
M.addNodeAndOutgoings(this.nodes[N]);
}L.sort(function(P,Q){return Q.nodes.length-P.nodes.length;
});
return L;
},_collectConnectedNodes:function(M,L){M[L]=this.componentIndex;
var K=this.nodes[L];
J.forEach(K.links,function(N){var O=N.getComplement(K);
var P=O.index;
if(M[P]===-1){this._collectConnectedNodes(M,P);
}},this);
},calcBounds:function(){if(this.isEmpty()){this.bounds=new E();
return this.bounds;
}var K=null;
for(var L=0,M=this.nodes.length;
L<M;
L++){var N=this.nodes[L];
if(!K){K=N.bounds();
}else{K=K.union(N.bounds());
}}this.bounds=K;
return this.bounds;
},getSpanningTree:function(T){var W=new k();
var O=new g(),U,V;
W.root=T.clone();
W.root.level=0;
W.root.id=T.id;
O.add(T,W.root);
T.level=0;
var Y=[];
var S=[];
W.nodes.push(W.root);
Y.push(T);
S.push(T);
var M=1;
while(S.length>0){var Q=S.pop();
for(var R=0;
R<Q.links.length;
R++){var N=Q.links[R];
var K=N.getComplement(Q);
if(c(Y,K)){continue;
}K.level=Q.level+1;
if(M<K.level+1){M=K.level+1;
}if(!c(S,K)){S.push(K);
}if(!c(Y,K)){Y.push(K);
}if(O.containsKey(Q)){U=O.get(Q);
}else{U=Q.clone();
U.level=Q.level;
U.id=Q.id;
O.add(Q,U);
}if(O.containsKey(K)){V=O.get(K);
}else{V=K.clone();
V.level=K.level;
V.id=K.id;
O.add(K,V);
}var P=new s(U,V);
W.addLink(P);
}}var X=[];
for(var L=0;
L<M;
L++){X.push([]);
}J.forEach(W.nodes,function(Z){X[Z.level].push(Z);
});
W.treeLevels=X;
W.cacheRelationships();
return W;
},takeRandomNode:function(K,L){if(J.isUndefined(K)){K=[];
}if(J.isUndefined(L)){L=4;
}if(this.nodes.length===0){return null;
}if(this.nodes.length===1){return c(K,this.nodes[0])?null:this.nodes[0];
}var M=a.grep(this.nodes,function(N){return !c(K,N)&&N.degree()<=L;
});
if(J.isEmpty(M)){return null;
}return M[J.randomInteger(0,M.length)];
},isEmpty:function(){return J.isEmpty(this.nodes);
},isHealthy:function(){return J.all(this.links,function(K){return c(this.nodes,K.source)&&c(this.nodes,K.target);
},this);
},getParents:function(K){if(!this.hasNode(K)){throw"The given node is not part of this graph.";
}return K.getParents();
},getChildren:function(K){if(!this.hasNode(K)){throw"The given node is not part of this graph.";
}return K.getChildren();
},addLink:function(O,P,N){if(J.isUndefined(O)){throw"The source of the link is not defined.";
}if(J.isUndefined(P)){if(J.isDefined(O.type)&&O.type==="Link"){this.addExistingLink(O);
return;
}else{throw"The target of the link is not defined.";
}}var K=this.getNode(O);
if(J.isUndefined(K)){K=this.addNode(O);
}var L=this.getNode(P);
if(J.isUndefined(L)){L=this.addNode(P);
}var M=new s(K,L);
if(J.isDefined(N)){M.owner=N;
}this.links.push(M);
return M;
},removeAllLinks:function(){while(this.links.length>0){var K=this.links[0];
this.removeLink(K);
}},addExistingLink:function(K){if(this.hasLink(K)){return;
}this.links.push(K);
if(this.hasNode(K.source.id)){var L=this.getNode(K.source.id);
K.changeSource(L);
}else{this.addNode(K.source);
}if(this.hasNode(K.target.id)){var M=this.getNode(K.target.id);
K.changeTarget(M);
}else{this.addNode(K.target);
}},hasLink:function(K){if(J.isString(K)){return J.any(this.links,function(L){return L.id===K;
});
}if(K.type==="Link"){return c(this.links,K);
}throw"The given object is neither an identifier nor a Link.";
},getNode:function(K){if(J.isUndefined(K)){throw"No identifier or Node specified.";
}if(J.isString(K)){return J.find(this.nodes,function(L){return L.id==K;
});
}else{if(this.hasNode(K)){return K;
}else{return null;
}}},hasNode:function(K){if(J.isString(K)){return J.any(this.nodes,function(L){return L.id===K;
});
}if(J.isObject(K)){return J.any(this.nodes,function(L){return L===K;
});
}throw"The identifier should be a Node or the Id (string) of a node.";
},removeNode:function(P){var O=P;
if(J.isString(P)){O=this.getNode(P);
}if(J.isDefined(O)){var N=O.links;
O.links=[];
for(var K=0,L=N.length;
K<L;
K++){var M=N[K];
this.removeLink(M);
}J.remove(this.nodes,O);
}else{throw"The identifier should be a Node or the Id (string) of a node.";
}},areConnected:function(K,L){return J.any(this.links,function(M){return M.source==K&&M.target==L||M.source==L&&M.target==K;
});
},removeLink:function(K){J.remove(this.links,K);
J.remove(K.source.outgoing,K);
J.remove(K.source.links,K);
J.remove(K.target.incoming,K);
J.remove(K.target.links,K);
},addNode:function(M,K,N){var L=null;
if(!J.isDefined(M)){throw"No Node or identifier for a new Node is given.";
}if(J.isString(M)){if(this.hasNode(M)){return this.getNode(M);
}L=new x(M);
}else{if(this.hasNode(M)){return this.getNode(M);
}L=M;
}if(J.isDefined(K)){L.bounds(K);
}if(J.isDefined(N)){L.owner=N;
}this.nodes.push(L);
return L;
},addNodeAndOutgoings:function(L){if(!c(this.nodes,L)){this.nodes.push(L);
}var K=L.outgoing;
L.outgoing=[];
J.forEach(K,function(M){this.addExistingLink(M);
},this);
},setItemIndices:function(){var K;
for(K=0;
K<this.nodes.length;
++K){this.nodes[K].index=K;
}for(K=0;
K<this.links.length;
++K){this.links[K].index=K;
}},clone:function(N){var K=new k();
var M=J.isDefined(N)&&N===true;
if(M){K.nodeMap=new g();
K.linkMap=new g();
}var L=new g();
J.forEach(this.nodes,function(P){var O=P.clone();
L.set(P,O);
K.nodes.push(O);
if(M){K.nodeMap.set(O,P);
}});
J.forEach(this.links,function(P){if(L.containsKey(P.source)&&L.containsKey(P.target)){var O=K.addLink(L.get(P.source),L.get(P.target));
if(M){K.linkMap.set(O,P);
}}});
return K;
},linearize:function(K){return k.Utils.linearize(this,K);
},depthFirstTraversal:function(M,K){if(J.isUndefined(M)){throw"You need to supply a starting node.";
}if(J.isUndefined(K)){throw"You need to supply an action.";
}if(!this.hasNode(M)){throw"The given start-node is not part of this graph";
}var L=this.getNode(M);
var N=[];
this._dftIterator(L,K,N);
},_dftIterator:function(P,K,Q){K(P);
Q.push(P);
var M=P.getChildren();
for(var N=0,O=M.length;
N<O;
N++){var L=M[N];
if(c(Q,L)){continue;
}this._dftIterator(L,K,Q);
}},breadthFirstTraversal:function(S,K){if(J.isUndefined(S)){throw"You need to supply a starting node.";
}if(J.isUndefined(K)){throw"You need to supply an action.";
}if(!this.hasNode(S)){throw"The given start-node is not part of this graph";
}var N=this.getNode(S);
var R=new C();
var T=[];
R.enqueue(N);
while(R.length>0){var Q=R.dequeue();
K(Q);
T.push(Q);
var M=Q.getChildren();
for(var O=0,P=M.length;
O<P;
O++){var L=M[O];
if(c(T,L)||c(R,L)){continue;
}R.enqueue(L);
}}},_stronglyConnectedComponents:function(N,U,Q,S,M,V,P){Q.add(U,P);
S.add(U,P);
P++;
V.push(U);
var K=U.getChildren(),T;
for(var O=0,R=K.length;
O<R;
O++){T=K[O];
if(!Q.containsKey(T)){this._stronglyConnectedComponents(N,T,Q,S,M,V,P);
S.add(U,Math.min(S.get(U),S.get(T)));
}else{if(c(V,T)){S.add(U,Math.min(S.get(U),Q.get(T)));
}}}if(S.get(U)===Q.get(U)){var L=[];
do{T=V.pop();
L.push(T);
}while(T!==U);
if(!N||(L.length>1)){M.push(L);
}}},findCycles:function(L){if(J.isUndefined(L)){L=true;
}var N=new g();
var P=new g();
var K=[];
var R=[];
for(var M=0,O=this.nodes.length;
M<O;
M++){var Q=this.nodes[M];
if(N.containsKey(Q)){continue;
}this._stronglyConnectedComponents(L,Q,N,P,K,R,0);
}return K;
},isAcyclic:function(){return J.isEmpty(this.findCycles());
},isSubGraph:function(K){var L=K.linearize();
var M=this.linearize();
return J.all(L,function(N){return c(M,N);
});
},makeAcyclic:function(){if(this.isEmpty()||this.nodes.length<=1||this.links.length<=1){return[];
}if(this.nodes.length==2){var aa=[];
if(this.links.length>1){var Y=this.links[0];
var Z=Y.source;
for(var O=0,T=this.links.length;
O<T;
O++){var V=this.links[O];
if(V.source==Z){continue;
}var ab=V.reverse();
aa.push(ab);
}}return aa;
}var L=this.clone(true);
var X=this.nodes.length;
var Q=new g();
var M=function(N){if(N.outgoing.length===0){return(2-X);
}else{if(N.incoming.length===0){return(X-2);
}else{return N.outgoing.length-N.incoming.length;
}}};
var K=function(at,ar){var N=M(at,X);
if(!ar.containsKey(N)){ar.set(N,[]);
}ar.get(N).push(at);
};
J.forEach(L.nodes,function(N){K(N,Q);
});
var aj=[];
var an=[];
while(L.nodes.length>0){var ag,ak,P;
if(Q.containsKey(2-X)){var am=Q.get(2-X);
while(am.length>0){ak=am.pop();
for(var U=0;
U<ak.links.length;
U++){var al=ak.links[U];
ag=al.getComplement(ak);
P=M(ag,X);
J.remove(Q.get(P),ag);
ag.removeLink(al);
K(ag,Q);
}J.remove(L.nodes,ak);
an.unshift(ak);
}}if(Q.containsKey(X-2)){var ai=Q.get(X-2);
while(ai.length>0){ag=ai.pop();
for(var af=0;
af<ag.links.length;
af++){var ah=ag.links[af];
ak=ah.getComplement(ag);
P=M(ak,X);
J.remove(Q.get(P),ak);
ak.removeLink(ah);
K(ak,Q);
}aj.push(ag);
J.remove(L.nodes,ag);
}}if(L.nodes.length>0){for(var R=X-3;
R>2-X;
R--){if(Q.containsKey(R)&&Q.get(R).length>0){var W=Q.get(R);
var ap=W.pop();
for(var ad=0;
ad<ap.links.length;
ad++){var ae=ap.links[ad];
var ao=ae.getComplement(ap);
P=M(ao,X);
J.remove(Q.get(P),ao);
ao.removeLink(ae);
K(ao,Q);
}aj.push(ap);
J.remove(L.nodes,ap);
break;
}}}}aj=aj.concat(an);
var aq=new g();
for(var S=0;
S<this.nodes.length;
S++){aq.set(L.nodeMap.get(aj[S]),S);
}var ac=[];
J.forEach(this.links,function(N){if(aq.get(N.source)>aq.get(N.target)){N.reverse();
ac.push(N);
}});
return ac;
}});
k.Predefined={EightGraph:function(){return k.Utils.parse(["1->2","2->3","3->4","4->1","3->5","5->6","6->7","7->3"]);
},Mindmap:function(){return k.Utils.parse(["0->1","0->2","0->3","0->4","0->5","1->6","1->7","7->8","2->9","9->10","9->11","3->12","12->13","13->14","4->15","4->16","15->17","15->18","18->19","18->20","14->21","14->22","5->23","23->24","23->25","6->26"]);
},ThreeGraph:function(){return k.Utils.parse(["1->2","2->3","3->1"]);
},BinaryTree:function(K){if(J.isUndefined(K)){K=5;
}return k.Utils.createBalancedTree(K,2);
},Linear:function(K){if(J.isUndefined(K)){K=10;
}return k.Utils.createBalancedTree(K,1);
},Tree:function(K,L){return k.Utils.createBalancedTree(K,L);
},Forest:function(K,L,M){return k.Utils.createBalancedForest(K,L,M);
},Workflow:function(){return k.Utils.parse(["0->1","1->2","2->3","1->4","4->3","3->5","5->6","6->3","6->7","5->4"]);
},Grid:function(P,O){var K=new f.Graph();
if(P<=0&&O<=0){return K;
}for(var L=0;
L<P+1;
L++){var R=null;
for(var M=0;
M<O+1;
M++){var Q=new x(L.toString()+"."+M.toString());
K.addNode(Q);
if(R){K.addLink(R,Q);
}if(L>0){var N=K.getNode((L-1).toString()+"."+M.toString());
K.addLink(N,Q);
}R=Q;
}}return K;
}};
k.Utils={parse:function(L){var R,K=new f.Graph(),Q=L.slice();
for(var M=0,N=Q.length;
M<N;
M++){var P=Q[M];
if(J.isString(P)){if(P.indexOf("->")<0){throw"The link should be specified as 'a->b'.";
}var O=P.split("->");
if(O.length!=2){throw"The link should be specified as 'a->b'.";
}R=new s(O[0],O[1]);
K.addLink(R);
}if(J.isObject(P)){if(!R){throw"Specification found before Link definition.";
}r.deepExtend(R,P);
}}return K;
},linearize:function(L,K){if(J.isUndefined(L)){throw"Expected an instance of a Graph object in slot one.";
}if(J.isUndefined(K)){K=false;
}var O=[];
for(var M=0,N=L.links.length;
M<N;
M++){var P=L.links[M];
O.push(P.source.id+"->"+P.target.id);
if(K){O.push({id:P.id});
}}return O;
},_addShape:function(L,M,K,N){if(J.isUndefined(M)){M=new f.Point(0,0);
}if(J.isUndefined(K)){K=D();
}N=r.deepExtend({width:20,height:20,id:K,radius:10,fill:"#778899",data:"circle",undoable:false,x:M.x,y:M.y},N);
return L.addShape(N);
},_addConnection:function(K,L,N,M){return K.connect(L,N,M);
},createDiagramFromGraph:function(L,O,M,Y){if(J.isUndefined(L)){throw"The diagram surface is undefined.";
}if(J.isUndefined(O)){throw"No graph specification defined.";
}if(J.isUndefined(M)){M=true;
}if(J.isUndefined(Y)){Y=false;
}var ad=L.element.clientWidth||200;
var P=L.element.clientHeight||200;
var U=[],V,Z;
for(var Q=0,S=O.nodes.length;
Q<S;
Q++){V=O.nodes[Q];
var X=V.position;
if(J.isUndefined(X)){if(J.isDefined(V.x)&&J.isDefined(V.y)){X=new A(V.x,V.y);
}else{X=new A(J.randomInteger(10,ad-20),J.randomInteger(10,P-20));
}}var W={};
if(V.id==="0"){}else{if(Y){r.deepExtend(W,{width:Math.random()*150+20,height:Math.random()*80+50,data:"rectangle",fill:{color:"#778899"}});
}}Z=this._addShape(L,X,V.id,W);
var K=Z.bounds();
if(J.isDefined(K)){V.x=K.x;
V.y=K.y;
V.width=K.width;
V.height=K.height;
}U[V.id]=Z;
}for(var N=0;
N<O.links.length;
N++){var T=O.links[N];
var ab=U[T.source.id];
if(J.isUndefined(ab)){continue;
}var ac=U[T.target.id];
if(J.isUndefined(ac)){continue;
}this._addConnection(L,ab,ac,{id:T.id});
}if(M){var R=new L.SpringLayout(L);
R.layoutGraph(O,{limitToView:false});
for(var aa=0;
aa<O.nodes.length;
aa++){V=O.nodes[aa];
Z=U[V.id];
Z.bounds(new E(V.x,V.y,V.width,V.height));
}}},createBalancedTree:function(R,V){if(J.isUndefined(R)){R=3;
}if(J.isUndefined(V)){V=3;
}var L=new f.Graph(),K=-1,Q=[],S;
if(R<=0||V<=0){return L;
}var U=new x((++K).toString());
L.addNode(U);
L.root=U;
Q.push(U);
for(var M=0;
M<R;
M++){S=[];
for(var O=0;
O<Q.length;
O++){var T=Q[O];
for(var P=0;
P<V;
P++){var N=new x((++K).toString());
L.addLink(T,N);
S.push(N);
}}Q=S;
}return L;
},createBalancedForest:function(R,V,X){if(J.isUndefined(R)){R=3;
}if(J.isUndefined(V)){V=3;
}if(J.isUndefined(X)){X=5;
}var L=new f.Graph(),K=-1,Q=[],S;
if(R<=0||V<=0||X<=0){return L;
}for(var W=0;
W<X;
W++){var U=new x((++K).toString());
L.addNode(U);
Q=[U];
for(var M=0;
M<R;
M++){S=[];
for(var O=0;
O<Q.length;
O++){var T=Q[O];
for(var P=0;
P<V;
P++){var N=new x((++K).toString());
L.addLink(T,N);
S.push(N);
}}Q=S;
}}return L;
},createRandomConnectedGraph:function(S,O,N){if(J.isUndefined(S)){S=40;
}if(J.isUndefined(O)){O=4;
}if(J.isUndefined(N)){N=false;
}var L=new f.Graph(),K=-1;
if(S<=0){return L;
}var W=new x((++K).toString());
L.addNode(W);
if(S===1){return L;
}if(S>1){for(var M=1;
M<S;
M++){var T=L.takeRandomNode([],O);
if(!T){break;
}var R=L.addNode(M.toString());
L.addLink(T,R);
}if(!N&&S>1){var U=J.randomInteger(1,S);
for(var V=0;
V<U;
V++){var P=L.takeRandomNode([],O);
var Q=L.takeRandomNode([],O);
if(P&&Q&&!L.areConnected(P,Q)){L.addLink(P,Q);
}}}return L;
}},randomDiagram:function(K,P,N,M,O){var L=r.dataviz.diagram.Graph.Utils.createRandomConnectedGraph(P,N,M);
k.Utils.createDiagramFromGraph(K,L,false,O);
}};
r.deepExtend(f,{init:function(K){r.init(K,f.ui);
},Point:A,Intersect:n,Geometry:j,Rect:E,Size:H,RectAlign:F,Matrix:u,MatrixVector:v,normalVariable:y,randomId:D,Dictionary:g,HashTable:l,Queue:C,Set:G,Node:x,Link:s,Graph:k,PathDefiner:z});
})(window.kendo.jQuery);
})();
(function(){(function(a,aa){var B=window.kendo,o=B.dataviz.diagram,i=B.Class,m=B.deepExtend,M=o.Point,O=o.Rect,I=o.Matrix,ab=o.Utils,z=ab.isNumber,A=ab.isString,J=o.MatrixVector,t=B.geometry,l=B.drawing,n=B.util.defined,y=a.inArray;
var Z="transparent",H={none:"none",arrowStart:"ArrowStart",filledCircle:"FilledCircle",arrowEnd:"ArrowEnd"},s=360,T="start",r="end",ad="width",w="height",ae="x",af="y";
o.Markers=H;
function p(ah,X){var d=this.options;
var Y=false;
var ai,g;
for(var ag=0;
ag<X.length;
ag++){g=X[ag];
ai=ah[g];
if(z(ai)&&d[g]!==ai){d[g]=ai;
Y=true;
}}return Y;
}var R=i.extend({init:function(d,g){this.x=d;
this.y=g;
},toMatrix:function(){return I.scaling(this.x,this.y);
},toString:function(){return B.format("scale({0},{1})",this.x,this.y);
},invert:function(){return new R(1/this.x,1/this.y);
}});
var W=i.extend({init:function(d,g){this.x=d;
this.y=g;
},toMatrixVector:function(){return new J(0,0,0,0,this.x,this.y);
},toMatrix:function(){return I.translation(this.x,this.y);
},toString:function(){return B.format("translate({0},{1})",this.x,this.y);
},plus:function(d){this.x+=d.x;
this.y+=d.y;
},times:function(d){this.x*=d;
this.y*=d;
},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y);
},normalize:function(){if(this.Length===0){return;
}this.times(1/this.length());
},invert:function(){return new W(-this.x,-this.y);
}});
var Q=i.extend({init:function(d,g,X){this.x=g||0;
this.y=X||0;
this.angle=d;
},toString:function(){if(this.x&&this.y){return B.format("rotate({0},{1},{2})",this.angle,this.x,this.y);
}else{return B.format("rotate({0})",this.angle);
}},toMatrix:function(){return I.rotation(this.angle,this.x,this.y);
},center:function(){return new M(this.x,this.y);
},invert:function(){return new Q(s-this.angle,this.x,this.y);
}});
Q.create=function(d){return new Q(d.angle,d.x,d.y);
};
Q.parse=function(X){var Y=X.slice(1,X.length-1).split(","),d=Y[0],ag=Y[1],ah=Y[2];
var g=new Q(d,ag,ah);
return g;
};
var j=i.extend({init:function(ag,ah,X,Y,d,g){this.translate=new W(ag,ah);
if(X!==aa&&Y!==aa){this.scale=new R(X,Y);
}if(d!==aa){this.rotate=g?new Q(d,g.x,g.y):new Q(d);
}},toString:function(){var d=function(g){return g?g.toString():"";
};
return d(this.translate)+d(this.rotate)+d(this.scale);
},render:function(d){d._transform=this;
d._renderTransform();
},toMatrix:function(){var d=I.unit();
if(this.translate){d=d.times(this.translate.toMatrix());
}if(this.rotate){d=d.times(this.rotate.toMatrix());
}if(this.scale){d=d.times(this.scale.toMatrix());
}return d;
},invert:function(){var d=this.rotate?this.rotate.invert():aa,g=d?d.toMatrix():I.unit(),X=this.scale?this.scale.invert():aa,Y=X?X.toMatrix():I.unit();
var ai=new M(-this.translate.x,-this.translate.y);
ai=g.times(Y).apply(ai);
var ah=new W(ai.x,ai.y);
var ag=new j();
ag.translate=ah;
ag.rotate=d;
ag.scale=X;
return ag;
}});
var c={_setScale:function(){var d=this.options;
var X=this._originWidth;
var g=this._originHeight;
var Y=d.width/X;
var ag=d.height/g;
if(!z(Y)){Y=1;
}if(!z(ag)){ag=1;
}this._transform.scale=new R(Y,ag);
},_setTranslate:function(){var d=this.options;
var g=d.x||0;
var X=d.y||0;
this._transform.translate=new W(g,X);
},_initSize:function(){var d=this.options;
var g=false;
if(d.autoSize!==false&&(n(d.width)||n(d.height))){this._measure(true);
this._setScale();
g=true;
}if(n(d.x)||n(d.y)){this._setTranslate();
g=true;
}if(g){this._renderTransform();
}},_updateSize:function(d){var g=false;
if(this.options.autoSize!==false&&this._diffNumericOptions(d,[ad,w])){g=true;
this._measure(true);
this._setScale();
}if(this._diffNumericOptions(d,[ae,af])){g=true;
this._setTranslate();
}if(g){this._renderTransform();
}return g;
}};
var q=i.extend({init:function(g){var d=this;
d.options=m({},d.options,g);
d.id=d.options.id;
d._originSize=O.empty();
d._transform=new j();
},visible:function(d){return this.drawingContainer().visible(d);
},redraw:function(d){if(d&&d.id){this.id=d.id;
}},position:function(g,X){var d=this.options;
if(!n(g)){return new M(d.x,d.y);
}if(n(X)){d.x=g;
d.y=X;
}else{if(g instanceof M){d.x=g.x;
d.y=g.y;
}}this._transform.translate=new W(d.x,d.y);
this._renderTransform();
},rotate:function(d,g){if(n(d)){this._transform.rotate=new Q(d,g.x,g.y);
this._renderTransform();
}return this._transform.rotate||new Q(0);
},drawingContainer:function(){return this.drawingElement;
},_renderTransform:function(){var d=this._transform.toMatrix();
this.drawingContainer().transform(new t.Matrix(d.a,d.b,d.c,d.d,d.e,d.f));
},_hover:function(){},_diffNumericOptions:p,_measure:function(g){var X;
if(!this._measured||g){var d=this._boundingBox()||new t.Rect();
var Y=d.topLeft();
X=new O(Y.x,Y.y,d.width(),d.height());
this._originSize=X;
this._originWidth=X.width;
this._originHeight=X.height;
this._measured=true;
}else{X=this._originSize;
}return X;
},_boundingBox:function(){return this.drawingElement.rawBBox();
}});
var ac=q.extend({init:function(d){q.fn.init.call(this,d);
d=this.options;
d.fill=K(d.fill);
d.stroke=K(d.stroke);
},options:{stroke:{color:"gray",width:1},fill:{color:Z}},fill:function(d,g){this._fill({color:u(d),opacity:g});
},stroke:function(d,X,g){this._stroke({color:u(d),width:X,opacity:g});
},redraw:function(g){if(g){var X=g.stroke;
var d=g.fill;
if(X){this._stroke(K(X));
}if(d){this._fill(K(d));
}q.fn.redraw.call(this,g);
}},_hover:function(ag){var d=this.drawingElement;
var Y=this.options;
var X=Y.hover;
if(X&&X.fill){var g=ag?K(X.fill):Y.fill;
d.fill(g.color,g.opacity);
}},_stroke:function(X){var d=this.options;
m(d,{stroke:X});
X=d.stroke;
var g=null;
if(X.width>0){g={color:X.color,width:X.width,opacity:X.opacity,dashType:X.dashType};
}this.drawingElement.options.set("stroke",g);
},_fill:function(g){var ag=this.options;
m(ag,{fill:g||{}});
var d=ag.fill;
if(d.gradient){var X=d.gradient;
var Y=(X.type==="radial"?l.RadialGradient:l.LinearGradient);
this.drawingElement.fill(new Y(X));
}else{this.drawingElement.fill(d.color,d.opacity);
}}});
var U=ac.extend({init:function(d){this._textColor(d);
ac.fn.init.call(this,d);
this._font();
this._initText();
this._initSize();
},options:{fontSize:15,fontFamily:"sans-serif",stroke:{width:0},fill:{color:"black"},autoSize:true},_initText:function(){var d=this.options;
this.drawingElement=new l.Text(n(d.text)?d.text:"",new t.Point(),{font:d.font});
this._fill();
this._stroke();
},_textColor:function(d){if(d&&d.color){m(d,{fill:{color:d.color}});
}},_font:function(){var d=this.options;
if(d.fontFamily&&n(d.fontSize)){d.font=d.fontSize+"px "+d.fontFamily;
}else{delete d.font;
}},content:function(d){return this.drawingElement.content(d);
},redraw:function(d){if(d){var g=false;
var X=this.options;
this._textColor(d);
ac.fn.redraw.call(this,d);
if(d.fontFamily||n(d.fontSize)){m(X,{fontFamily:d.fontFamily,fontSize:d.fontSize});
this._font();
this.drawingElement.options.set("font",X.font);
g=true;
}if(d.text){this.content(d.text);
g=true;
}if(!this._updateSize(d)&&g){this._initSize();
}}}});
m(U.fn,c);
var P=ac.extend({init:function(d){ac.fn.init.call(this,d);
this._initPath();
this._setPosition();
},_setPosition:function(){var d=this.options;
var g=d.x;
var X=d.y;
if(n(g)||n(X)){this.position(g||0,X||0);
}},redraw:function(d){if(d){ac.fn.redraw.call(this,d);
if(this._diffNumericOptions(d,[ad,w])){this._drawPath();
}if(this._diffNumericOptions(d,[ae,af])){this._setPosition();
}}},_initPath:function(){var d=this.options;
this.drawingElement=new l.Path({stroke:d.stroke,closed:true});
this._fill();
this._drawPath();
},_drawPath:function(){var d=this.drawingElement;
var X=S(this.options);
var Y=X.width;
var g=X.height;
d.segments.elements([k(0,0),k(Y,0),k(Y,g),k(0,g)]);
}});
var F=ac.extend({init:function(g){ac.fn.init.call(this,g);
var d=this.options.anchor;
this.anchor=new t.Point(d.x,d.y);
this.createElement();
},options:{stroke:{color:Z,width:0},fill:{color:"black"}},_transformToPath:function(g,d){var X=d.transform();
if(g&&X){g=g.transformCopy(X);
}return g;
},redraw:function(d){if(d){if(d.position){this.options.position=d.position;
}ac.fn.redraw.call(this,d);
}}});
var h=F.extend({options:{radius:4,anchor:{x:0,y:0}},createElement:function(){var d=this.options;
this.drawingElement=new l.Circle(new t.Circle(this.anchor,d.radius),{fill:d.fill,stroke:d.stroke});
},positionMarker:function(g){var d=this.options;
var Y=d.position;
var ag=g.segments;
var ah;
var X;
if(Y==T){ah=ag[0];
}else{ah=ag[ag.length-1];
}if(ah){X=this._transformToPath(ah.anchor(),g);
this.drawingElement.transform(t.transform().translate(X.x,X.y));
}}});
var b=F.extend({options:{path:"M 0 0 L 10 5 L 0 10 L 3 5 z",anchor:{x:10,y:5}},createElement:function(){var d=this.options;
this.drawingElement=l.Path.parse(d.path,{fill:d.fill,stroke:d.stroke});
},positionMarker:function(X){var Y=this._linePoints(X);
var ag=Y.start;
var g=Y.end;
var ah=t.transform();
if(ag){ah.rotate(E(ag,g),g);
}if(g){var d=this.anchor;
var ai=g.clone().translate(-d.x,-d.y);
ah.translate(ai.x,ai.y);
}this.drawingElement.transform(ah);
},_linePoints:function(Y){var X=this.options;
var ah=Y.segments;
var ai,d,aj;
if(X.position==T){aj=ah[0];
if(aj){d=aj.anchor();
ai=aj.controlOut();
var g=ah[1];
if(!ai&&g){ai=g.anchor();
}}}else{aj=ah[ah.length-1];
if(aj){d=aj.anchor();
ai=aj.controlIn();
var ag=ah[ah.length-2];
if(!ai&&ag){ai=ag.anchor();
}}}if(d){return{start:this._transformToPath(ai,Y),end:this._transformToPath(d,Y)};
}}});
var G={_getPath:function(g){var d=this.drawingElement;
if(d instanceof l.MultiPath){if(g==T){d=d.paths[0];
}else{d=d.paths[d.paths.length-1];
}}if(d&&d.segments.length){return d;
}},_normalizeMarkerOptions:function(g){var X=g.startCap;
var d=g.endCap;
if(A(X)){g.startCap={type:X};
}if(A(d)){g.endCap={type:d};
}},_removeMarker:function(g){var d=this._markers[g];
if(d){this.drawingContainer().remove(d.drawingElement);
delete this._markers[g];
}},_createMarkers:function(){var d=this.options;
this._normalizeMarkerOptions(d);
this._markers={};
this._markers[T]=this._createMarker(d.startCap,T);
this._markers[r]=this._createMarker(d.endCap,r);
},_createMarker:function(X,ag){var ah=(X||{}).type;
var Y=this._getPath(ag);
var g,d;
if(!Y){this._removeMarker(ag);
return;
}if(ah==H.filledCircle){g=h;
}else{if(ah==H.arrowStart||ah==H.arrowEnd){g=b;
}else{this._removeMarker(ag);
}}if(g){d=new g(m({},X,{position:ag}));
d.positionMarker(Y);
this.drawingContainer().append(d.drawingElement);
return d;
}},_positionMarker:function(X){var d=this._markers[X];
if(d){var g=this._getPath(X);
if(g){d.positionMarker(g);
}else{this._removeMarker(X);
}}},_capMap:{start:"startCap",end:"endCap"},_redrawMarker:function(ah,aj,X){this._normalizeMarkerOptions(X);
var ai=this.options;
var d=this._capMap[aj];
var ag=(ai[d]||{}).type;
var Y=X[d];
var g=false;
if(Y){ai[d]=m({},ai[d],Y);
if(Y.type&&ag!=Y.type){this._removeMarker(aj);
this._markers[aj]=this._createMarker(ai[d],aj);
g=true;
}else{if(this._markers[aj]){this._markers[aj].redraw(Y);
}}}else{if(ah&&!this._markers[aj]&&ai[d]){this._markers[aj]=this._createMarker(ai[d],aj);
g=true;
}}return g;
},_redrawMarkers:function(g,d){if(!this._redrawMarker(g,T,d)&&g){this._positionMarker(T);
}if(!this._redrawMarker(g,r,d)&&g){this._positionMarker(r);
}}};
var L=ac.extend({init:function(d){ac.fn.init.call(this,d);
this.container=new l.Group();
this._createElements();
this._initSize();
},options:{autoSize:true},drawingContainer:function(){return this.container;
},data:function(g){var d=this.options;
if(g){if(d.data!=g){d.data=g;
this._setData(g);
this._initSize();
this._redrawMarkers(true,{});
}}else{return d.data;
}},redraw:function(g){if(g){ac.fn.redraw.call(this,g);
var X=this.options;
var d=g.data;
if(n(d)&&X.data!=d){X.data=d;
this._setData(d);
if(!this._updateSize(g)){this._initSize();
}this._redrawMarkers(true,g);
}else{this._updateSize(g);
this._redrawMarkers(false,g);
}}},_createElements:function(){var d=this.options;
this.drawingElement=l.Path.parse(d.data||"",{stroke:d.stroke});
this._fill();
this.container.append(this.drawingElement);
this._createMarkers();
},_setData:function(d){var g=this.drawingElement;
var X=l.Path.parse(d||"");
var Y=X.paths.slice(0);
X.paths.elements([]);
g.paths.elements(Y);
}});
m(L.fn,c);
m(L.fn,G);
var D=ac.extend({init:function(d){ac.fn.init.call(this,d);
this.container=new l.Group();
this._initPath();
this._createMarkers();
},drawingContainer:function(){return this.container;
},redraw:function(g){if(g){g=g||{};
var d=g.from;
var X=g.to;
if(d){this.options.from=d;
}if(X){this.options.to=X;
}if(d||X){this._drawPath();
this._redrawMarkers(true,g);
}else{this._redrawMarkers(false,g);
}ac.fn.redraw.call(this,g);
}},_initPath:function(){var g=this.options;
var d=this.drawingElement=new l.Path({stroke:g.stroke});
this._fill();
this._drawPath();
this.container.append(d);
},_drawPath:function(){var X=this.options;
var d=this.drawingElement;
var g=X.from||new M();
var Y=X.to||new M();
d.segments.elements([k(g.x,g.y),k(Y.x,Y.y)]);
}});
m(D.fn,G);
var N=ac.extend({init:function(d){ac.fn.init.call(this,d);
this.container=new l.Group();
this._initPath();
this._createMarkers();
},drawingContainer:function(){return this.container;
},points:function(g){var d=this.options;
if(g){d.points=g;
this._updatePath();
}else{return d.points;
}},redraw:function(d){if(d){var g=d.points;
ac.fn.redraw.call(this,d);
if(g&&this._pointsDiffer(g)){this.points(g);
this._redrawMarkers(true,d);
}else{this._redrawMarkers(false,d);
}}},_initPath:function(){var d=this.options;
this.drawingElement=new l.Path({stroke:d.stroke});
this._fill();
this.container.append(this.drawingElement);
if(d.points){this._updatePath();
}},_pointsDiffer:function(Y){var d=this.options.points;
var g=d.length!==Y.length;
if(!g){for(var X=0;
X<Y.length;
X++){if(d[X].x!==Y[X].x||d[X].y!==Y[X].y){g=true;
break;
}}}return g;
},_updatePath:function(){var d=this.drawingElement;
var X=this.options;
var ag=X.points;
var ah=[];
var Y;
for(var g=0;
g<ag.length;
g++){Y=ag[g];
ah.push(k(Y.x,Y.y));
}d.segments.elements(ah);
},options:{points:[]}});
m(N.fn,G);
var x=q.extend({init:function(d){q.fn.init.call(this,d);
this._initImage();
},redraw:function(d){if(d){if(d.source){this.drawingElement.src(d.source);
}if(this._diffNumericOptions(d,[ad,w,ae,af])){this.drawingElement.rect(this._rect());
}q.fn.redraw.call(this,d);
}},_initImage:function(){var d=this.options;
var g=this._rect();
this.drawingElement=new l.Image(d.source,g,{});
},_rect:function(){var X=S(this.options);
var d=new t.Point(X.x,X.y);
var g=new t.Size(X.width,X.height);
return new t.Rect(d,g);
}});
var v=q.extend({init:function(d){this.children=[];
q.fn.init.call(this,d);
this.drawingElement=new l.Group();
this._initSize();
},options:{autoSize:false},append:function(d){this.drawingElement.append(d.drawingContainer());
this.children.push(d);
this._childrenChange=true;
},remove:function(d){if(this._remove(d)){this._childrenChange=true;
}},_remove:function(g){var d=y(g,this.children);
if(d>=0){this.drawingElement.removeAt(d);
this.children.splice(d,1);
return true;
}},clear:function(){this.drawingElement.clear();
this.children=[];
this._childrenChange=true;
},toFront:function(X){var g;
for(var d=0;
d<X.length;
d++){g=X[d];
if(this._remove(g)){this.append(g);
}}},toBack:function(d){this._reorderChildren(d,0);
},toIndex:function(g,d){this._reorderChildren(g,d);
},_reorderChildren:function(am,aj){var ag=this.drawingElement;
var g=ag.children.slice(0);
var d=this.children;
var Y=z(aj);
var ah,ai,ak,X,al;
for(ah=0;
ah<am.length;
ah++){al=am[ah];
X=al.drawingContainer();
ai=y(al,d);
if(ai>=0){g.splice(ai,1);
d.splice(ai,1);
ak=Y?aj:aj[ah];
g.splice(ak,0,X);
d.splice(ak,0,al);
}}ag.clear();
ag.append.apply(ag,g);
},redraw:function(d){if(d){if(this._childrenChange){this._childrenChange=false;
if(!this._updateSize(d)){this._initSize();
}}else{this._updateSize(d);
}q.fn.redraw.call(this,d);
}},_boundingBox:function(){var X=this.children;
var d;
var ag,g;
for(var Y=0;
Y<X.length;
Y++){ag=X[Y];
if(ag.visible()&&ag._includeInBBox!==false){g=ag.drawingContainer().clippedBBox(null);
if(g){if(d){d=O.union(d,g);
}else{d=g;
}}}}return d;
}});
m(v.fn,c);
var C=v.extend({init:function(g,d){this.children=[];
q.fn.init.call(this,d);
this.drawingElement=new l.Layout(V(g),d);
this._initSize();
},rect:function(g){if(g){this.drawingElement.rect(V(g));
}else{var d=this.drawingElement.rect();
if(d){return new O(d.origin.x,d.origin.y,d.size.width,d.size.height);
}}},reflow:function(){this.drawingElement.reflow();
},redraw:function(d){B.deepExtend(this.drawingElement.options,d);
v.fn.redraw.call(this,d);
}});
var f=ac.extend({init:function(d){ac.fn.init.call(this,d);
this._initCircle();
this._initSize();
},redraw:function(g){if(g){var d=this.options;
if(g.center){m(d,{center:g.center});
this._center.move(d.center.x,d.center.y);
}if(this._diffNumericOptions(g,["radius"])){this._circle.setRadius(d.radius);
}this._updateSize(g);
ac.fn.redraw.call(this,g);
}},_initCircle:function(){var X=this.options;
var ag=X.width;
var g=X.height;
var Y=X.radius;
if(!n(Y)){if(!n(ag)){ag=g;
}if(!n(g)){g=ag;
}X.radius=Y=Math.min(ag,g)/2;
}var d=X.center||{x:Y,y:Y};
this._center=new t.Point(d.x,d.y);
this._circle=new t.Circle(this._center,Y);
this.drawingElement=new l.Circle(this._circle,{stroke:X.stroke});
this._fill();
}});
m(f.fn,c);
var e=i.extend({init:function(d,g){g=g||{};
this.element=d;
this.surface=l.Surface.create(d,g);
if(B.isFunction(this.surface.translate)){this.translate=this._translate;
}this.drawingElement=new l.Group();
this._viewBox=new O(0,0,g.width,g.height);
this.size(this._viewBox);
},bounds:function(){var d=this.drawingElement.clippedBBox();
return new O(0,0,d.width(),d.height());
},size:function(d){var g=this._viewBox;
if(n(d)){g.width=d.width;
g.height=d.height;
this.surface.setSize(d);
}return{width:g.width,height:g.height};
},_translate:function(g,X){var d=this._viewBox;
if(n(g)&&n(X)){d.x=g;
d.y=X;
this.surface.translate({x:g,y:X});
}return{x:d.x,y:d.y};
},draw:function(){this.surface.draw(this.drawingElement);
},append:function(d){this.drawingElement.append(d.drawingContainer());
return this;
},remove:function(d){this.drawingElement.remove(d.drawingContainer());
},insertBefore:function(){},clear:function(){this.drawingElement.clear();
},destroy:function(d){this.surface.destroy();
if(d){a(this.element).remove();
}}});
function S(d){return{x:d.x||0,y:d.y||0,width:d.width||0,height:d.height||0};
}function K(g){if(g){var d=g;
if(A(d)){d={color:d};
}if(d.color){d.color=u(d.color);
}return d;
}}function u(g){var d;
if(g!=Z){d=new l.Color(g).toHex();
}else{d=g;
}return d;
}function E(g,X){var Y=X.x-g.x;
var ag=X.y-g.y;
var d=B.util.deg(Math.atan2(ag,Y));
return d;
}function k(d,g){return new l.Segment(new t.Point(d,g));
}function V(d){if(d){return new t.Rect([d.x,d.y],[d.width,d.height]);
}}B.deepExtend(o,{init:function(d){B.init(d,o.ui);
},diffNumericOptions:p,Element:q,Scale:R,Translation:W,Rotation:Q,Circle:f,Group:v,Rectangle:P,Canvas:e,Path:L,Layout:C,Line:D,MarkerBase:F,ArrowMarker:b,CircleMarker:h,Polyline:N,CompositeTransform:j,TextBlock:U,Image:x,VisualBase:ac});
})(window.kendo.jQuery);
})();
(function(){(function(a,aE){var R=window.kendo,v=R.dataviz,C=v.diagram,k=R.Class,J=C.Group,ai=C.Rect,aj=C.Rectangle,aG=C.Utils,O=aG.isUndefined,ad=C.Point,j=C.Circle,aw=C.Ticker,w=R.deepExtend,Z=R.ui.Movable,g=R.support.browser,z=R.util.defined,N=a.inArray,ah=a.proxy;
var u={arrow:"default",grip:"pointer",cross:"pointer",add:"pointer",move:"move",select:"pointer",south:"s-resize",east:"e-resize",west:"w-resize",north:"n-resize",rowresize:"row-resize",colresize:"col-resize"},K=10,e="Auto",aA="Top",al="Right",T="Left",f="Bottom",y=10,x=10,F="dragStart",D="drag",E="dragEnd",Q="itemRotate",P="itemBoundsChange",W=5,V=5,X="mouseEnter",Y="mouseLeave",aJ="zoomStart",aI="zoomEnd",ap=-20000,ao=20000,H=0.9,I=0.9300000000000001,aH=5,aC="transparent",ab="pan",am="rotated";
C.Cursors=u;
function au(aK,aL){if(aK.isSelected){if(aL.ctrlKey){aK.select(false);
}}else{aK.diagram.select(aK,{addToSelection:aL.ctrlKey});
}}var ag=R.Class.extend({init:function(aK){this.layoutState=aK;
this.diagram=aK.diagram;
},initState:function(){this.froms=[];
this.tos=[];
this.subjects=[];
function aK(aM,aL){var aN=this.diagram.getShapeById(aM);
if(aN){this.subjects.push(aN);
this.froms.push(aN.bounds().topLeft());
this.tos.push(aL.topLeft());
}}this.layoutState.nodeMap.forEach(aK,this);
},update:function(aL){if(this.subjects.length<=0){return;
}for(var aK=0;
aK<this.subjects.length;
aK++){this.subjects[aK].position(new ad(this.froms[aK].x+(this.tos[aK].x-this.froms[aK].x)*aL,this.froms[aK].y+(this.tos[aK].y-this.froms[aK].y)*aL));
}}});
var S=k.extend({init:function(aM,aL,aK){if(O(aK)){this.animate=false;
}else{this.animate=aK;
}this._initialState=aM;
this._finalState=aL;
this.title="Diagram layout";
},undo:function(){this.setState(this._initialState);
},redo:function(){this.setState(this._finalState);
},setState:function(aL){var aK=aL.diagram;
if(this.animate){aL.linkMap.forEach(function(aO,aP){var aN=aK.getShapeById(aO);
aN.visible(false);
if(aN){aN.points(aP);
}});
var aM=new aw();
aM.addAdapter(new ag(aL));
aM.onComplete(function(){aL.linkMap.forEach(function(aO){var aN=aK.getShapeById(aO);
aN.visible(true);
});
});
aM.play();
}else{aL.nodeMap.forEach(function(aO,aN){var aP=aK.getShapeById(aO);
if(aP){aP.position(aN.topLeft());
}});
aL.linkMap.forEach(function(aO,aP){var aN=aK.getShapeById(aO);
if(aN){aN.points(aP);
}});
}}});
var l=k.extend({init:function(aK){this.units=[];
this.title="Composite unit";
if(aK!==aE){this.units.push(aK);
}},add:function(aK){this.units.push(aK);
},undo:function(){for(var aK=0;
aK<this.units.length;
aK++){this.units[aK].undo();
}},redo:function(){for(var aK=0;
aK<this.units.length;
aK++){this.units[aK].redo();
}}});
var p=k.extend({init:function(aK,aL,aM){this.item=aK;
this._redoSource=aL;
this._redoTarget=aM;
if(z(aL)){this._undoSource=aK.source();
}if(z(aM)){this._undoTarget=aK.target();
}this.title="Connection Editing";
},undo:function(){if(this._undoSource!==aE){this.item._updateConnector(this._undoSource,"source");
}if(this._undoTarget!==aE){this.item._updateConnector(this._undoTarget,"target");
}this.item.updateModel();
},redo:function(){if(this._redoSource!==aE){this.item._updateConnector(this._redoSource,"source");
}if(this._redoTarget!==aE){this.item._updateConnector(this._redoTarget,"target");
}this.item.updateModel();
}});
var o=k.extend({init:function(aK,aL,aM){this.item=aK;
this._undoSource=aL;
this._undoTarget=aM;
this._redoSource=aK.source();
this._redoTarget=aK.target();
this.title="Connection Editing";
},undo:function(){this.item._updateConnector(this._undoSource,"source");
this.item._updateConnector(this._undoTarget,"target");
this.item.updateModel();
},redo:function(){this.item._updateConnector(this._redoSource,"source");
this.item._updateConnector(this._redoTarget,"target");
this.item.updateModel();
}});
var A=k.extend({init:function(aK){this.connection=aK;
this.diagram=aK.diagram;
this.targetConnector=aK.targetConnector;
this.title="Delete connection";
},undo:function(){this.diagram._addConnection(this.connection,false);
},redo:function(){this.diagram.remove(this.connection,false);
}});
var B=k.extend({init:function(aK){this.shape=aK;
this.diagram=aK.diagram;
this.title="Deletion";
},undo:function(){this.diagram._addShape(this.shape,false);
this.shape.select(false);
},redo:function(){this.shape.select(false);
this.diagram.remove(this.shape,false);
}});
var aB=k.extend({init:function(aN,aO,aK){this.shapes=aN;
this.undoStates=aO;
this.title="Transformation";
this.redoStates=[];
this.adorner=aK;
for(var aL=0;
aL<this.shapes.length;
aL++){var aM=this.shapes[aL];
this.redoStates.push(aM.bounds());
}},undo:function(){for(var aK=0;
aK<this.shapes.length;
aK++){var aL=this.shapes[aK];
aL.bounds(this.undoStates[aK]);
if(aL.hasOwnProperty("layout")){aL.layout(aL,this.redoStates[aK],this.undoStates[aK]);
}aL.updateModel();
}if(this.adorner){this.adorner.refreshBounds();
this.adorner.refresh();
}},redo:function(){for(var aK=0;
aK<this.shapes.length;
aK++){var aL=this.shapes[aK];
aL.bounds(this.redoStates[aK]);
if(aL.hasOwnProperty("layout")){aL.layout(aL,this.undoStates[aK],this.redoStates[aK]);
}aL.updateModel();
}if(this.adorner){this.adorner.refreshBounds();
this.adorner.refresh();
}}});
var b=k.extend({init:function(aK,aL){this.connection=aK;
this.diagram=aL;
this.title="New connection";
},undo:function(){this.diagram.remove(this.connection,false);
},redo:function(){this.diagram._addConnection(this.connection,false);
}});
var c=k.extend({init:function(aL,aK){this.shape=aL;
this.diagram=aK;
this.title="New shape";
},undo:function(){this.diagram.deselect();
this.diagram.remove(this.shape,false);
},redo:function(){this.diagram._addShape(this.shape,false);
}});
var ac=k.extend({init:function(aM,aL,aK){this.initial=aM;
this.finalPos=aL;
this.diagram=aK;
this.title="Pan Unit";
},undo:function(){this.diagram.pan(this.initial);
},redo:function(){this.diagram.pan(this.finalPos);
}});
var an=k.extend({init:function(aK,aN,aO){this.shapes=aN;
this.undoRotates=aO;
this.title="Rotation";
this.redoRotates=[];
this.redoAngle=aK._angle;
this.adorner=aK;
this.center=aK._innerBounds.center();
for(var aL=0;
aL<this.shapes.length;
aL++){var aM=this.shapes[aL];
this.redoRotates.push(aM.rotate().angle);
}},undo:function(){var aK,aL;
for(aK=0;
aK<this.shapes.length;
aK++){aL=this.shapes[aK];
aL.rotate(this.undoRotates[aK],this.center,false);
if(aL.hasOwnProperty("layout")){aL.layout(aL);
}aL.updateModel();
}if(this.adorner){this.adorner._initialize();
this.adorner.refresh();
}},redo:function(){var aK,aL;
for(aK=0;
aK<this.shapes.length;
aK++){aL=this.shapes[aK];
aL.rotate(this.redoRotates[aK],this.center,false);
if(aL.hasOwnProperty("layout")){aL.layout(aL);
}aL.updateModel();
}if(this.adorner){this.adorner._initialize();
this.adorner.refresh();
}}});
var ay=k.extend({init:function(aK,aM,aL){this.diagram=aK;
this.indices=aL;
this.items=aM;
this.title="Rotate Unit";
},undo:function(){this.diagram._toIndex(this.items,this.indices);
},redo:function(){this.diagram.toFront(this.items,false);
}});
var ax=k.extend({init:function(aK,aM,aL){this.diagram=aK;
this.indices=aL;
this.items=aM;
this.title="Rotate Unit";
},undo:function(){this.diagram._toIndex(this.items,this.indices);
},redo:function(){this.diagram.toBack(this.items,false);
}});
var aF=R.Observable.extend({init:function(aK){R.Observable.fn.init.call(this,aK);
this.bind(this.events,aK);
this.stack=[];
this.index=0;
this.capacity=100;
},events:["undone","redone"],begin:function(){this.composite=new l();
},cancel:function(){this.composite=aE;
},commit:function(aK){if(this.composite.units.length>0){this._restart(this.composite,aK);
}this.composite=aE;
},addCompositeItem:function(aK){if(this.composite){this.composite.add(aK);
}else{this.add(aK);
}},add:function(aL,aK){this._restart(aL,aK);
},pop:function(){if(this.index>0){this.stack.pop();
this.index--;
}},count:function(){return this.stack.length;
},undo:function(){if(this.index>0){this.index--;
this.stack[this.index].undo();
this.trigger("undone");
}},redo:function(){if(this.stack.length>0&&this.index<this.stack.length){this.stack[this.index].redo();
this.index++;
this.trigger("redone");
}},_restart:function(aK,aL){this.stack.splice(this.index,this.stack.length-this.index);
this.stack.push(aK);
if(aL!==false){this.redo();
}else{this.index++;
}if(this.stack.length>this.capacity){this.stack.splice(0,this.stack.length-this.capacity);
this.index=this.capacity;
}},clear:function(){this.stack=[];
this.index=0;
}});
var G=k.extend({init:function(aK){this.toolService=aK;
},start:function(){},move:function(){},end:function(){},tryActivate:function(){return false;
},getCursor:function(){return u.arrow;
}});
function aa(aK){return aK.ctrlKey===false&&aK.altKey===false&&aK.shiftKey===false;
}function aD(aM,aL){var aK=aM!==false;
if(aM.key&&aM.key!="none"){aK=aL[aM.key+"Key"];
}return aK;
}var aq=G.extend({init:function(aP){var aO=this;
var aM=R.support.mobileOS?I:H;
G.fn.init.call(aO,aP);
var aL=aO.toolService.diagram,aK=aL.canvas;
var aN=aL.scroller=aO.scroller=a(aL.scrollable).kendoMobileScroller({friction:aM,velocityMultiplier:aH,mousewheelScrolling:false,zoom:false,scroll:ah(aO._move,aO)}).data("kendoMobileScroller");
if(aK.translate){aO.movableCanvas=new Z(aK.element);
}var aQ=function(aR,aT,aS){aR.makeVirtual();
aR.virtualSize(aT||ap,aS||ao);
};
aQ(aN.dimensions.x);
aQ(aN.dimensions.y);
aN.disable();
},tryActivate:function(aN,aL){var aO=this.toolService;
var aM=aO.diagram.options.pannable;
var aK=aL.ctrlKey;
if(z(aM.key)){if(!aM.key||aM.key=="none"){aK=aa(aL);
}else{aK=aL[aM.key+"Key"]&&!(aL.ctrlKey&&z(aO.hoveredItem));
}}return aM!==false&&aK&&!z(aO.hoveredAdorner)&&!z(aO._hoveredConnector);
},start:function(){this.scroller.enable();
},move:function(){},_move:function(aK){var aO=this,aM=aO.toolService.diagram,aL=aM.canvas,aN=new ad(aK.scrollLeft,aK.scrollTop);
if(aL.translate){aM._storePan(aN.times(-1));
aO.movableCanvas.moveTo(aN);
aL.translate(aN.x,aN.y);
}else{aN=aN.plus(aM._pan.times(-1));
}aM.trigger(ab,{pan:aN});
},end:function(){this.scroller.disable();
},getCursor:function(){return u.move;
}});
var ae=k.extend({init:function(aK){this.toolService=aK;
},tryActivate:function(){return true;
},start:function(aN,aM){var aP=this.toolService,aK=aP.diagram,aL=aP.hoveredItem,aO=aK.options.selectable;
if(aL){if(aD(aO,aM)){au(aL,aM);
}if(aL.adorner){this.adorner=aL.adorner;
this.handle=this.adorner._hitTest(aN);
}}if(!this.handle){this.handle=aK._resizingAdorner._hitTest(aN);
if(this.handle){this.adorner=aK._resizingAdorner;
}}if(this.adorner){if(!this.adorner.isDragHandle(this.handle)||!aK.trigger(F,{shapes:this.adorner.shapes,connections:[]})){this.adorner.start(aN);
}else{aP.startPoint=aN;
aP.end(aN);
}}},move:function(aK){if(this.adorner){this.adorner.move(this.handle,aK);
if(this.adorner.isDragHandle(this.handle)){this.toolService.diagram.trigger(D,{shapes:this.adorner.shapes,connections:[]});
}}},end:function(aN,aM){var aL=this.toolService.diagram,aO=this.toolService,aK=this.adorner,aP;
if(aK){if(!aK.isDragHandle(this.handle)||!aL.trigger(E,{shapes:aK.shapes,connections:[]})){aP=aK.stop();
if(aP){aL.undoRedoService.add(aP,false);
}}else{aK.cancel();
}}if(aO.hoveredItem){this.toolService.triggerClick({item:aO.hoveredItem,point:aN,meta:aM});
}this.adorner=aE;
this.handle=aE;
},getCursor:function(aK){return this.toolService.hoveredItem?this.toolService.hoveredItem._getCursor(aK):u.arrow;
}});
var ar=k.extend({init:function(aK){this.toolService=aK;
},tryActivate:function(aM,aL){var aN=this.toolService;
var aK=aD(aN.diagram.options.selectable,aL);
return aK&&!z(aN.hoveredItem)&&!z(aN.hoveredAdorner);
},start:function(aL){var aK=this.toolService.diagram;
aK.deselect();
aK.selector.start(aL);
},move:function(aL){var aK=this.toolService.diagram;
aK.selector.move(aL);
},end:function(aN,aM){var aK=this.toolService.diagram,aL=this.toolService.hoveredItem;
var aO=aK.selector.bounds();
if((!aL||!aL.isSelected)&&!aM.ctrlKey){aK.deselect();
}if(!aO.isEmpty()){aK.selectArea(aO);
}aK.selector.end();
},getCursor:function(){return u.arrow;
}});
var r=k.extend({init:function(aK){this.toolService=aK;
this.type="ConnectionTool";
},tryActivate:function(){return this.toolService._hoveredConnector;
},start:function(aO,aN){var aM=this.toolService.diagram,aL=this.toolService._hoveredConnector,aK=aM._createConnection({},aL._c,aO);
if(h(aK)&&!aM.trigger(F,{shapes:[],connections:[aK]})&&aM._addConnection(aK)){this.toolService._connectionManipulation(aK,aL._c.shape,true);
this.toolService._removeHover();
au(this.toolService.activeConnection,aN);
}else{aK.source(null);
this.toolService.end(aO);
}},move:function(aL){var aM=this.toolService;
var aK=aM.activeConnection;
aK.target(aL);
aM.diagram.trigger(D,{shapes:[],connections:[aK]});
return true;
},end:function(aO){var aQ=this.toolService,aM=aQ.diagram,aK=aQ.activeConnection,aN=aQ.hoveredItem,aL=aQ._hoveredConnector,aP;
if(!aK){return;
}if(aL&&aL._c!=aK.sourceConnector){aP=aL._c;
}else{if(aN&&aN instanceof C.Shape){aP=aN.getConnector(e)||aN.getConnector(aO);
}else{aP=aO;
}}aK.target(aP);
if(!aM.trigger(E,{shapes:[],connections:[aK]})){aK.updateModel();
aM._syncConnectionChanges();
}else{aM.remove(aK,false);
aM.undoRedoService.pop();
}aQ._connectionManipulation();
},getCursor:function(){return u.arrow;
}});
var n=k.extend({init:function(aK){this.toolService=aK;
this.type="ConnectionTool";
},tryActivate:function(aO,aN){var aQ=this.toolService,aK=aQ.diagram,aP=aK.options.selectable,aM=aQ.hoveredItem,aL=aD(aP,aN)&&aM&&aM.path&&!(aM.isSelected&&aN.ctrlKey);
if(aL){this._c=aM;
}return aL;
},start:function(aN,aM){var aL=this._c;
au(aL,aM);
var aK=aL.adorner;
if(h(aL)&&aK&&!this.toolService.diagram.trigger(F,{shapes:[],connections:[aL]})){this.handle=aK._hitTest(aN);
aK.start(aN);
}else{this.toolService.startPoint=aN;
this.toolService.end(aN);
}},move:function(aL){var aK=this._c.adorner;
if(h(this._c)&&aK){aK.move(this.handle,aL);
this.toolService.diagram.trigger(D,{shapes:[],connections:[this._c]});
return true;
}},end:function(aO,aN){var aL=this._c;
var aK=aL.adorner;
var aP=this.toolService;
var aM=aP.diagram;
if(aK){aP.triggerClick({item:aL,point:aO,meta:aN});
if(h(aL)){var aQ=aK.stop(aO);
if(!aM.trigger(E,{shapes:[],connections:[aL]})){aM.undoRedoService.add(aQ,false);
aL.updateModel();
aM._syncConnectionChanges();
}else{aQ.undo();
}}}},getCursor:function(){return u.move;
}});
function av(aK,aL){return aL.charCodeAt(0)==aK||aL.toUpperCase().charCodeAt(0)==aK;
}var az=k.extend({init:function(aK){this.diagram=aK;
this.tools=[new aq(this),new n(this),new r(this),new ar(this),new ae(this)];
this.activeTool=aE;
},start:function(aL,aK){aK=w({},aK);
if(this.activeTool){this.activeTool.end(aL,aK);
}this._updateHoveredItem(aL);
this._activateTool(aL,aK);
this.activeTool.start(aL,aK);
this._updateCursor(aL);
this.diagram.focus();
this.startPoint=aL;
return true;
},move:function(aL,aK){aK=w({},aK);
var aM=true;
if(this.activeTool){aM=this.activeTool.move(aL,aK);
}if(aM){this._updateHoveredItem(aL);
}this._updateCursor(aL);
return true;
},end:function(aL,aK){aK=w({},aK);
if(this.activeTool){this.activeTool.end(aL,aK);
}this.activeTool=aE;
this._updateCursor(aL);
return true;
},keyDown:function(aL,aM){var aK=this.diagram;
aM=w({ctrlKey:false,metaKey:false,altKey:false},aM);
if((aM.ctrlKey||aM.metaKey)&&!aM.altKey){if(av(aL,"a")){aK.selectAll();
aK._destroyToolBar();
return true;
}else{if(av(aL,"z")){aK.undo();
aK._destroyToolBar();
return true;
}else{if(av(aL,"y")){aK.redo();
aK._destroyToolBar();
return true;
}else{if(av(aL,"c")){aK.copy();
aK._destroyToolBar();
}else{if(av(aL,"x")){aK.cut();
aK._destroyToolBar();
}else{if(av(aL,"v")){aK.paste();
aK._destroyToolBar();
}else{if(av(aL,"l")){aK.layout();
aK._destroyToolBar();
}else{if(av(aL,"d")){aK._destroyToolBar();
aK.copy();
aK.paste();
}}}}}}}}}else{if(aL===46||aL===8){var aN=this.diagram._triggerRemove(aK.select());
if(aN.length){this.diagram.remove(aN,true);
this.diagram._syncChanges();
this.diagram._destroyToolBar();
}return true;
}else{if(aL===27){this._discardNewConnection();
aK.deselect();
aK._destroyToolBar();
return true;
}}}},wheel:function(aO,aM){var aL=this.diagram,aK=aM.delta,aP=aL.zoom(),aN=aL.options,aR=aN.zoomRate,aQ={point:aO,meta:aM,zoom:aP};
if(aL.trigger(aJ,aQ)){return;
}if(aK<0){aP+=aR;
}else{aP-=aR;
}aP=R.dataviz.round(Math.max(aN.zoomMin,Math.min(aN.zoomMax,aP)),2);
aQ.zoom=aP;
aL.zoom(aP,aQ);
aL.trigger(aI,aQ);
return true;
},setTool:function(aL,aK){aL.toolService=this;
this.tools[aK]=aL;
},triggerClick:function(aK){if(this.startPoint.equals(aK.point)){this.diagram.trigger("click",aK);
}},_discardNewConnection:function(){if(this.newConnection){this.diagram.remove(this.newConnection);
this.newConnection=aE;
}},_activateTool:function(aM,aL){for(var aK=0;
aK<this.tools.length;
aK++){var aN=this.tools[aK];
if(aN.tryActivate(aM,aL)){this.activeTool=aN;
break;
}}},_updateCursor:function(aM){var aL=this.diagram.element;
var aK=this.activeTool?this.activeTool.getCursor(aM):(this.hoveredAdorner?this.hoveredAdorner._getCursor(aM):(this.hoveredItem?this.hoveredItem._getCursor(aM):u.arrow));
aL.css({cursor:aK});
if(g.msie&&g.version==7){aL[0].style.cssText=aL[0].style.cssText;
}},_connectionManipulation:function(aK,aL,aM){this.activeConnection=aK;
this.disabledShape=aL;
if(aM){this.newConnection=this.activeConnection;
}else{this.newConnection=aE;
}},_updateHoveredItem:function(aM){var aL=this._hitTest(aM);
var aK=this.diagram;
if(aL!=this.hoveredItem&&(!this.disabledShape||aL!=this.disabledShape)){if(this.hoveredItem){aK.trigger(Y,{item:this.hoveredItem});
this.hoveredItem._hover(false);
}if(aL&&aL.options.enable){aK.trigger(X,{item:aL});
this.hoveredItem=aL;
this.hoveredItem._hover(true);
}else{this.hoveredItem=aE;
}}},_removeHover:function(){if(this.hoveredItem){this.hoveredItem._hover(false);
this.hoveredItem=aE;
}},_hitTest:function(aO){var aL,aK=this.diagram,aN,aM;
if(this._hoveredConnector){this._hoveredConnector._hover(false);
this._hoveredConnector=aE;
}if(aK._connectorsAdorner._visible){aL=aK._connectorsAdorner._hitTest(aO);
if(aL){return aL;
}}aL=this.diagram._resizingAdorner._hitTest(aO);
if(aL){this.hoveredAdorner=aK._resizingAdorner;
if(aL.x!==0||aL.y!==0){return;
}aL=aE;
}else{this.hoveredAdorner=aE;
}if(!this.activeTool||this.activeTool.type!=="ConnectionTool"){var aP=[];
for(aM=0;
aM<aK._selectedItems.length;
aM++){aN=aK._selectedItems[aM];
if(aN instanceof C.Connection){aP.push(aN);
}}aL=this._hitTestItems(aP,aO);
}return aL||this._hitTestElements(aO);
},_hitTestElements:function(aP){var aM=this.diagram;
var aQ=this._hitTestItems(aM.shapes,aP);
var aK=this._hitTestItems(aM.connections,aP);
var aN;
if((!this.activeTool||this.activeTool.type!="ConnectionTool")&&aQ&&aK&&!L(aQ,aP)){var aO=aM.mainLayer;
var aR=N(aQ.visual,aO.children);
var aL=N(aK.visual,aO.children);
aN=aR>aL?aQ:aK;
}return aN||aQ||aK;
},_hitTestItems:function(aK,aO){var aM,aN,aL;
for(aM=aK.length-1;
aM>=0;
aM--){aN=aK[aM];
aL=aN._hitTest(aO);
if(aL){return aL;
}}}});
var q=R.Class.extend({init:function(){}});
var U=q.extend({init:function(aK){var aL=this;
q.fn.init.call(aL);
this.connection=aK;
},hitTest:function(aK){var aL=this.getBounds().inflate(K);
if(!aL.contains(aK)){return false;
}return C.Geometry.distanceToPolyline(aK,this.connection.allPoints())<K;
},getBounds:function(){var aO=this.connection.allPoints(),aQ=aO[0],aL=aO[aO.length-1],aP=Math.max(aQ.x,aL.x),aN=Math.min(aQ.x,aL.x),aR=Math.min(aQ.y,aL.y),aK=Math.max(aQ.y,aL.y);
for(var aM=1;
aM<aO.length-1;
++aM){aP=Math.max(aP,aO[aM].x);
aN=Math.min(aN,aO[aM].x);
aR=Math.min(aR,aO[aM].y);
aK=Math.max(aK,aO[aM].y);
}return new ai(aN,aR,aP-aN,aK-aR);
}});
var af=U.extend({init:function(aK){var aL=this;
U.fn.init.call(aL);
this.connection=aK;
},route:function(){}});
var i=U.extend({SAME_SIDE_DISTANCE_RATIO:5,init:function(aK){var aL=this;
U.fn.init.call(aL);
this.connection=aK;
},routePoints:function(aN,aK,aM,aO){var aL;
if(aM&&aO){aL=this._connectorPoints(aN,aK,aM,aO);
}else{aL=this._floatingPoints(aN,aK,aM);
}return aL;
},route:function(){var aM=this.connection._resolvedSourceConnector;
var aO=this.connection._resolvedTargetConnector;
var aN=this.connection.sourcePoint();
var aK=this.connection.targetPoint();
var aL=this.routePoints(aN,aK,aM,aO);
this.connection.points(aL);
},_connectorSides:[{name:"Top",axis:"y",boundsPoint:"topLeft",secondarySign:1},{name:"Left",axis:"x",boundsPoint:"topLeft",secondarySign:1},{name:"Bottom",axis:"y",boundsPoint:"bottomRight",secondarySign:-1},{name:"Right",axis:"x",boundsPoint:"bottomRight",secondarySign:-1}],_connectorSide:function(aM,aV){var aQ=aM.position();
var aR=aM.shape.bounds(am);
var aL={topLeft:aR.topLeft(),bottomRight:aR.bottomRight()};
var aU=this._connectorSides;
var aO=R.util.MAX_NUM;
var aT;
var aP;
var aK;
var aS;
for(var aN=0;
aN<aU.length;
aN++){aS=aU[aN];
aK=aS.axis;
aT=Math.round(Math.abs(aQ[aK]-aL[aS.boundsPoint][aK]));
if(aT<aO){aO=aT;
aP=aS;
}else{if(aT===aO&&(aQ[aK]-aV[aK])*aS.secondarySign>(aQ[aP.axis]-aV[aP.axis])*aP.secondarySign){aP=aS;
}}}return aP.name;
},_sameSideDistance:function(aL){var aK=aL.shape.bounds(am);
return Math.min(aK.width,aK.height)/this.SAME_SIDE_DISTANCE_RATIO;
},_connectorPoints:function(aT,aM,aR,aU){var aS=this._connectorSide(aR,aM);
var aV=this._connectorSide(aU,aT);
var aK=aM.x-aT.x;
var aL=aM.y-aT.y;
var aQ=this._sameSideDistance(aR);
var aP=[];
var aN,aO;
if(aS===aA||aS==f){if(aV==aA||aV==f){if(aS==aV){if(aS==aA){aO=Math.min(aT.y,aM.y)-aQ;
}else{aO=Math.max(aT.y,aM.y)+aQ;
}aP=[new ad(aT.x,aO),new ad(aM.x,aO)];
}else{aP=[new ad(aT.x,aT.y+aL/2),new ad(aM.x,aT.y+aL/2)];
}}else{aP=[new ad(aT.x,aM.y)];
}}else{if(aV==T||aV==al){if(aS==aV){if(aS==T){aN=Math.min(aT.x,aM.x)-aQ;
}else{aN=Math.max(aT.x,aM.x)+aQ;
}aP=[new ad(aN,aT.y),new ad(aN,aM.y)];
}else{aP=[new ad(aT.x+aK/2,aT.y),new ad(aT.x+aK/2,aT.y+aL)];
}}else{aP=[new ad(aM.x,aT.y)];
}}return aP;
},_floatingPoints:function(aV,aN,aT){var aU=aT?this._connectorSide(aT,aN):null;
var aK=this._startHorizontal(aV,aN,aU);
var aQ=[aV,aV,aN,aN];
var aL=aN.x-aV.x;
var aM=aN.y-aV.y;
var aP=aQ.length;
var aR;
var aS;
for(var aO=1;
aO<aP-1;
++aO){if(aK){if(aO%2!==0){aR=aL/(aP/2);
aS=0;
}else{aR=0;
aS=aM/((aP-1)/2);
}}else{if(aO%2!==0){aR=0;
aS=aM/(aP/2);
}else{aR=aL/((aP-1)/2);
aS=0;
}}aQ[aO]=new ad(aQ[aO-1].x+aR,aQ[aO-1].y+aS);
}aO--;
if((aK&&(aO%2!==0))||(!aK&&(aO%2===0))){aQ[aP-2]=new ad(aQ[aP-1].x,aQ[aP-2].y);
}else{aQ[aP-2]=new ad(aQ[aP-2].x,aQ[aP-1].y);
}return[aQ[1],aQ[2]];
},_startHorizontal:function(aN,aK,aM){var aL;
if(aM!==null&&(aM===al||aM===T)){aL=true;
}else{aL=Math.abs(aN.x-aK.x)>Math.abs(aN.y-aK.y);
}return aL;
}});
var d=k.extend({init:function(aK,aL){var aM=this;
aM.diagram=aK;
aM.options=w({},aM.options,aL);
aM.visual=new J();
aM.diagram._adorners.push(aM);
},refresh:function(){}});
var m=d.extend({init:function(aK,aM){var aO=this,aL;
aO.connection=aK;
aL=aO.connection.diagram;
aO._ts=aL.toolService;
d.fn.init.call(aO,aL,aM);
var aN=aO.connection.sourcePoint();
var aP=aO.connection.targetPoint();
aO.spVisual=new j(w(aO.options.handles,{center:aN}));
aO.epVisual=new j(w(aO.options.handles,{center:aP}));
aO.visual.append(aO.spVisual);
aO.visual.append(aO.epVisual);
},options:{handles:{}},_getCursor:function(){return u.move;
},start:function(aK){this.handle=this._hitTest(aK);
this.startPoint=aK;
this._initialSource=this.connection.source();
this._initialTarget=this.connection.target();
switch(this.handle){case -1:if(this.connection.targetConnector){this._ts._connectionManipulation(this.connection,this.connection.targetConnector.shape);
}break;
case 1:if(this.connection.sourceConnector){this._ts._connectionManipulation(this.connection,this.connection.sourceConnector.shape);
}break;
}},move:function(aL,aM){switch(aL){case -1:this.connection.source(aM);
break;
case 1:this.connection.target(aM);
break;
default:var aK=aM.minus(this.startPoint);
this.startPoint=aM;
if(!this.connection.sourceConnector){this.connection.source(this.connection.sourcePoint().plus(aK));
}if(!this.connection.targetConnector){this.connection.target(this.connection.targetPoint().plus(aK));
}break;
}this.refresh();
return true;
},stop:function(aL){var aN=this.diagram.toolService,aK=aN.hoveredItem,aM;
if(aN._hoveredConnector){aM=aN._hoveredConnector._c;
}else{if(aK&&aK instanceof C.Shape){aM=aK.getConnector(e)||aK.getConnector(aL);
}else{aM=aL;
}}if(this.handle===-1){this.connection.source(aM);
}else{if(this.handle===1){this.connection.target(aM);
}}this.handle=aE;
this._ts._connectionManipulation();
return new o(this.connection,this._initialSource,this._initialTarget);
},_hitTest:function(aK){var aO=this.connection.sourcePoint(),aQ=this.connection.targetPoint(),aL=this.options.handles.width/2,aM=this.options.handles.height/2,aN=new ai(aO.x,aO.y).inflate(aL,aM),aP=new ai(aQ.x,aQ.y).inflate(aL,aM);
return aN.contains(aK)?-1:(aP.contains(aK)?1:0);
},refresh:function(){this.spVisual.redraw({center:this.diagram.modelToLayer(this.connection.sourcePoint())});
this.epVisual.redraw({center:this.diagram.modelToLayer(this.connection.targetPoint())});
}});
var s=d.extend({init:function(aK,aL){var aM=this;
d.fn.init.call(aM,aK,aL);
aM._refreshHandler=function(aN){if(aN.item==aM.shape){aM.refresh();
}};
},show:function(aN){var aO=this,aM,aL,aK;
aO._visible=true;
aO.shape=aN;
aO.diagram.bind(P,aO._refreshHandler);
aM=aN.connectors.length;
aO.connectors=[];
aO.visual.clear();
for(aL=0;
aL<aM;
aL++){aK=new t(aN.connectors[aL]);
aO.connectors.push(aK);
aO.visual.append(aK.visual);
}aO.visual.visible(true);
aO.refresh();
},destroy:function(){var aK=this;
aK.diagram.unbind(P,aK._refreshHandler);
aK.shape=aE;
aK._visible=aE;
aK.visual.visible(false);
},_hitTest:function(aM){var aK,aL;
for(aL=0;
aL<this.connectors.length;
aL++){aK=this.connectors[aL];
if(aK._hitTest(aM)){aK._hover(true);
this.diagram.toolService._hoveredConnector=aK;
break;
}}},refresh:function(){if(this.shape){var aK=this.shape.bounds();
aK=this.diagram.modelToLayer(aK);
this.visual.position(aK.topLeft());
a.each(this.connectors,function(){this.refresh();
});
}}});
function M(aL,aK){var aM;
if(aL.x==-1&&aL.y==-1){aM=aK.bottomRight();
}else{if(aL.x==1&&aL.y==1){aM=aK.topLeft();
}else{if(aL.x==-1&&aL.y==1){aM=aK.topRight();
}else{if(aL.x==1&&aL.y==-1){aM=aK.bottomLeft();
}else{if(aL.x===0&&aL.y==-1){aM=aK.bottom();
}else{if(aL.x===0&&aL.y==1){aM=aK.top();
}else{if(aL.x==1&&aL.y===0){aM=aK.left();
}else{if(aL.x==-1&&aL.y===0){aM=aK.right();
}}}}}}}}return aM;
}var ak=d.extend({init:function(aK,aL){var aM=this;
d.fn.init.call(aM,aK,aL);
aM._manipulating=false;
aM.map=[];
aM.shapes=[];
aM._initSelection();
aM._createHandles();
aM.redraw();
aM.diagram.bind("select",function(aN){aM._initialize(aN.selected);
});
aM._refreshHandler=function(){if(!aM._internalChange){aM.refreshBounds();
aM.refresh();
}};
aM._rotatedHandler=function(){if(aM.shapes.length==1){aM._angle=aM.shapes[0].rotate().angle;
}aM._refreshHandler();
};
aM.diagram.bind(P,aM._refreshHandler).bind(Q,aM._rotatedHandler);
aM.refreshBounds();
aM.refresh();
},options:{handles:{fill:{color:"#fff"},stroke:{color:"#282828"},height:7,width:7,hover:{fill:{color:"#282828"},stroke:{color:"#282828"}}},selectable:{stroke:{color:"#778899",width:1,dashType:"dash"},fill:{color:aC}},offset:10},_initSelection:function(){var aN=this;
var aK=aN.diagram;
var aM=aK.options.selectable;
var aL=w({},aN.options.selectable,aM);
aN.rect=new aj(aL);
aN.visual.append(aN.rect);
},_resizable:function(){return this.options.editable&&this.options.editable.resize!==false;
},_handleOptions:function(){return(this.options.editable.resize||{}).handles||this.options.handles;
},_createHandles:function(){var aK,aL,aN,aM;
if(this._resizable()){aK=this._handleOptions();
for(aM=-1;
aM<=1;
aM++){for(aN=-1;
aN<=1;
aN++){if((aM!==0)||(aN!==0)){aL=new aj(aK);
aL.drawingElement._hover=ah(this._hover,this);
this.map.push({x:aM,y:aN,visual:aL});
this.visual.append(aL);
}}}}},bounds:function(aK){if(aK){this._innerBounds=aK.clone();
this._bounds=this.diagram.modelToLayer(aK).inflate(this.options.offset,this.options.offset);
}else{return this._bounds;
}},_hitTest:function(aP){var aQ=this.diagram.modelToLayer(aP),aO,aN,aL,aM=this.map.length,aK;
if(this._angle){aQ=aQ.clone().rotate(this._bounds.center(),this._angle);
}if(this._resizable()){for(aO=0;
aO<aM;
aO++){aK=this.map[aO];
aN=new ad(aK.x,aK.y);
aL=this._getHandleBounds(aN);
aL.offset(this._bounds.x,this._bounds.y);
if(aL.contains(aQ)){return aN;
}}}if(this._bounds.contains(aQ)){return new ad(0,0);
}},_getHandleBounds:function(aM){if(this._resizable()){var aL=this._handleOptions(),aO=aL.width,aK=aL.height,aN=new ai(0,0,aO,aK);
if(aM.x<0){aN.x=-aO/2;
}else{if(aM.x===0){aN.x=Math.floor(this._bounds.width/2)-aO/2;
}else{if(aM.x>0){aN.x=this._bounds.width+1-aO/2;
}}}if(aM.y<0){aN.y=-aK/2;
}else{if(aM.y===0){aN.y=Math.floor(this._bounds.height/2)-aK/2;
}else{if(aM.y>0){aN.y=this._bounds.height+1-aK/2;
}}}return aN;
}},_getCursor:function(aM){var aL=this._hitTest(aM);
if(aL&&(aL.x>=-1)&&(aL.x<=1)&&(aL.y>=-1)&&(aL.y<=1)&&this._resizable()){var aK=this._angle;
if(aK){aK=360-aK;
aL.rotate(new ad(0,0),aK);
aL=new ad(Math.round(aL.x),Math.round(aL.y));
}if(aL.x==-1&&aL.y==-1){return"nw-resize";
}if(aL.x==1&&aL.y==1){return"se-resize";
}if(aL.x==-1&&aL.y==1){return"sw-resize";
}if(aL.x==1&&aL.y==-1){return"ne-resize";
}if(aL.x===0&&aL.y==-1){return"n-resize";
}if(aL.x===0&&aL.y==1){return"s-resize";
}if(aL.x==1&&aL.y===0){return"e-resize";
}if(aL.x==-1&&aL.y===0){return"w-resize";
}}return this._manipulating?u.move:u.select;
},_initialize:function(){var aN=this,aK,aL,aM=aN.diagram.select();
aN.shapes=[];
for(aK=0;
aK<aM.length;
aK++){aL=aM[aK];
if(aL instanceof C.Shape){aN.shapes.push(aL);
aL._rotationOffset=new ad();
}}aN._angle=aN.shapes.length==1?aN.shapes[0].rotate().angle:0;
aN._startAngle=aN._angle;
aN._rotates();
aN._positions();
aN.refreshBounds();
aN.refresh();
aN.redraw();
},_rotates:function(){var aM=this,aK,aL;
aM.initialRotates=[];
for(aK=0;
aK<aM.shapes.length;
aK++){aL=aM.shapes[aK];
aM.initialRotates.push(aL.rotate().angle);
}},_positions:function(){var aM=this,aK,aL;
aM.initialStates=[];
for(aK=0;
aK<aM.shapes.length;
aK++){aL=aM.shapes[aK];
aM.initialStates.push(aL.bounds());
}},_hover:function(aP,aK){if(this._resizable()){var aM=this._handleOptions(),aN=aM.hover,aO=aM.stroke,aL=aM.fill;
if(aP&&aG.isDefined(aN.stroke)){aO=w({},aO,aN.stroke);
}if(aP&&aG.isDefined(aN.fill)){aL=aN.fill;
}aK.stroke(aO.color,aO.width,aO.opacity);
aK.fill(aL.color,aL.opacity);
}},start:function(aL){this._sp=aL;
this._cp=aL;
this._lp=aL;
this._manipulating=true;
this._internalChange=true;
this.shapeStates=[];
for(var aK=0;
aK<this.shapes.length;
aK++){var aM=this.shapes[aK];
this.shapeStates.push(aM.bounds());
}},redraw:function(){var aL,aK,aM=this._resizable();
for(aL=0;
aL<this.map.length;
aL++){aK=this.map[aL];
aK.visual.visible(aM);
}},angle:function(aK){if(z(aK)){this._angle=aK;
}return this._angle;
},rotate:function(){var aK=this._innerBounds.center();
var aL=this.angle();
this._internalChange=true;
for(var aM=0;
aM<this.shapes.length;
aM++){var aN=this.shapes[aM];
aL=(aL+this.initialRotates[aM]-this._startAngle)%360;
aN.rotate(aL,aK);
}this.refresh();
},move:function(aS,aX){var aP,aQ,aR=new ad(),aO=new ad(),aL,aM,a0,aT,aK,aU,aN=0,a1,aY,aZ;
if(aS.y===-2&&aS.x===-1){aM=this._innerBounds.center();
this._angle=this._truncateAngle(aG.findAngle(aM,aX));
for(aT=0;
aT<this.shapes.length;
aT++){a0=this.shapes[aT];
aK=(this._angle+this.initialRotates[aT]-this._startAngle)%360;
a0.rotate(aK,aM);
if(a0.hasOwnProperty("layout")){a0.layout(a0);
}this._rotating=true;
}this.refresh();
}else{if(this.shouldSnap()){var a2=this._truncateDistance(aX.minus(this._lp));
if(a2.x===0&&a2.y===0){this._cp=aX;
return;
}aP=a2;
this._lp=new ad(this._lp.x+a2.x,this._lp.y+a2.y);
}else{aP=aX.minus(this._cp);
}if(this.isDragHandle(aS)){aO=aR=aP;
aQ=true;
}else{if(this._angle){aP.rotate(new ad(0,0),this._angle);
}if(aS.x==-1){aR.x=aP.x;
}else{if(aS.x==1){aO.x=aP.x;
}}if(aS.y==-1){aR.y=aP.y;
}else{if(aS.y==1){aO.y=aP.y;
}}}if(!aQ){a1=M(aS,this._innerBounds);
aY=(this._innerBounds.width+aP.x*aS.x)/this._innerBounds.width;
aZ=(this._innerBounds.height+aP.y*aS.y)/this._innerBounds.height;
}for(aT=0;
aT<this.shapes.length;
aT++){a0=this.shapes[aT];
aL=a0.bounds();
if(aQ){if(!h(a0)){continue;
}aU=this._displaceBounds(aL,aR,aO,aQ);
}else{aU=aL.clone();
aU.scale(aY,aZ,a1,this._innerBounds.center(),a0.rotate().angle);
var aV=aU.center();
aV.rotate(aL.center(),-this._angle);
aU=new ai(aV.x-aU.width/2,aV.y-aU.height/2,aU.width,aU.height);
}if(aU.width>=a0.options.minWidth&&aU.height>=a0.options.minHeight){var aW=aL;
a0.bounds(aU);
if(a0.hasOwnProperty("layout")){a0.layout(a0,aW,aU);
}if(aW.width!==aU.width||aW.height!==aU.height){a0.rotate(a0.rotate().angle);
}aN+=1;
}}if(aN){if(aN==aT){aU=this._displaceBounds(this._innerBounds,aR,aO,aQ);
this.bounds(aU);
}else{this.refreshBounds();
}this.refresh();
}this._positions();
}this._cp=aX;
},isDragHandle:function(aK){return aK.x===0&&aK.y===0;
},cancel:function(){var aL=this.shapes;
var aM=this.shapeStates;
for(var aK=0;
aK<aL.length;
aK++){aL[aK].bounds(aM[aK]);
}this.refreshBounds();
this.refresh();
this._manipulating=aE;
this._internalChange=aE;
this._rotating=aE;
},_truncatePositionToGuides:function(aK){if(this.diagram.ruler){return this.diagram.ruler.truncatePositionToGuides(aK);
}return aK;
},_truncateSizeToGuides:function(aK){if(this.diagram.ruler){return this.diagram.ruler.truncateSizeToGuides(aK);
}return aK;
},_truncateAngle:function(aK){var aL=this.snapOptions();
var aM=Math.max(aL.angle||x,V);
return aL?Math.floor((aK%360)/aM)*aM:(aK%360);
},_truncateDistance:function(aK){if(aK instanceof C.Point){return new C.Point(this._truncateDistance(aK.x),this._truncateDistance(aK.y));
}else{var aL=this.snapOptions()||{};
var aM=Math.max(aL.size||y,W);
return aL?Math.floor(aK/aM)*aM:aK;
}},snapOptions:function(){var aK=this.diagram.options.editable;
var aL=((aK||{}).drag||{}).snap||{};
return aL;
},shouldSnap:function(){var aL=this.diagram.options.editable;
var aK=(aL||{}).drag;
var aM=(aK||{}).snap;
return aL!==false&&aK!==false&&aM!==false;
},_displaceBounds:function(aK,aO,aM,aN){var aR=aK.topLeft().plus(aO),aL=aK.bottomRight().plus(aM),aP=ai.fromPoints(aR,aL),aQ;
if(!aN){aQ=aP.center();
aQ.rotate(aK.center(),-this._angle);
aP=new ai(aQ.x-aP.width/2,aQ.y-aP.height/2,aP.width,aP.height);
}return aP;
},stop:function(){var aN,aL,aM;
if(this._cp!=this._sp){if(this._rotating){aN=new an(this,this.shapes,this.initialRotates);
this._rotating=false;
}else{if(this._diffStates()){if(this.diagram.ruler){for(aL=0;
aL<this.shapes.length;
aL++){aM=this.shapes[aL];
var aK=aM.bounds();
aK=this._truncateSizeToGuides(this._truncatePositionToGuides(aK));
aM.bounds(aK);
this.refreshBounds();
this.refresh();
}}for(aL=0;
aL<this.shapes.length;
aL++){aM=this.shapes[aL];
aM.updateModel();
}aN=new aB(this.shapes,this.shapeStates,this);
this.diagram._syncShapeChanges();
}}}this._manipulating=aE;
this._internalChange=aE;
this._rotating=aE;
return aN;
},_diffStates:function(){var aL=this.shapes;
var aM=this.shapeStates;
for(var aK=0;
aK<aL.length;
aK++){if(!aL[aK].bounds().equals(aM[aK])){return true;
}}return false;
},refreshBounds:function(){var aK=this.shapes.length==1?this.shapes[0].bounds().clone():this.diagram.boundingBox(this.shapes,true);
this.bounds(aK);
},refresh:function(){var aN=this,aK,aL;
if(this.shapes.length>0){aL=this.bounds();
this.visual.visible(true);
this.visual.position(aL.topLeft());
a.each(this.map,function(){aK=aN._getHandleBounds(new ad(this.x,this.y));
this.visual.position(aK.topLeft());
});
this.visual.position(aL.topLeft());
var aM=new ad(aL.width/2,aL.height/2);
this.visual.rotate(this._angle,aM);
this.rect.redraw({width:aL.width,height:aL.height});
if(this.rotationThumb){var aO=this.options.editable.rotate.thumb;
this._rotationThumbBounds=new ai(aL.center().x,aL.y+aO.y,0,0).inflate(aO.width);
this.rotationThumb.redraw({x:aL.width/2-aO.width/2});
}}else{this.visual.visible(false);
}}});
var at=k.extend({init:function(aK){var aL=aK.options.selectable;
this.options=w({},this.options,aL);
this.visual=new aj(this.options);
this.diagram=aK;
},options:{stroke:{color:"#778899",width:1,dashType:"dash"},fill:{color:aC}},start:function(aK){this._sp=this._ep=aK;
this.refresh();
this.diagram._adorn(this,true);
},end:function(){this._sp=this._ep=aE;
this.diagram._adorn(this,false);
},bounds:function(aK){if(aK){this._bounds=aK;
}return this._bounds;
},move:function(aK){this._ep=aK;
this.refresh();
},refresh:function(){if(this._sp){var aK=ai.fromPoints(this.diagram.modelToLayer(this._sp),this.diagram.modelToLayer(this._ep));
this.bounds(ai.fromPoints(this._sp,this._ep));
this.visual.position(aK.topLeft());
this.visual.redraw({height:aK.height+1,width:aK.width+1});
}}});
var t=k.extend({init:function(aK){this.options=w({},aK.options);
this._c=aK;
this.visual=new j(this.options);
this.refresh();
},_hover:function(aO){var aM=this.options,aL=aM.hover,aN=aM.stroke,aK=aM.fill;
if(aO&&aG.isDefined(aL.stroke)){aN=w({},aN,aL.stroke);
}if(aO&&aG.isDefined(aL.fill)){aK=aL.fill;
}this.visual.redraw({stroke:aN,fill:aK});
},refresh:function(){var aK=this._c.shape.diagram.modelToView(this._c.position()),aL=aK.minus(this._c.shape.bounds("transformed").topLeft()),aM=new ai(aK.x,aK.y,0,0);
aM.inflate(this.options.width/2,this.options.height/2);
this._visualBounds=aM;
this.visual.redraw({center:new ad(aL.x,aL.y)});
},_hitTest:function(aK){var aL=this._c.shape.diagram.modelToView(aK);
return this._visualBounds.contains(aL);
}});
function h(aL){var aK=aL.options.editable;
return aK&&aK.drag!==false;
}function L(aP,aM){var aK,aN,aO;
for(var aL=0;
aL<aP.connectors.length;
aL++){aK=aP.connectors[aL];
aN=aK.position();
aO=new ai(aN.x,aN.y);
aO.inflate(K,K);
if(aO.contains(aM)){return aK;
}}}w(C,{CompositeUnit:l,TransformUnit:aB,PanUndoUnit:ac,AddShapeUnit:c,AddConnectionUnit:b,DeleteShapeUnit:B,DeleteConnectionUnit:A,ConnectionEditAdorner:m,ConnectionTool:r,ConnectorVisual:t,UndoRedoService:aF,ResizingAdorner:ak,Selector:at,ToolService:az,ConnectorsAdorner:s,LayoutUndoUnit:S,ConnectionEditUnit:p,ToFrontUnit:ay,ToBackUnit:ax,ConnectionRouterBase:q,PolylineRouter:af,CascadingRouter:i,SelectionTool:ar,ScrollerTool:aq,PointerTool:ae,ConnectionEditTool:n,RotateUnit:an});
})(window.kendo.jQuery);
})();
(function(){(function(a,y){var l=window.kendo,e=l.dataviz.diagram,i=e.Graph,q=e.Node,p=e.Link,c=l.deepExtend,u=e.Size,s=e.Rect,g=e.Dictionary,t=e.Set,k=e.Graph,z=e.Utils,r=e.Point,h=1e-06,d=Math.PI/180,b=z.contains,j=a.grep;
var n=l.Class.extend({defaultOptions:{type:"Tree",subtype:"Down",roots:null,animate:false,limitToView:false,friction:0.9,nodeDistance:50,iterations:300,horizontalSeparation:90,verticalSeparation:50,underneathVerticalTopOffset:15,underneathHorizontalOffset:15,underneathVerticalSeparation:15,grid:{width:1500,offsetX:50,offsetY:50,componentSpacingX:20,componentSpacingY:20},layerSeparation:50,layeredIterations:2,startRadialAngle:0,endRadialAngle:360,radialSeparation:150,radialFirstLevelSeparation:200,keepComponentsInOneRadialLayout:false,ignoreContainers:true,layoutContainerChildren:false,ignoreInvisible:true,animateTransitions:false},init:function(){},gridLayoutComponents:function(C){if(!C){throw"No components supplied.";
}z.forEach(C,function(Q){Q.calcBounds();
});
C.sort(function(Q,R){return R.bounds.width-Q.bounds.width;
});
var H=this.options.grid.width,I=this.options.grid.componentSpacingX,J=this.options.grid.componentSpacingY,F=0,M=this.options.grid.offsetX,N=this.options.grid.offsetY,O=M,P=N,G,K=[],L=[];
while(C.length>0){if(O>=H){O=M;
P+=F+J;
F=0;
}var B=C.pop();
this.moveToOffset(B,new r(O,P));
for(G=0;
G<B.nodes.length;
G++){L.push(B.nodes[G]);
}for(G=0;
G<B.links.length;
G++){K.push(B.links[G]);
}var A=B.bounds;
var D=A.height;
if(D<=0||isNaN(D)){D=0;
}var E=A.width;
if(E<=0||isNaN(E)){E=0;
}if(D>=F){F=D;
}O+=E+I;
}return{nodes:L,links:K};
},moveToOffset:function(B,K){var E,F,A=B.bounds,C=K.x-A.x,D=K.y-A.y;
for(E=0;
E<B.nodes.length;
E++){var I=B.nodes[E];
var J=I.bounds();
if(J.width===0&&J.height===0&&J.x===0&&J.y===0){J=new s(0,0,0,0);
}J.x+=C;
J.y+=D;
I.bounds(J);
}for(E=0;
E<B.links.length;
E++){var G=B.links[E];
if(G.points){var H=[];
var L=G.points;
for(F=0;
F<L.length;
F++){var M=L[F];
M.x+=C;
M.y+=D;
H.push(M);
}G.points=H;
}}this.currentHorizontalOffset+=A.width+this.options.grid.offsetX;
return new r(C,D);
},transferOptions:function(A){this.options=l.deepExtend({},this.defaultOptions);
if(z.isUndefined(A)){return;
}this.options=l.deepExtend(this.options,A||{});
}});
var f=l.Class.extend({init:function(A){this.nodeMap=new g();
this.shapeMap=new g();
this.nodes=[];
this.edges=[];
this.edgeMap=new g();
this.finalNodes=[];
this.finalLinks=[];
this.ignoredConnections=[];
this.ignoredShapes=[];
this.hyperMap=new g();
this.hyperTree=new i();
this.finalGraph=null;
this.diagram=A;
},convert:function(A){if(z.isUndefined(this.diagram)){throw"No diagram to convert.";
}this.options=l.deepExtend({ignoreInvisible:true,ignoreContainers:true,layoutContainerChildren:false},A||{});
this.clear();
this._renormalizeShapes();
this._renormalizeConnections();
this.finalNodes=new g(this.nodes);
this.finalLinks=new g(this.edges);
this.finalGraph=new i();
this.finalNodes.forEach(function(B){this.finalGraph.addNode(B);
},this);
this.finalLinks.forEach(function(B){this.finalGraph.addExistingLink(B);
},this);
return this.finalGraph;
},mapConnection:function(A){return this.edgeMap.first(function(B){return b(this.edgeMap.get(B),A);
});
},mapShape:function(E){var C=this.nodeMap.keys();
for(var A=0,D=C.length;
A<D;
A++){var B=C[A];
if(b(this.nodeMap.get(B),E)){return B;
}}},getEdge:function(A,B){return z.first(A.links,function(C){return C.getComplement(A)===B;
});
},clear:function(){this.finalGraph=null;
this.hyperTree=(!this.options.ignoreContainers&&this.options.layoutContainerChildren)?new k():null;
this.hyperMap=(!this.options.ignoreContainers&&this.options.layoutContainerChildren)?new g():null;
this.nodeMap=new g();
this.shapeMap=new g();
this.nodes=[];
this.edges=[];
this.edgeMap=new g();
this.ignoredConnections=[];
this.ignoredShapes=[];
this.finalNodes=[];
this.finalLinks=[];
},listToRoot:function(A){var B=[];
var C=A.container;
if(!C){return B;
}B.push(C);
while(C.parentContainer){C=C.parentContainer;
B.push(C);
}B.reverse();
return B;
},firstNonIgnorableContainer:function(A){if(A.isContainer&&!this._isIgnorableItem(A)){return A;
}return !A.parentContainer?null:this.firstNonIgnorableContainer(A.parentContainer);
},isContainerConnection:function(A,B){if(A.isContainer&&this.isDescendantOf(A,B)){return true;
}return B.isContainer&&this.isDescendantOf(B,A);
},isDescendantOf:function(F,A){if(!F.isContainer){throw"Expecting a container.";
}if(F===A){return false;
}if(b(F.children,A)){return true;
}var C=[];
for(var D=0,E=F.children.length;
D<E;
D++){var B=F.children[D];
if(B.isContainer&&this.isDescendantOf(B,A)){C.push(B);
}}return C.length>0;
},isIgnorableItem:function(A){if(this.options.ignoreInvisible){if(A.isCollapsed&&this._isVisible(A)){return false;
}if(!A.isCollapsed&&this._isVisible(A)){return false;
}return true;
}else{return A.isCollapsed&&!this._isTop(A);
}},isShapeMapped:function(A){return A.isCollapsed&&!this._isVisible(A)&&!this._isTop(A);
},leastCommonAncestor:function(A,C){if(!A){throw"Parameter should not be null.";
}if(!C){throw"Parameter should not be null.";
}if(!this.hyperTree){throw"No hypertree available.";
}var B=this.listToRoot(A);
var D=this.listToRoot(C);
var E=null;
if(z.isEmpty(B)||z.isEmpty(D)){return this.hyperTree.root.data;
}var G=B[0];
var H=D[0];
var F=0;
while(G===H){E=B[F];
F++;
if(F>=B.length||F>=D.length){break;
}G=B[F];
H=D[F];
}if(!E){return this.hyperTree.root.data;
}else{return j(this.hyperTree.nodes,function(I){return I.data.container===E;
});
}},_isTop:function(A){return !A.parentContainer;
},_isVisible:function(A){if(!A.visible()){return false;
}return !A.parentContainer?A.visible():this._isVisible(A.parentContainer);
},_isCollapsed:function(A){if(A.isContainer&&A.isCollapsed){return true;
}return A.parentContainer&&this._isCollapsed(A.parentContainer);
},_renormalizeShapes:function(){if(this.options.ignoreContainers){for(var A=0,B=this.diagram.shapes.length;
A<B;
A++){var D=this.diagram.shapes[A];
if((this.options.ignoreInvisible&&!this._isVisible(D))||D.isContainer){this.ignoredShapes.push(D);
continue;
}var C=new q(D.id,D);
C.isVirtual=false;
this.nodeMap.add(C,[D]);
this.nodes.push(C);
}}else{throw"Containers are not supported yet, but stay tuned.";
}},_renormalizeConnections:function(){if(this.diagram.connections.length===0){return;
}for(var B=0,C=this.diagram.connections.length;
B<C;
B++){var A=this.diagram.connections[B];
if(this.isIgnorableItem(A)){this.ignoredConnections.push(A);
continue;
}var G=!A.sourceConnector?null:A.sourceConnector.shape;
var E=!A.targetConnector?null:A.targetConnector.shape;
if(!G||!E){this.ignoredConnections.push(A);
continue;
}if(b(this.ignoredShapes,G)&&!this.shapeMap.containsKey(G)){this.ignoredConnections.push(A);
continue;
}if(b(this.ignoredShapes,E)&&!this.shapeMap.containsKey(E)){this.ignoredConnections.push(A);
continue;
}if(this.shapeMap.containsKey(G)){G=this.shapeMap[G];
}if(this.shapeMap.containsKey(E)){E=this.shapeMap[E];
}var H=this.mapShape(G);
var F=this.mapShape(E);
if((H===F)||this.areConnectedAlready(H,F)){this.ignoredConnections.push(A);
continue;
}if(H===null||F===null){throw"A shape was not mapped to a node.";
}if(this.options.ignoreContainers){if(H.isVirtual||F.isVirtual){this.ignoredConnections.push(A);
continue;
}var D=new p(H,F,A.id,A);
this.edgeMap.add(D,[A]);
this.edges.push(D);
}else{throw"Containers are not supported yet, but stay tuned.";
}}},areConnectedAlready:function(B,A){return z.any(this.edges,function(C){return C.source===B&&C.target===A||C.source===A&&C.target===B;
});
}});
var v=n.extend({init:function(A){var B=this;
n.fn.init.call(B);
if(z.isUndefined(A)){throw"Diagram is not specified.";
}this.diagram=A;
},layout:function(G){this.transferOptions(G);
var A=new f(this.diagram);
var E=A.convert(G);
if(E.isEmpty()){return;
}var C=E.getConnectedComponents();
if(z.isEmpty(C)){return;
}for(var F=0;
F<C.length;
F++){var B=C[F];
this.layoutGraph(B,G);
}var D=this.gridLayoutComponents(C);
return new e.LayoutState(this.diagram,D);
},layoutGraph:function(A,D){if(z.isDefined(D)){this.transferOptions(D);
}this.graph=A;
var C=this.options.nodeDistance*9;
this.temperature=C;
var B=this._expectedBounds();
this.width=B.width;
this.height=B.height;
for(var E=0;
E<this.options.iterations;
E++){this.refineStage=E>=this.options.iterations*5/6;
this.tick();
this.temperature=this.refineStage?C/30:C*(1-E/(2*this.options.iterations));
}},tick:function(){var A;
for(A=0;
A<this.graph.nodes.length;
A++){this._repulsion(this.graph.nodes[A]);
}for(A=0;
A<this.graph.links.length;
A++){this._attraction(this.graph.links[A]);
}for(A=0;
A<this.graph.nodes.length;
A++){var B=this.graph.nodes[A];
var C=Math.sqrt(B.dx*B.dx+B.dy*B.dy);
if(C===0){return;
}B.x+=Math.min(C,this.temperature)*B.dx/C;
B.y+=Math.min(C,this.temperature)*B.dy/C;
if(this.options.limitToView){B.x=Math.min(this.width,Math.max(B.width/2,B.x));
B.y=Math.min(this.height,Math.max(B.height/2,B.y));
}}},_shake:function(B){var C=Math.random()*this.options.nodeDistance/4;
var A=Math.random()*2*Math.PI;
B.x+=C*Math.cos(A);
B.y-=C*Math.sin(A);
},_InverseSquareForce:function(A,H,G){var D;
if(!this.refineStage){D=Math.pow(A,2)/Math.pow(this.options.nodeDistance,2);
}else{var B=H.x-G.x;
var C=H.y-G.y;
var J=H.width/2;
var F=H.height/2;
var I=G.width/2;
var E=G.height/2;
D=(Math.pow(B,2)/Math.pow(J+I+this.options.nodeDistance,2))+(Math.pow(C,2)/Math.pow(F+E+this.options.nodeDistance,2));
}return D*4/3;
},_SquareForce:function(A,C,B){return 1/this._InverseSquareForce(A,C,B);
},_repulsion:function(A){A.dx=0;
A.dy=0;
z.forEach(this.graph.nodes,function(C){if(C===A){return;
}while(A.x===C.x&&A.y===C.y){this._shake(C);
}var E=A.x-C.x;
var F=A.y-C.y;
var B=Math.sqrt(E*E+F*F);
var D=this._SquareForce(B,A,C)*2;
A.dx+=(E/B)*D;
A.dy+=(F/B)*D;
},this);
},_attraction:function(E){var G=E.target;
var F=E.source;
if(F===G){return;
}while(F.x===G.x&&F.y===G.y){this._shake(G);
}var H=F.x-G.x;
var I=F.y-G.y;
var B=Math.sqrt(H*H+I*I);
var A=this._InverseSquareForce(B,F,G)*5;
var C=(H/B)*A;
var D=(I/B)*A;
G.dx+=C;
G.dy+=D;
F.dx-=C;
F.dy-=D;
},_expectedBounds:function(){var F,D=this.graph.nodes.length,E=1.5,C=4;
if(D===0){return F;
}F=z.fold(this.graph.nodes,function(K,J){var I=J.width*J.height;
if(I>0){K+=Math.sqrt(I);
return K;
}return 0;
},0,this);
var A=F/D;
var G=A*Math.ceil(Math.sqrt(D));
var H=G*Math.sqrt(E);
var B=G/Math.sqrt(E);
return{width:H*C,height:B*C};
}});
var x=l.Class.extend({init:function(A){this.center=null;
this.options=A;
},layout:function(B,A){this.graph=B;
if(!this.graph.nodes||this.graph.nodes.length===0){return;
}if(!b(this.graph.nodes,A)){throw"The given root is not in the graph.";
}this.center=A;
this.graph.cacheRelationships();
this.layoutSwitch();
},layoutLeft:function(C){this.setChildrenDirection(this.center,"Left",false);
this.setChildrenLayout(this.center,"Default",false);
var A=0,G=0,I,B,D;
for(B=0;
B<C.length;
B++){D=C[B];
D.TreeDirection="Left";
var F=this.measure(D,u.Empty);
G=Math.max(G,F.Width);
A+=F.height+this.options.verticalSeparation;
}A-=this.options.verticalSeparation;
var H=this.center.x-this.options.horizontalSeparation;
I=this.center.y+((this.center.height-A)/2);
for(B=0;
B<C.length;
B++){D=C[B];
var E=new r(H-D.Size.width,I);
this.arrange(D,E);
I+=D.Size.height+this.options.verticalSeparation;
}},layoutRight:function(E){this.setChildrenDirection(this.center,"Right",false);
this.setChildrenLayout(this.center,"Default",false);
var A=0,G=0,I,B,C;
for(B=0;
B<E.length;
B++){C=E[B];
C.TreeDirection="Right";
var F=this.measure(C,u.Empty);
G=Math.max(G,F.Width);
A+=F.height+this.options.verticalSeparation;
}A-=this.options.verticalSeparation;
var H=this.center.x+this.options.horizontalSeparation+this.center.width;
I=this.center.y+((this.center.height-A)/2);
for(B=0;
B<E.length;
B++){C=E[B];
var D=new r(H,I);
this.arrange(C,D);
I+=C.Size.height+this.options.verticalSeparation;
}},layoutUp:function(E){this.setChildrenDirection(this.center,"Up",false);
this.setChildrenLayout(this.center,"Default",false);
var F=0,H,B,A;
for(A=0;
A<E.length;
A++){B=E[A];
B.TreeDirection="Up";
var D=this.measure(B,u.Empty);
F+=D.width+this.options.horizontalSeparation;
}F-=this.options.horizontalSeparation;
var G=this.center.x+(this.center.width/2)-(F/2);
for(A=0;
A<E.length;
A++){B=E[A];
H=this.center.y-this.options.verticalSeparation-B.Size.height;
var C=new r(G,H);
this.arrange(B,C);
G+=B.Size.width+this.options.horizontalSeparation;
}},layoutDown:function(A){var C,B;
this.setChildrenDirection(this.center,"Down",false);
this.setChildrenLayout(this.center,"Default",false);
var F=0,H;
for(B=0;
B<A.length;
B++){C=A[B];
C.treeDirection="Down";
var E=this.measure(C,u.Empty);
F+=E.width+this.options.horizontalSeparation;
}F-=this.options.horizontalSeparation;
var G=this.center.x+(this.center.width/2)-(F/2);
H=this.center.y+this.options.verticalSeparation+this.center.height;
for(B=0;
B<A.length;
B++){C=A[B];
var D=new r(G,H);
this.arrange(C,D);
G+=C.Size.width+this.options.horizontalSeparation;
}},layoutRadialTree:function(){this.setChildrenDirection(this.center,"Radial",false);
this.setChildrenLayout(this.center,"Default",false);
this.previousRoot=null;
var B=this.options.startRadialAngle*d;
var A=this.options.endRadialAngle*d;
if(A<=B){throw"Final angle should not be less than the start angle.";
}this.maxDepth=0;
this.origin=new r(this.center.x,this.center.y);
this.calculateAngularWidth(this.center,0);
if(this.maxDepth>0){this.radialLayout(this.center,this.options.radialFirstLevelSeparation,B,A);
}this.center.Angle=A-B;
},tipOverTree:function(A,F){if(z.isUndefined(F)){F=0;
}this.setChildrenDirection(this.center,"Down",false);
this.setChildrenLayout(this.center,"Default",false);
this.setChildrenLayout(this.center,"Underneath",false,F);
var G=0,I,C,B;
for(B=0;
B<A.length;
B++){C=A[B];
C.TreeDirection="Down";
var E=this.measure(C,u.Empty);
G+=E.width+this.options.horizontalSeparation;
}G-=this.options.horizontalSeparation;
G-=A[A.length-1].width;
G+=A[A.length-1].associatedShape.bounds().width;
var H=this.center.x+(this.center.width/2)-(G/2);
I=this.center.y+this.options.verticalSeparation+this.center.height;
for(B=0;
B<A.length;
B++){C=A[B];
var D=new r(H,I);
this.arrange(C,D);
H+=C.Size.width+this.options.horizontalSeparation;
}},calculateAngularWidth:function(H,C){if(C>this.maxDepth){this.maxDepth=C;
}var A=0,I=1000,E=1000,D=C===0?0:Math.sqrt((I*I)+(E*E))/C;
if(H.children.length>0){for(var F=0,G=H.children.length;
F<G;
F++){var B=H.children[F];
A+=this.calculateAngularWidth(B,C+1);
}A=Math.max(D,A);
}else{A=D;
}H.sectorAngle=A;
return A;
},sortChildren:function(J){var B=0,G;
if(J.parents.length>1){throw"Node is not part of a tree.";
}var L=J.parents[0];
if(L){var M=new r(L.x,L.y);
var K=new r(J.x,J.y);
B=this.normalizeAngle(Math.atan2(M.y-K.y,M.x-K.x));
}var F=J.children.length;
if(F===0){return null;
}var A=[];
var H=[];
for(G=0;
G<F;
++G){var C=J.children[G];
var I=new r(C.x,C.y);
H[G]=G;
A[G]=this.normalizeAngle(-B+Math.atan2(I.y-I.y,I.x-I.x));
}z.bisort(A,H);
var E=[];
var D=J.children;
for(G=0;
G<F;
++G){E.push(D[H[G]]);
}return E;
},normalizeAngle:function(A){while(A>Math.PI*2){A-=2*Math.PI;
}while(A<0){A+=Math.PI*2;
}return A;
},radialLayout:function(J,L,N,F){var D=F-N;
var E=D/2;
var K=J.sectorAngle;
var G=0;
var M=this.sortChildren(J);
for(var H=0,I=M.length;
H<I;
H++){var B=M[H];
var C=B;
var A=C.sectorAngle/K;
if(B.children.length>0){this.radialLayout(B,L+this.options.radialSeparation,N+(G*D),N+((G+A)*D));
}this.setPolarLocation(B,L,N+(G*D)+(A*E));
C.angle=A*D;
G+=A;
}},setPolarLocation:function(B,C,A){B.x=this.origin.x+(C*Math.cos(A));
B.y=this.origin.y+(C*Math.sin(A));
B.BoundingRectangle=new s(B.x,B.y,B.width,B.height);
},setChildrenDirection:function(C,A,B){var D=C.treeDirection;
this.graph.depthFirstTraversal(C,function(E){E.treeDirection=A;
});
if(!B){C.treeDirection=D;
}},setChildrenLayout:function(C,B,A,E){if(z.isUndefined(E)){E=0;
}var D=C.childrenLayout;
if(E>0){this.graph.assignLevels(C);
this.graph.depthFirstTraversal(C,function(F){if(F.level>=E+1){F.childrenLayout=B;
}});
}else{this.graph.depthFirstTraversal(C,function(F){F.childrenLayout=B;
});
if(!A){C.childrenLayout=D;
}}},measure:function(F,C){var L=0,D=0,I;
var H=new u(0,0);
if(!F){throw"";
}var A=F.associatedShape.bounds();
var K=A.width;
var J=A.height;
if(F.parents.length!==1){throw"Node not in a spanning tree.";
}var G=F.parents[0];
if(F.treeDirection==="Undefined"){F.treeDirection=G.treeDirection;
}if(z.isEmpty(F.children)){H=new u(Math.abs(K)<h?50:K,Math.abs(J)<h?25:J);
}else{if(F.children.length===1){switch(F.treeDirection){case"Radial":I=this.measure(F.children[0],C);
L=K+(this.options.radialSeparation*Math.cos(F.AngleToParent))+I.width;
D=J+Math.abs(this.options.radialSeparation*Math.sin(F.AngleToParent))+I.height;
break;
case"Left":case"Right":switch(F.childrenLayout){case"TopAlignedWithParent":break;
case"BottomAlignedWithParent":break;
case"Underneath":I=this.measure(F.children[0],C);
L=K+I.width+this.options.underneathHorizontalOffset;
D=J+this.options.underneathVerticalTopOffset+I.height;
break;
case"Default":I=this.measure(F.children[0],C);
L=K+this.options.horizontalSeparation+I.width;
D=Math.max(J,I.height);
break;
default:throw"Unhandled TreeDirection in the Radial layout measuring.";
}break;
case"Up":case"Down":switch(F.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":I=this.measure(F.children[0],C);
L=Math.max(K,I.width+this.options.underneathHorizontalOffset);
D=J+this.options.underneathVerticalTopOffset+I.height;
break;
case"Default":I=this.measure(F.children[0],C);
D=J+this.options.verticalSeparation+I.height;
L=Math.max(K,I.width);
break;
default:throw"Unhandled TreeDirection in the Down layout measuring.";
}break;
default:throw"Unhandled TreeDirection in the layout measuring.";
}H=new u(L,D);
}else{var E,B;
switch(F.treeDirection){case"Left":case"Right":switch(F.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":L=K;
D=J+this.options.underneathVerticalTopOffset;
for(E=0;
E<F.children.length;
E++){B=F.children[E];
I=this.measure(B,C);
L=Math.max(L,I.width+this.options.underneathHorizontalOffset);
D+=I.height+this.options.underneathVerticalSeparation;
}D-=this.options.underneathVerticalSeparation;
break;
case"Default":L=K;
D=0;
for(E=0;
E<F.children.length;
E++){B=F.children[E];
I=this.measure(B,C);
L=Math.max(L,K+this.options.horizontalSeparation+I.width);
D+=I.height+this.options.verticalSeparation;
}D-=this.options.verticalSeparation;
break;
default:throw"Unhandled TreeDirection in the Right layout measuring.";
}break;
case"Up":case"Down":switch(F.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":L=K;
D=J+this.options.underneathVerticalTopOffset;
for(E=0;
E<F.children.length;
E++){B=F.children[E];
I=this.measure(B,C);
L=Math.max(L,I.width+this.options.underneathHorizontalOffset);
D+=I.height+this.options.underneathVerticalSeparation;
}D-=this.options.underneathVerticalSeparation;
break;
case"Default":L=0;
D=0;
for(E=0;
E<F.children.length;
E++){B=F.children[E];
I=this.measure(B,C);
L+=I.width+this.options.horizontalSeparation;
D=Math.max(D,I.height+this.options.verticalSeparation+J);
}L-=this.options.horizontalSeparation;
break;
default:throw"Unhandled TreeDirection in the Down layout measuring.";
}break;
default:throw"Unhandled TreeDirection in the layout measuring.";
}H=new u(L,D);
}}F.SectorAngle=Math.sqrt((L*L/4)+(D*D/4));
F.Size=H;
return H;
},arrange:function(E,G){var D,H,B,F,C,A=E.associatedShape.bounds();
var K=A.width;
var J=A.height;
if(z.isEmpty(E.children)){E.x=G.x;
E.y=G.y;
E.BoundingRectangle=new s(G.x,G.y,K,J);
}else{var L,M;
var I;
switch(E.treeDirection){case"Left":switch(E.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":I=G;
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
M=G.y+J+this.options.underneathVerticalTopOffset;
for(D=0;
D<F.children.length;
D++){F=F.children[D];
L=I.x-F.associatedShape.width-this.options.underneathHorizontalOffset;
H=new r(L,M);
this.arrange(F,H);
M+=F.Size.height+this.options.underneathVerticalSeparation;
}break;
case"Default":I=new r(G.x+E.Size.width-K,G.y+((E.Size.height-J)/2));
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
L=I.x-this.options.horizontalSeparation;
M=G.y;
for(D=0;
D<E.children.length;
D++){F=E.children[D];
H=new r(L-F.Size.width,M);
this.arrange(F,H);
M+=F.Size.height+this.options.verticalSeparation;
}break;
default:throw"Unsupported TreeDirection";
}break;
case"Right":switch(E.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":I=G;
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
L=G.x+K+this.options.underneathHorizontalOffset;
M=G.y+J+this.options.underneathVerticalTopOffset;
for(D=0;
D<E.children.length;
D++){F=E.children[D];
H=new r(L,M);
this.arrange(F,H);
M+=F.Size.height+this.options.underneathVerticalSeparation;
}break;
case"Default":I=new r(G.x,G.y+((E.Size.height-J)/2));
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
L=G.x+K+this.options.horizontalSeparation;
M=G.y;
for(D=0;
D<E.children.length;
D++){F=E.children[D];
H=new r(L,M);
this.arrange(F,H);
M+=F.Size.height+this.options.verticalSeparation;
}break;
default:throw"Unsupported TreeDirection";
}break;
case"Up":I=new r(G.x+((E.Size.width-K)/2),G.y+E.Size.height-J);
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
if(Math.abs(I.x-G.x)<h){C=0;
for(D=0;
D<E.children.length;
D++){B=E.children[D];
C+=B.Size.width+this.options.horizontalSeparation;
}C-=this.options.horizontalSeparation;
L=G.x+((K-C)/2);
}else{L=G.x;
}for(D=0;
D<E.children.length;
D++){F=E.children[D];
M=I.y-this.options.verticalSeparation-F.Size.height;
H=new r(L,M);
this.arrange(F,H);
L+=F.Size.width+this.options.horizontalSeparation;
}break;
case"Down":switch(E.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":I=G;
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
L=G.x+this.options.underneathHorizontalOffset;
M=G.y+J+this.options.underneathVerticalTopOffset;
for(D=0;
D<E.children.length;
D++){F=E.children[D];
H=new r(L,M);
this.arrange(F,H);
M+=F.Size.height+this.options.underneathVerticalSeparation;
}break;
case"Default":I=new r(G.x+((E.Size.width-K)/2),G.y);
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
if(Math.abs(I.x-G.x)<h){C=0;
for(D=0;
D<E.children.length;
D++){B=E.children[D];
C+=B.Size.width+this.options.horizontalSeparation;
}C-=this.options.horizontalSeparation;
L=G.x+((K-C)/2);
}else{L=G.x;
}for(D=0;
D<E.children.length;
D++){F=E.children[D];
M=I.y+this.options.verticalSeparation+J;
H=new r(L,M);
this.arrange(F,H);
L+=F.Size.width+this.options.horizontalSeparation;
}break;
default:throw"Unsupported TreeDirection";
}break;
case"None":break;
default:throw"Unsupported TreeDirection";
}}},layoutSwitch:function(){if(!this.center){return;
}if(z.isEmpty(this.center.children)){return;
}var F=this.options.subtype;
if(z.isUndefined(F)){F="Down";
}var E,D,B,C;
var A=this.center.children;
switch(F.toLowerCase()){case"radial":case"radialtree":this.layoutRadialTree();
break;
case"mindmaphorizontal":case"mindmap":E=this.center.children;
if(this.center.children.length===1){this.layoutRight(E);
}else{C=A.length/2;
D=j(this.center.children,function(G){return z.indexOf(A,G)<C;
});
B=j(this.center.children,function(G){return z.indexOf(A,G)>=C;
});
this.layoutLeft(D);
this.layoutRight(B);
}break;
case"mindmapvertical":E=this.center.children;
if(this.center.children.length===1){this.layoutDown(E);
}else{C=A.length/2;
D=j(this.center.children,function(G){return z.indexOf(A,G)<C;
});
B=j(this.center.children,function(G){return z.indexOf(A,G)>=C;
});
this.layoutUp(D);
this.layoutDown(B);
}break;
case"right":this.layoutRight(this.center.children);
break;
case"left":this.layoutLeft(this.center.children);
break;
case"up":case"bottom":this.layoutUp(this.center.children);
break;
case"down":case"top":this.layoutDown(this.center.children);
break;
case"tipover":case"tipovertree":if(this.options.tipOverTreeStartLevel<0){throw"The tip-over level should be a positive integer.";
}this.tipOverTree(this.center.children,this.options.tipOverTreeStartLevel);
break;
case"undefined":case"none":break;
}}});
var w=n.extend({init:function(A){var B=this;
n.fn.init.call(B);
if(z.isUndefined(A)){throw"No diagram specified.";
}this.diagram=A;
},layout:function(C){this.transferOptions(C);
var A=new f(this.diagram);
this.graph=A.convert();
var B=this.layoutComponents();
return new e.LayoutState(this.diagram,B);
},layoutComponents:function(){if(this.graph.isEmpty()){return;
}var B=this.graph.getConnectedComponents();
if(z.isEmpty(B)){return;
}var D=new x(this.options);
var H=[];
for(var C=0;
C<B.length;
C++){var A=B[C];
var G=this.getTree(A);
if(!G){throw"Failed to find a spanning tree for the component.";
}var E=G.root;
var F=G.tree;
D.layout(F,E);
H.push(F);
}return this.gridLayoutComponents(H);
},getTree:function(B){var G=null;
if(this.options.roots&&this.options.roots.length>0){for(var C=0,E=B.nodes.length;
C<E;
C++){var F=B.nodes[C];
for(var D=0;
D<this.options.roots.length;
D++){var A=this.options.roots[D];
if(A===F.associatedShape){G=F;
break;
}}}}if(!G){G=B.root();
if(!G){throw"Unable to find a root for the tree.";
}}return this.getTreeForRoot(B,G);
},getTreeForRoot:function(A,B){var C=A.getSpanningTree(B);
if(z.isUndefined(C)||C.isEmpty()){return null;
}return{tree:C,root:C.root};
}});
var m=n.extend({init:function(A){var B=this;
n.fn.init.call(B);
if(z.isUndefined(A)){throw"Diagram is not specified.";
}this.diagram=A;
},layout:function(G){this.transferOptions(G);
var A=new f(this.diagram);
var E=A.convert(G);
if(E.isEmpty()){return;
}var C=E.getConnectedComponents();
if(z.isEmpty(C)){return;
}for(var F=0;
F<C.length;
F++){var B=C[F];
this.layoutGraph(B,G);
}var D=this.gridLayoutComponents(C);
return new e.LayoutState(this.diagram,D);
},_initRuntimeProperties:function(){for(var A=0;
A<this.graph.nodes.length;
A++){var B=this.graph.nodes[A];
B.layer=-1;
B.downstreamLinkCount=0;
B.upstreamLinkCount=0;
B.isVirtual=false;
B.uBaryCenter=0;
B.dBaryCenter=0;
B.upstreamPriority=0;
B.downstreamPriority=0;
B.gridPosition=0;
}},_prepare:function(B){var A=[],C,D,H;
for(D=0;
D<B.links.length;
D++){B.links[D].depthOfDumminess=0;
}var G=new g();
z.forEach(B.nodes,function(O){if(O.incoming.length===0){G.set(O,0);
A.push(O);
}});
while(A.length>0){var K=A.shift();
for(C=0;
C<K.outgoing.length;
C++){H=K.outgoing[C];
var N=H.target;
if(G.containsKey(N)){G.set(N,Math.max(G.get(K)+1,G.get(N)));
}else{G.set(N,G.get(K)+1);
}if(!b(A,N)){A.push(N);
}}}var F=0;
G.forEachValue(function(O){F=Math.max(F,O);
});
var M=[];
z.addRange(M,G.keys());
M.sort(function(O,Q){var P=G.get(O);
var R=G.get(Q);
return z.sign(R-P);
});
for(var J=0;
J<M.length;
++J){var L=M[J];
var I=Number.MAX_VALUE;
if(L.outgoing.length===0){continue;
}for(D=0;
D<L.outgoing.length;
++D){H=L.outgoing[D];
I=Math.min(I,G.get(H.target));
}if(I>1){G.set(L,I-1);
}}this.layers=[];
for(C=0;
C<F+1;
C++){this.layers.push([]);
}G.forEach(function(P,O){P.layer=O;
this.layers[O].push(P);
},this);
for(D=0;
D<this.layers.length;
D++){var E=this.layers[D];
for(C=0;
C<E.length;
C++){E[C].gridPosition=C;
}}},layoutGraph:function(A,B){if(z.isUndefined(A)){throw"No graph given or graph analysis of the diagram failed.";
}if(z.isDefined(B)){this.transferOptions(B);
}this.graph=A;
A.setItemIndices();
var C=A.makeAcyclic();
this._initRuntimeProperties();
this._prepare(A,B);
this._dummify();
this._optimizeCrossings();
this._swapPairs();
this.arrangeNodes();
this._moveThingsAround();
this._dedummify();
z.forEach(C,function(D){if(D.points){D.points.reverse();
}});
},setMinDist:function(C,E,D){var B=C.layer;
var A=C.layerIndex;
this.minDistances[B][A]=D;
},getMinDist:function(F,I){var A=0,B=F.layerIndex,C=I.layerIndex,E=F.layer,H=Math.min(B,C),G=Math.max(B,C);
for(var D=H;
D<G;
++D){A+=this.minDistances[E][D];
}return A;
},placeLeftToRight:function(G){var H=new g(),I,L;
for(var A=0;
A<this.layers.length;
++A){var B=G[A];
if(!B){continue;
}for(I=0;
I<B.length;
I++){L=B[I];
if(!H.containsKey(L)){this.placeLeft(L,H,A);
}}var C=Number.POSITIVE_INFINITY;
for(I=0;
I<B.length;
I++){L=B[I];
var M=this.rightSibling(L);
if(M&&this.nodeLeftClass.get(M)!==A){C=Math.min(C,H.get(M)-H.get(L)-this.getMinDist(L,M));
}}if(C===Number.POSITIVE_INFINITY){var E=[];
for(I=0;
I<B.length;
I++){L=B[I];
var K=[];
z.addRange(K,this.upNodes.get(L));
z.addRange(K,this.downNodes.get(L));
for(var F=0;
F<K.length;
F++){var J=K[F];
if(this.nodeLeftClass.get(J)<A){E.push(H.get(J)-H.get(L));
}}}E.sort();
if(E.length===0){C=0;
}else{if(E.length%2===1){C=E[this.intDiv(E.length,2)];
}else{C=(E[this.intDiv(E.length,2)-1]+E[this.intDiv(E.length,2)])/2;
}}}for(I=0;
I<B.length;
I++){L=B[I];
H.set(L,H.get(L)+C);
}}return H;
},placeRightToLeft:function(L){var M=new g(),H,K;
for(var A=0;
A<this.layers.length;
++A){var B=L[A];
if(!B){continue;
}for(H=0;
H<B.length;
H++){K=B[H];
if(!M.containsKey(K)){this.placeRight(K,M,A);
}}var C=Number.NEGATIVE_INFINITY;
for(H=0;
H<B.length;
H++){K=B[H];
var G=this.leftSibling(K);
if(G&&this.nodeRightClass.get(G)!==A){C=Math.max(C,M.get(G)-M.get(K)+this.getMinDist(G,K));
}}if(C===Number.NEGATIVE_INFINITY){var E=[];
for(H=0;
H<B.length;
H++){K=B[H];
var J=[];
z.addRange(J,this.upNodes.get(K));
z.addRange(J,this.downNodes.get(K));
for(var F=0;
F<J.length;
F++){var I=J[F];
if(this.nodeRightClass.get(I)<A){E.push(M.get(K)-M.get(I));
}}}E.sort();
if(E.length===0){C=0;
}else{if(E.length%2===1){C=E[this.intDiv(E.length,2)];
}else{C=(E[this.intDiv(E.length,2)-1]+E[this.intDiv(E.length,2)])/2;
}}}for(H=0;
H<B.length;
H++){K=B[H];
M.set(K,M.get(K)+C);
}}return M;
},_getLeftWing:function(){var A={value:null};
var B=this.computeClasses(A,1);
this.nodeLeftClass=A.value;
return B;
},_getRightWing:function(){var B={value:null};
var A=this.computeClasses(B,-1);
this.nodeRightClass=B.value;
return A;
},computeClasses:function(L,B){var A=0,K=L.value=new g();
for(var E=0;
E<this.layers.length;
++E){A=E;
var F=this.layers[E];
for(var G=B===1?0:F.length-1;
0<=G&&G<F.length;
G+=B){var I=F[G];
if(!K.containsKey(I)){K.set(I,A);
if(I.isVirtual){var H=this._nodesInLink(I);
for(var D=0;
D<H.length;
D++){var J=H[D];
K.set(J,A);
}}}else{A=K.get(I);
}}}var M=[];
for(var C=0;
C<this.layers.length;
C++){M.push(null);
}K.forEach(function(O,N){if(M[N]===null){M[N]=[];
}M[N].push(O);
});
return M;
},_isVerticalLayout:function(){return this.options.subtype.toLowerCase()==="up"||this.options.subtype.toLowerCase()==="down"||this.options.subtype.toLowerCase()==="vertical";
},_isHorizontalLayout:function(){return this.options.subtype.toLowerCase()==="right"||this.options.subtype.toLowerCase()==="left"||this.options.subtype.toLowerCase()==="horizontal";
},_isIncreasingLayout:function(){return this.options.subtype.toLowerCase()==="right"||this.options.subtype.toLowerCase()==="down";
},_moveThingsAround:function(){var G,J,Q,K,P,aa;
for(J=0;
J<this.layers.length;
++J){K=this.layers[J];
K.sort(this._gridPositionComparer);
}this.minDistances=[];
for(J=0;
J<this.layers.length;
++J){K=this.layers[J];
this.minDistances[J]=[];
for(P=0;
P<K.length;
++P){Q=K[P];
Q.layerIndex=P;
this.minDistances[J][P]=this.options.nodeDistance;
if(P<K.length-1){if(this._isVerticalLayout()){this.minDistances[J][P]+=(Q.width+K[P+1].width)/2;
}else{this.minDistances[J][P]+=(Q.height+K[P+1].height)/2;
}}}}this.downNodes=new g();
this.upNodes=new g();
z.forEach(this.graph.nodes,function(ac){this.downNodes.set(ac,[]);
this.upNodes.set(ac,[]);
},this);
z.forEach(this.graph.links,function(ae){var af=ae.source;
var ac=ae.target;
var ad=null,ag=null;
if(af.layer>ac.layer){ad=ae.source;
ag=ae.target;
}else{ag=ae.source;
ad=ae.target;
}this.downNodes.get(ag).push(ad);
this.upNodes.get(ad).push(ag);
},this);
this.downNodes.forEachValue(function(ac){ac.sort(this._gridPositionComparer);
},this);
this.upNodes.forEachValue(function(ac){ac.sort(this._gridPositionComparer);
},this);
for(J=0;
J<this.layers.length-1;
++J){K=this.layers[J];
for(aa=0;
aa<K.length-1;
aa++){var B=K[aa];
if(!B.isVirtual){continue;
}var A=this.downNodes.get(B)[0];
if(!A.isVirtual){continue;
}for(P=aa+1;
P<K.length;
++P){Q=K[P];
if(!Q.isVirtual){continue;
}var D=this.downNodes.get(Q)[0];
if(!D.isVirtual){continue;
}if(A.gridPosition>D.gridPosition){var U=A.gridPosition;
A.gridPosition=D.gridPosition;
D.gridPosition=U;
var H=A.layerIndex;
var I=D.layerIndex;
this.layers[J+1][H]=D;
this.layers[J+1][I]=A;
A.layerIndex=I;
D.layerIndex=H;
}}}}var M=this._getLeftWing();
var W=this._getRightWing();
var N=this.placeLeftToRight(M);
var X=this.placeRightToLeft(W);
var ab=new g();
z.forEach(this.graph.nodes,function(ac){ab.set(ac,(N.get(ac)+X.get(ac))/2);
});
var S=new g();
var T=new g();
for(J=0;
J<this.layers.length;
++J){K=this.layers[J];
var Z=-1,Y=-1;
for(P=0;
P<K.length;
++P){Q=K[P];
S.set(Q,0);
T.set(Q,false);
if(Q.isVirtual){if(Z===-1){Z=P;
}else{if(Z===P-1){Z=P;
}else{Y=P;
S.set(K[Z],0);
if(ab.get(Q)-ab.get(K[Z])===this.getMinDist(K[Z],Q)){T.set(K[Z],true);
}else{T.set(K[Z],false);
}Z=P;
}}}}}var C=[1,-1];
z.forEach(C,function(ac){var ag=ac===1?0:this.layers.length-1;
for(var ad=ag;
0<=ad&&ad<this.layers.length;
ad+=ac){var ae=this.layers[ad];
var ak=this._firstVirtualNode(ae);
var aj=null;
var af=null;
if(ak!==-1){aj=ae[ak];
af=[];
for(G=0;
G<ak;
G++){af.push(ae[G]);
}}else{aj=null;
af=ae;
}if(af.length>0){this._sequencer(ab,null,aj,ac,af);
for(G=0;
G<af.length-1;
++G){this.setMinDist(af[G],af[G+1],ab.get(af[G+1])-ab.get(af[G]));
}if(aj){this.setMinDist(af[af.length-1],aj,ab.get(aj)-ab.get(af[af.length-1]));
}}while(aj){var ah=this.nextVirtualNode(ae,aj);
if(!ah){ak=aj.layerIndex;
af=[];
for(G=ak+1;
G<ae.length;
G++){af.push(ae[G]);
}if(af.length>0){this._sequencer(ab,aj,null,ac,af);
for(G=0;
G<af.length-1;
++G){this.setMinDist(af[G],af[G+1],ab.get(af[G+1])-ab.get(af[G]));
}this.setMinDist(aj,af[0],ab.get(af[0])-ab.get(aj));
}}else{if(S.get(aj)===ac){ak=aj.layerIndex;
var ai=ah.layerIndex;
af=[];
for(G=ak+1;
G<ai;
G++){af.push(ae[G]);
}if(af.length>0){this._sequencer(ab,aj,ah,ac,af);
}T.set(aj,true);
}}aj=ah;
}this.adjustDirections(ad,ac,S,T);
}},this);
var E=this._isIncreasingLayout()?0:this.layers.length-1;
var V=function(ad,ac){if(ac._isIncreasingLayout()){return ad<ac.layers.length;
}else{return ad>=0;
}};
var L=this._isIncreasingLayout()?+1:-1,R=0;
function O(ae,ac){var ad=Number.MIN_VALUE;
for(var af=0;
af<ae.length;
++af){var ag=ae[af];
if(ac._isVerticalLayout()){ad=Math.max(ad,ag.height);
}else{ad=Math.max(ad,ag.width);
}}return ad;
}for(G=E;
V(G,this);
G+=L){K=this.layers[G];
var F=O(K,this);
for(P=0;
P<K.length;
++P){Q=K[P];
if(this._isVerticalLayout()){Q.x=ab.get(Q);
Q.y=R+F/2;
}else{Q.x=R+F/2;
Q.y=ab.get(Q);
}}R+=this.options.layerSeparation+F;
}},adjustDirections:function(I,B,N,P){if(I+B<0||I+B>=this.layers.length){return;
}var Q=null,R=null;
var J=this.layers[I+B];
for(var K=0;
K<J.length;
++K){var L=J[K];
if(L.isVirtual){var M=this.getNeighborOnLayer(L,I);
if(M.isVirtual){if(Q){var O=P.get(R);
var A=this.layers[I];
var D=R.layerIndex;
var E=M.layerIndex;
for(var C=D+1;
C<E;
++C){if(A[C].isVirtual){O=O&&P.get(A[C]);
}}if(O){N.set(Q,B);
var G=Q.layerIndex;
var H=L.layerIndex;
for(var F=G+1;
F<H;
++F){if(J[F].isVirtual){N.set(J[F],B);
}}}}Q=L;
R=M;
}}}},getNeighborOnLayer:function(C,A){var B=this.upNodes.get(C)[0];
if(B.layer===A){return B;
}B=this.downNodes.get(C)[0];
if(B.layer===A){return B;
}return null;
},_sequencer:function(G,F,E,A,C){if(C.length===1){this._sequenceSingle(G,F,E,A,C[0]);
}if(C.length>1){var B=C.length,D=this.intDiv(B,2);
this._sequencer(G,F,E,A,C.slice(0,D));
this._sequencer(G,F,E,A,C.slice(D));
this.combineSequences(G,F,E,A,C);
}},_sequenceSingle:function(G,F,E,A,D){var C=A===-1?this.downNodes.get(D):this.upNodes.get(D);
var B=C.length;
if(B!==0){if(B%2===1){G.set(D,G.get(C[this.intDiv(B,2)]));
}else{G.set(D,(G.get(C[this.intDiv(B,2)-1])+G.get(C[this.intDiv(B,2)]))/2);
}if(F){G.set(D,Math.max(G.get(D),G.get(F)+this.getMinDist(F,D)));
}if(E){G.set(D,Math.min(G.get(D),G.get(E)-this.getMinDist(D,E)));
}}},combineSequences:function(R,Q,P,B,N){var K=N.length,O=this.intDiv(K,2);
var D=[],C,A,G,I,H,J;
for(C=0;
C<O;
++C){A=0;
I=B===-1?this.downNodes.get(N[C]):this.upNodes.get(N[C]);
for(G=0;
G<I.length;
++G){H=I[G];
if(R.get(H)>=R.get(N[C])){A++;
}else{A--;
D.push({k:R.get(H)+this.getMinDist(N[C],N[O-1]),v:2});
}}D.push({k:R.get(N[C])+this.getMinDist(N[C],N[O-1]),v:A});
}if(Q){D.push({k:R.get(Q)+this.getMinDist(Q,N[O-1]),v:Number.MAX_VALUE});
}D.sort(this._positionDescendingComparer);
var L=[];
for(C=O;
C<K;
++C){A=0;
I=B===-1?this.downNodes.get(N[C]):this.upNodes.get(N[C]);
for(G=0;
G<I.length;
++G){H=I[G];
if(R.get(H)<=R.get(N[C])){A++;
}else{A--;
L.push({k:R.get(H)-this.getMinDist(N[C],N[O]),v:2});
}}L.push({k:R.get(N[C])-this.getMinDist(N[C],N[O]),v:A});
}if(P){L.push({k:R.get(P)-this.getMinDist(P,N[O]),v:Number.MAX_VALUE});
}L.sort(this._positionAscendingComparer);
var E=0,M=0;
var F=this.getMinDist(N[O-1],N[O]);
while(R.get(N[O])-R.get(N[O-1])<F){if(E<M){if(D.length===0){R.set(N[O-1],R.get(N[O])-F);
break;
}else{J=D.shift();
E=E+J.v;
R.set(N[O-1],J.k);
R.set(N[O-1],Math.max(R.get(N[O-1]),R.get(N[O])-F));
}}else{if(L.length===0){R.set(N[O],R.get(N[O-1])+F);
break;
}else{J=L.shift();
M=M+J.v;
R.set(N[O],J.k);
R.set(N[O],Math.min(R.get(N[O]),R.get(N[O-1])+F));
}}}for(C=O-2;
C>=0;
C--){R.set(N[C],Math.min(R.get(N[C]),R.get(N[O-1])-this.getMinDist(N[C],N[O-1])));
}for(C=O+1;
C<K;
C++){R.set(N[C],Math.max(R.get(N[C]),R.get(N[O])+this.getMinDist(N[C],N[O])));
}},placeLeft:function(C,B,A){var D=Number.NEGATIVE_INFINITY;
z.forEach(this._getComposite(C),function(F){var E=this.leftSibling(F);
if(E&&this.nodeLeftClass.get(E)===this.nodeLeftClass.get(F)){if(!B.containsKey(E)){this.placeLeft(E,B,A);
}D=Math.max(D,B.get(E)+this.getMinDist(E,F));
}},this);
if(D===Number.NEGATIVE_INFINITY){D=0;
}z.forEach(this._getComposite(C),function(E){B.set(E,D);
});
},placeRight:function(A,D,C){var B=Number.POSITIVE_INFINITY;
z.forEach(this._getComposite(A),function(F){var E=this.rightSibling(F);
if(E&&this.nodeRightClass.get(E)===this.nodeRightClass.get(F)){if(!D.containsKey(E)){this.placeRight(E,D,C);
}B=Math.min(B,D.get(E)-this.getMinDist(F,E));
}},this);
if(B===Number.POSITIVE_INFINITY){B=0;
}z.forEach(this._getComposite(A),function(E){D.set(E,B);
});
},leftSibling:function(C){var A=this.layers[C.layer],B=C.layerIndex;
return B===0?null:A[B-1];
},rightSibling:function(C){var A=this.layers[C.layer];
var B=C.layerIndex;
return B===A.length-1?null:A[B+1];
},_getComposite:function(A){return A.isVirtual?this._nodesInLink(A):[A];
},arrangeNodes:function(){var B,D,G,E,H;
for(D=0;
D<this.layers.length;
D++){E=this.layers[D];
for(G=0;
G<E.length;
G++){H=E[G];
H.upstreamPriority=H.upstreamLinkCount;
H.downstreamPriority=H.downstreamLinkCount;
}}var F=2;
for(var C=0;
C<F;
C++){for(B=this.layers.length-1;
B>=1;
B--){this.layoutLayer(false,B);
}for(B=0;
B<this.layers.length-1;
B++){this.layoutLayer(true,B);
}}var A=Number.MAX_VALUE;
for(D=0;
D<this.layers.length;
D++){E=this.layers[D];
for(G=0;
G<E.length;
G++){H=E[G];
A=Math.min(A,H.gridPosition);
}}if(A<0){for(D=0;
D<this.layers.length;
D++){E=this.layers[D];
for(G=0;
G<E.length;
G++){H=E[G];
H.gridPosition=H.gridPosition-A;
}}}},layoutLayer:function(B,D){var C;
var A;
if(B){A=this.layers[C=D+1];
}else{A=this.layers[C=D-1];
}var F=[];
for(var E=0;
E<A.length;
E++){F.push(A[E]);
}F.sort(function(G,I){var H=(G.upstreamPriority+G.downstreamPriority)/2;
var J=(I.upstreamPriority+I.downstreamPriority)/2;
if(Math.abs(H-J)<0.0001){return 0;
}if(H<J){return 1;
}return -1;
});
z.forEach(F,function(G){var I=G.gridPosition;
var H=this.calcBaryCenter(G);
var J=(G.upstreamPriority+G.downstreamPriority)/2;
if(Math.abs(I-H)<0.0001){return;
}if(Math.abs(I-H)<0.25+0.0001){return;
}if(I<H){while(I<H){if(!this.moveRight(G,A,J)){break;
}I=G.gridPosition;
}}else{while(I>H){if(!this.moveLeft(G,A,J)){break;
}I=G.gridPosition;
}}},this);
if(C>0){this.calcDownData(C-1);
}if(C<this.layers.length-1){this.calcUpData(C+1);
}},moveRight:function(C,B,D){var A=z.indexOf(B,C);
if(A===B.length-1){C.gridPosition=C.gridPosition+0.5;
return true;
}var E=B[A+1];
var F=(E.upstreamPriority+E.downstreamPriority)/2;
if(E.gridPosition>C.gridPosition+1){C.gridPosition=C.gridPosition+0.5;
return true;
}if(F>D||Math.abs(F-D)<0.0001){return false;
}if(this.moveRight(E,B,D)){C.gridPosition=C.gridPosition+0.5;
return true;
}return false;
},moveLeft:function(E,B,F){var A=z.indexOf(B,E);
if(A===0){E.gridPosition=E.gridPosition-0.5;
return true;
}var C=B[A-1];
var D=(C.upstreamPriority+C.downstreamPriority)/2;
if(C.gridPosition<E.gridPosition-1){E.gridPosition=E.gridPosition-0.5;
return true;
}if(D>F||Math.abs(D-F)<0.0001){return false;
}if(this.moveLeft(C,B,F)){E.gridPosition=E.gridPosition-0.5;
return true;
}return false;
},mapVirtualNode:function(B,A){this.nodeToLinkMap.set(B,A);
if(!this.linkToNodeMap.containsKey(A)){this.linkToNodeMap.set(A,[]);
}this.linkToNodeMap.get(A).push(B);
},_nodesInLink:function(A){return this.linkToNodeMap.get(this.nodeToLinkMap.get(A));
},_dummify:function(){this.linkToNodeMap=new g();
this.nodeToLinkMap=new g();
var F,P,J,K,Q,I,D,E,H=this.graph.links.slice(0);
for(E=0;
E<H.length;
E++){var G=H[E];
var L=G.source;
var A=G.target;
var M=L.layer;
var B=A.layer;
var N=L.gridPosition;
var C=A.gridPosition;
var R=(C-N)/Math.abs(B-M);
var O=L;
if(M-B>1){for(D=M-1;
D>B;
D--){J=new q();
J.x=L.x;
J.y=L.y;
J.width=L.width/100;
J.height=L.height/100;
F=this.layers[D];
P=(D-B)*R+N;
if(P>F.length){P=F.length;
}if(N>=this.layers[M].length-1&&C>=this.layers[B].length-1){P=F.length;
}else{if(N===0&&C===0){P=0;
}}J.layer=D;
J.uBaryCenter=0;
J.dBaryCenter=0;
J.upstreamLinkCount=0;
J.downstreamLinkCount=0;
J.gridPosition=P;
J.isVirtual=true;
z.insert(F,J,P);
for(Q=P+1;
Q<F.length;
Q++){K=F[Q];
K.gridPosition=K.gridPosition+1;
}I=new p(O,J);
I.depthOfDumminess=0;
O=J;
this.graph.nodes.push(J);
this.graph.addLink(I);
J.index=this.graph.nodes.length-1;
this.mapVirtualNode(J,G);
}G.changeSource(O);
G.depthOfDumminess=M-B-1;
}if(M-B<-1){for(D=M+1;
D<B;
D++){J=new q();
J.x=L.x;
J.y=L.y;
J.width=L.width/100;
J.height=L.height/100;
F=this.layers[D];
P=(D-M)*R+N;
if(P>F.length){P=F.length;
}if(N>=this.layers[M].length-1&&C>=this.layers[B].length-1){P=F.length;
}else{if(N===0&&C===0){P=0;
}}J.layer=D;
J.uBaryCenter=0;
J.dBaryCenter=0;
J.upstreamLinkCount=0;
J.downstreamLinkCount=0;
J.gridPosition=P;
J.isVirtual=true;
P&=P;
z.insert(F,J,P);
for(Q=P+1;
Q<F.length;
Q++){K=F[Q];
K.gridPosition=K.gridPosition+1;
}I=new p(O,J);
I.depthOfDumminess=0;
O=J;
this.graph.nodes.push(J);
this.graph.addLink(I);
J.index=this.graph.nodes.length-1;
this.mapVirtualNode(J,G);
}G.changeSource(O);
G.depthOfDumminess=B-M-1;
}}},_dedummify:function(){var B=true;
while(B){B=false;
for(var D=0;
D<this.graph.links.length;
D++){var E=this.graph.links[D];
if(E.depthOfDumminess===0){continue;
}var G=[];
G.unshift({x:E.target.x,y:E.target.y});
G.unshift({x:E.source.x,y:E.source.y});
var I=E;
var C=E.depthOfDumminess;
for(var A=0;
A<C;
A++){var F=I.source;
var H=F.incoming[0];
G.unshift({x:H.source.x,y:H.source.y});
I=H;
}E.changeSource(I.source);
E.depthOfDumminess=0;
if(G.length>2){G.splice(0,1);
G.splice(G.length-1);
E.points=G;
}else{E.points=[];
}B=true;
break;
}}},_optimizeCrossings:function(){var D=-1,A;
var C=3;
var B=0;
while(D!==0){if(B++>C){break;
}D=0;
for(A=this.layers.length-1;
A>=1;
A--){D+=this.optimizeLayerCrossings(false,A);
}for(A=0;
A<this.layers.length-1;
A++){D+=this.optimizeLayerCrossings(true,A);
}}},calcUpData:function(D){if(D===0){return;
}var A=this.layers[D],B,C,E;
var J=new t();
var H=this.layers[D-1];
for(B=0;
B<H.length;
B++){J.add(H[B]);
}for(B=0;
B<A.length;
B++){var F=A[B];
var G=0;
var I=0;
for(C=0;
C<F.incoming.length;
C++){E=F.incoming[C];
if(J.contains(E.source)){I++;
G+=E.source.gridPosition;
}}for(C=0;
C<F.outgoing.length;
C++){E=F.outgoing[C];
if(J.contains(E.target)){I++;
G+=E.target.gridPosition;
}}if(I>0){F.uBaryCenter=G/I;
F.upstreamLinkCount=I;
}else{F.uBaryCenter=B;
F.upstreamLinkCount=0;
}}},calcDownData:function(E){if(E===this.layers.length-1){return;
}var A=this.layers[E],C,D,F;
var B=new t();
var I=this.layers[E+1];
for(C=0;
C<I.length;
C++){B.add(I[C]);
}for(C=0;
C<A.length;
C++){var G=A[C];
var H=0;
var J=0;
for(D=0;
D<G.incoming.length;
D++){F=G.incoming[D];
if(B.contains(F.source)){J++;
H+=F.source.gridPosition;
}}for(D=0;
D<G.outgoing.length;
D++){F=G.outgoing[D];
if(B.contains(F.target)){J++;
H+=F.target.gridPosition;
}}if(J>0){G.dBaryCenter=H/J;
G.downstreamLinkCount=J;
}else{G.dBaryCenter=C;
G.downstreamLinkCount=0;
}}},optimizeLayerCrossings:function(B,F){var D;
var A;
if(B){A=this.layers[D=F+1];
}else{A=this.layers[D=F-1];
}var I=A.slice(0);
if(B){this.calcUpData(D);
}else{this.calcDownData(D);
}var J=this;
A.sort(function(L,N){var M=J.calcBaryCenter(L),O=J.calcBaryCenter(N);
if(Math.abs(M-O)<0.0001){if(L.degree()===N.degree()){return J.compareByIndex(L,N);
}else{if(L.degree()<N.degree()){return 1;
}}return -1;
}var K=(O-M)*1000;
if(K>0){return -1;
}else{if(K<0){return 1;
}}return J.compareByIndex(L,N);
});
var C,G=0;
for(C=0;
C<A.length;
C++){if(A[C]!==I[C]){G++;
}}if(G>0){var E=0;
for(C=0;
C<A.length;
C++){var H=A[C];
H.gridPosition=E++;
}}return G;
},_swapPairs:function(){var J=this.options.layeredIterations;
var G=0;
while(true){if(G++>J){break;
}var E=(G%4<=1);
var R=(G%4===1);
for(var H=(E?0:this.layers.length-1);
E?H<=this.layers.length-1:H>=0;
H+=(E?1:-1)){var I=this.layers[H];
var F=false;
var A=true;
var K=0;
for(var L=0;
L<I.length-1;
L++){var S=0;
var D=0;
var C=0;
if(A){if(H!==0){S=this.countLinksCrossingBetweenTwoLayers(H-1,H);
}if(H!==this.layers.length-1){D=this.countLinksCrossingBetweenTwoLayers(H,H+1);
}if(E){S*=2;
}else{D*=2;
}C=S+D;
}else{C=K;
}if(C===0){continue;
}var M=I[L];
var O=I[L+1];
var N=M.gridPosition;
var P=O.gridPosition;
I[L]=O;
I[L+1]=M;
M.gridPosition=P;
O.gridPosition=N;
S=0;
if(H!==0){S=this.countLinksCrossingBetweenTwoLayers(H-1,H);
}D=0;
if(H!==this.layers.length-1){D=this.countLinksCrossingBetweenTwoLayers(H,H+1);
}if(E){S*=2;
}else{D*=2;
}var B=S+D;
var Q=false;
if(R){Q=B>=C;
}else{Q=B>C;
}if(Q){M=I[L];
O=I[L+1];
N=M.gridPosition;
P=O.gridPosition;
I[L]=O;
I[L+1]=M;
M.gridPosition=P;
O.gridPosition=N;
K=C;
A=false;
}else{F=true;
A=true;
}}if(F){if(H!==this.layers.length-1){this.calcUpData(H+1);
}if(H!==0){this.calcDownData(H-1);
}}}}},countLinksCrossingBetweenTwoLayers:function(X,B){var D,A=0;
var Y=new t();
var U=this.layers[X];
for(D=0;
D<U.length;
D++){Y.add(U[D]);
}var K=new t();
var V=this.layers[B];
for(D=0;
D<V.length;
D++){K.add(V[D]);
}var C=new t();
var J=[];
var T=[];
Y.forEach(function(Z){z.addRange(T,Z.incoming);
z.addRange(T,Z.outgoing);
});
for(var W=0;
W<T.length;
W++){var G=T[W];
if(Y.contains(G.source)&&K.contains(G.target)){C.add(G);
J.push(G);
}else{if(K.contains(G.source)&&Y.contains(G.target)){J.push(G);
}}}for(var E=0;
E<J.length;
E++){var H=J[E];
for(var F=0;
F<J.length;
F++){if(E===F){continue;
}var I=J[F];
var L,N;
var P,R;
if(C.contains(H)){L=H.source;
N=H.target;
}else{L=H.target;
N=H.source;
}if(C.contains(I)){P=I.source;
R=I.target;
}else{P=I.target;
R=I.source;
}var M=L.gridPosition;
var O=N.gridPosition;
var Q=P.gridPosition;
var S=R.gridPosition;
if((M-Q)*(O-S)<0){A++;
}}}return A/2;
},calcBaryCenter:function(C){var E=C.upstreamLinkCount;
var B=C.downstreamLinkCount;
var D=C.uBaryCenter;
var A=C.dBaryCenter;
if(E>0&&B>0){return(D+A)/2;
}if(E>0){return D;
}if(B>0){return A;
}return 0;
},_gridPositionComparer:function(A,B){if(A.gridPosition<B.gridPosition){return -1;
}if(A.gridPosition>B.gridPosition){return 1;
}return 0;
},_positionAscendingComparer:function(A,B){return A.k<B.k?-1:A.k>B.k?1:0;
},_positionDescendingComparer:function(A,B){return A.k<B.k?1:A.k>B.k?-1:0;
},_firstVirtualNode:function(B){for(var A=0;
A<B.length;
A++){if(B[A].isVirtual){return A;
}}return -1;
},compareByIndex:function(C,D){var A=C.index;
var B=D.index;
if(A<B){return 1;
}if(A>B){return -1;
}return 0;
},intDiv:function(B,A){return(B-B%A)/A;
},nextVirtualNode:function(B,C){var D=C.layerIndex;
for(var A=D+1;
A<B.length;
++A){if(B[A].isVirtual){return B[A];
}}return null;
}});
var o=l.Class.extend({init:function(A,B){if(z.isUndefined(A)){throw"No diagram given";
}this.diagram=A;
this.nodeMap=new g();
this.linkMap=new g();
this.capture(B?B:A);
},capture:function(C){var G,H,I,D,A,E,F;
if(C instanceof e.Graph){for(D=0;
D<C.nodes.length;
D++){G=C.nodes[D];
I=G.associatedShape;
this.nodeMap.set(I.visual.id,new s(G.x,G.y,G.width,G.height));
}for(D=0;
D<C.links.length;
D++){E=C.links[D];
A=E.associatedConnection;
this.linkMap.set(A.visual.id,E.points());
}}else{if(C instanceof Array){H=C;
for(D=0;
D<H.length;
D++){G=H[D];
I=G.associatedShape;
if(I){this.nodeMap.set(I.visual.id,new s(G.x,G.y,G.width,G.height));
}}}else{if(C.hasOwnProperty("links")&&C.hasOwnProperty("nodes")){H=C.nodes;
F=C.links;
for(D=0;
D<H.length;
D++){G=H[D];
I=G.associatedShape;
if(I){this.nodeMap.set(I.visual.id,new s(G.x,G.y,G.width,G.height));
}}for(D=0;
D<F.length;
D++){E=F[D];
A=E.associatedConnection;
if(A){this.linkMap.set(A.visual.id,E.points);
}}}else{var J=this.diagram.shapes;
var B=this.diagram.connections;
for(D=0;
D<J.length;
D++){I=J[D];
this.nodeMap.set(I.visual.id,I.bounds());
}for(D=0;
D<B.length;
D++){A=B[D];
this.linkMap.set(A.visual.id,A.points());
}}}}}});
c(e,{init:function(A){l.init(A,e.ui);
},SpringLayout:v,TreeLayout:w,GraphAdapter:f,LayeredLayout:m,LayoutBase:n,LayoutState:o});
})(window.kendo.jQuery);
})();
(function(){(function(a,ba){var z=kendo.dataviz,V=kendo.drawing,ad=kendo.geometry,O=z.diagram,bd=kendo.ui.Widget,k=kendo.Class,aP=a.proxy,A=kendo.deepExtend,aa=a.extend,ag=kendo.data.HierarchicalDataSource,f=O.Canvas,ae=O.Group,aT=O.Rectangle,j=O.Circle,p=O.CompositeTransform,aS=O.Rect,aL=O.Path,N=O.DeleteShapeUnit,M=O.DeleteConnectionUnit,a2=O.TextBlock,ah=O.Image,aM=O.Point,al=O.Intersect,s=O.ConnectionEditAdorner,bb=O.UndoRedoService,a5=O.ToolService,aY=O.Selector,aU=O.ResizingAdorner,v=O.ConnectorsAdorner,y=O.Cursors,bc=O.Utils,aJ=kendo.Observable,a3=O.ToBackUnit,a4=O.ToFrontUnit,aN=O.PolylineRouter,h=O.CascadingRouter,at=bc.isUndefined,ao=bc.isDefined,L=kendo.util.defined,am=a.isArray,ap=kendo.isFunction,ar=bc.isString,aq=a.isPlainObject,ax=Math;
var aI=".kendoDiagram",g="cascading",au="itemBoundsChange",i="change",m="click",S="drag",T="dragEnd",U="dragStart",aD="mouseEnter",aE="mouseLeave",Z="error",c="Auto",a6="Top",aV="Right",aw="Left",d="Bottom",az=9007199254740992,aX="select",av="itemRotate",aK="pan",bi="zoomStart",bh="zoomEnd",aH="none",C=600,B=600,I="rectangle",J=100,E=100,G=20,F=20,H=0,D="Yellow",ay=Number.MAX_VALUE,aA=-Number.MAX_VALUE,b="absolute",a7="transformed",aW="rotated",a9="transparent",be="width",af="height",bf="x",bg="y",aF="DOMMouseScroll"+aI+" mousewheel"+aI,aC=0.05,aB=5,e='<a class="k-button k-button-icontext #=className#" href="\\#"><span class="#=iconClass# #=imageClass#"></span>#=text#</a>',r=5;
O.DefaultConnectors=[{name:a6},{name:d},{name:aw},{name:aV},{name:c,position:function(X){return X.getPosition("center");
}}];
var K={cancel:{text:"Cancel",imageClass:"k-cancel",className:"k-diagram-cancel",iconClass:"k-icon"},update:{text:"Update",imageClass:"k-update",className:"k-diagram-update",iconClass:"k-icon"}};
O.shapeDefaults=function(Y){var X={type:I,path:"",autoSize:true,visual:null,x:H,y:H,minWidth:G,minHeight:F,width:J,height:E,hover:{},editable:{connect:true,tools:[]},connectors:O.DefaultConnectors,rotation:{angle:0}};
bc.simpleExtend(X,Y);
return X;
};
function aG(Y){var bj=Y.originalEvent,X=0;
if(bj.wheelDelta){X=-bj.wheelDelta/40;
X=X>0?ax.ceil(X):ax.floor(X);
}else{if(bj.detail){X=bj.detail;
}}return X;
}function an(X){return X.options.name.toLowerCase()===c.toLowerCase();
}function o(bm,bo){var bl=az,bn,Y=bo.connectors;
for(var bk=0;
bk<Y.length;
bk++){var X=Y[bk];
if(!an(X)){var bj=bm.distanceTo(X.position());
if(bj<bl){bl=bj;
bn=X;
}}}return bn;
}function ak(Y,bo){var bj,bk=[],bn;
var X=Y.drawingContainer().children;
var bm=X.length;
for(bj=0;
bj<bo.length;
bj++){bn=bo[bj];
for(var bl=0;
bl<bm;
bl++){if(X[bl]==bn.drawingContainer()){bk.push(bl);
break;
}}}return bk;
}var Q=aJ.extend({init:function(X){var Y=this;
Y.dataItem=(X||{}).dataItem;
aJ.fn.init.call(Y);
Y.options=A({id:O.randomId()},Y.options,X);
Y.isSelected=false;
Y.visual=new ae({id:Y.options.id,autoSize:Y.options.autoSize});
Y._template();
},options:{hover:{},cursor:y.grip,content:{align:"center middle"},selectable:true,serializable:true,enable:true},_getCursor:function(X){if(this.adorner){return this.adorner._getCursor(X);
}return this.options.cursor;
},visible:function(X){if(at(X)){return this.visual.visible();
}else{this.visual.visible(X);
}},bounds:function(){},refresh:function(){this.visual.redraw();
},position:function(X){this.options.x=X.x;
this.options.y=X.y;
this.visual.position(X);
},toString:function(){return this.options.id;
},serialize:function(){var X=A({},{options:this.options});
if(this.dataItem){X.dataItem=this.dataItem.toString();
}return X;
},_content:function(X){if(X!==ba){var bk=this.options;
if(O.Utils.isString(X)){bk.content.text=X;
}else{A(bk.content,X);
}var Y=bk.content;
var bj=this._contentVisual;
if(!bj){this._createContentVisual(Y);
}else{this._updateContentVisual(Y);
}}return this.options.content.text;
},_createContentVisual:function(X){if(X.text){this._contentVisual=new a2(X);
this._contentVisual._includeInBBox=false;
this.visual.append(this._contentVisual);
}},_updateContentVisual:function(X){this._contentVisual.redraw(X);
},_hitTest:function(Y){var X=this.bounds();
return this.visible()&&X.contains(Y)&&this.options.enable;
},_template:function(){var bj=this;
if(bj.options.content.template){var X=bj.dataItem||{},Y=kendo.template(bj.options.content.template,{paramName:"dataItem"});
bj.options.content.text=Y(X);
}},_canSelect:function(){return this.options.selectable!==false;
},toJSON:function(){return{id:this.options.id};
}});
var u=k.extend({init:function(Y,X){this.options=A({},this.options,X);
this.connections=[];
this.shape=Y;
},options:{width:7,height:7,fill:{color:D},hover:{}},position:function(){if(this.options.position){return this.options.position(this.shape);
}else{return this.shape.getPosition(this.options.name);
}},toJSON:function(){return{shapeId:this.shape.toString(),connector:this.options.name};
}});
u.parse=function(X,bm){var bn=bm.split(":"),bj=bn[0],bk=bn[1]||c;
for(var Y=0;
Y<X.shapes.length;
Y++){var bl=X.shapes[Y];
if(bl.options.id==bj){return bl.getConnector(bk.trim());
}}};
var aZ=Q.extend({init:function(Y,X){var bj=this;
Q.fn.init.call(bj,Y);
this.diagram=X;
this.updateOptionsFromModel();
Y=bj.options;
bj.connectors=[];
bj.type=Y.type;
bj.shapeVisual=aZ.createShapeVisual(bj.options);
bj.visual.append(this.shapeVisual);
bj.updateBounds();
bj.content(bj.content());
bj._createConnectors();
bj.parentContainer=null;
bj.isContainer=false;
bj.isCollapsed=false;
bj.id=bj.visual.id;
if(Y.hasOwnProperty("layout")&&Y.layout!==ba){bj.layout=Y.layout.bind(Y);
}},options:O.shapeDefaults(),_setOptionsFromModel:function(X){var Y=ac(X||this.dataItem);
this.options=A({},this.options,Y);
this.redrawVisual();
if(this.options.content){this._template();
this.content(this.options.content);
}},updateOptionsFromModel:function(bj,Y){if(this.diagram&&this.diagram._isEditable){var bk=ac(bj||this.dataItem);
if(bj&&Y){if(!z.inArray(Y,["x","y","width","height"])){if(this.options.visual){this.redrawVisual();
}else{if(bk.type){this.options=A({},this.options,bk);
this.redrawVisual();
}}if(this.options.content){this._template();
this.content(this.options.content);
}}else{var X=this.bounds();
X[Y]=bj[Y];
this.bounds(X);
}}else{this.options=A({},this.options,bk);
}}},redrawVisual:function(){this.visual.clear();
this._contentVisual=null;
this.options.dataItem=this.dataItem;
this.shapeVisual=aZ.createShapeVisual(this.options);
this.visual.append(this.shapeVisual);
this.updateBounds();
},updateModel:function(bk){var Y=this.diagram;
if(Y&&Y._isEditable){var X=this._bounds;
var bj=this.dataItem;
if(bj){Y._suspendModelRefresh();
if(L(bj.x)&&X.x!==bj.x){bj.set("x",X.x);
}if(L(bj.y)&&X.y!==bj.y){bj.set("y",X.y);
}if(L(bj.width)&&X.width!==bj.width){bj.set("width",X.width);
}if(L(bj.height)&&X.height!==bj.height){bj.set("height",X.height);
}this.dataItem=bj;
Y._resumeModelRefresh();
if(bk){Y._syncShapeChanges();
}}}},updateBounds:function(){var X=this.visual._measure(true);
var Y=this.options;
this.bounds(new aS(Y.x,Y.y,X.width,X.height));
this._rotate();
this._alignContent();
},content:function(X){var Y=this._content(X);
this._alignContent();
return Y;
},_alignContent:function(){var bl=this.options.content||{};
var bn=this._contentVisual;
if(bn&&bl.align){var bj=this.visual._measure();
var Y=new O.RectAlign(bj);
var bk=bn.drawingElement.bbox(null);
var bm=new aS(0,0,bk.width(),bk.height());
var X=Y.align(bm,bl.align);
bn.position(X.topLeft());
}},_createConnectors:function(){var bl=this.options,bk=bl.connectors.length,Y=bl.connectorDefaults,X,bj;
for(bj=0;
bj<bk;
bj++){X=new u(this,A({},Y,bl.connectors[bj]));
this.connectors.push(X);
}},bounds:function(bj){var X;
if(bj){if(ar(bj)){switch(bj){case a7:X=this._transformedBounds();
break;
case b:X=this._transformedBounds();
var Y=this.diagram._pan;
X.x+=Y.x;
X.y+=Y.y;
break;
case aW:X=this._rotatedBounds();
break;
default:X=this._bounds;
}}else{this._setBounds(bj);
this._triggerBoundsChange();
this.refreshConnections();
}}else{X=this._bounds;
}return X;
},_setBounds:function(bj){var Y=this.options;
var bk=bj.topLeft();
var bm=Y.x=bk.x;
var bn=Y.y=bk.y;
var bl=Y.width=ax.max(bj.width,Y.minWidth);
var X=Y.height=ax.max(bj.height,Y.minHeight);
this._bounds=new aS(bm,bn,bl,X);
this.visual.redraw({x:bm,y:bn,width:bl,height:X});
},position:function(X){if(X){this.bounds(new aS(X.x,X.y,this._bounds.width,this._bounds.height));
}else{return this._bounds.topLeft();
}},clone:function(){var X=this.serialize();
X.options.id=O.randomId();
if(this.diagram&&this.diagram._isEditable&&L(this.dataItem)){X.options.dataItem=n(this.dataItem);
}return new aZ(X.options);
},select:function(bk){var Y=this.diagram,bj,X;
if(at(bk)){bk=true;
}if(this._canSelect()){if(this.isSelected!=bk){bj=[];
X=[];
this.isSelected=bk;
if(this.isSelected){Y._selectedItems.push(this);
bj.push(this);
}else{bc.remove(Y._selectedItems,this);
X.push(this);
}if(!Y._internalSelection){Y._selectionChanged(bj,X);
}return true;
}}},rotate:function(X,bj,bo){var bm=this.visual.rotate();
if(X!==ba){if(bo!==false&&this.diagram&&this.diagram.undoRedoService&&X!==bm.angle){this.diagram.undoRedoService.add(new O.RotateUnit(this.diagram._resizingAdorner,[this],[bm.angle]),false);
}var Y=this.bounds(),bn=new aM(Y.width/2,Y.height/2),bk,bl;
if(bj){bk=X-bm.angle;
bl=Y.center().rotate(bj,360-bk).minus(bn);
this._rotationOffset=this._rotationOffset.plus(bl.minus(Y.topLeft()));
this.position(bl);
}this.visual.rotate(X,bn);
this.options.rotation.angle=X;
if(this.diagram&&this.diagram._connectorsAdorner){this.diagram._connectorsAdorner.refresh();
}this.refreshConnections();
if(this.diagram){this.diagram.trigger(av,{item:this});
}}return bm;
},connections:function(bp){var bm=[],bk,bl,X,Y,bj;
for(bk=0;
bk<this.connectors.length;
bk++){bj=this.connectors[bk];
Y=bj.connections;
for(bl=0,Y;
bl<Y.length;
bl++){X=Y[bl];
if(bp=="out"){var bn=X.source();
if(bn.shape&&bn.shape==this){bm.push(X);
}}else{if(bp=="in"){var bo=X.target();
if(bo.shape&&bo.shape==this){bm.push(X);
}}else{bm.push(X);
}}}}return bm;
},refreshConnections:function(){a.each(this.connections(),function(){this.refresh();
});
},getConnector:function(bj){var Y,X;
if(ar(bj)){bj=bj.toLocaleLowerCase();
for(Y=0;
Y<this.connectors.length;
Y++){X=this.connectors[Y];
if(X.options.name.toLocaleLowerCase()==bj){return X;
}}}else{if(bj instanceof aM){return o(bj,this);
}else{return this.connectors.length?this.connectors[0]:null;
}}},getPosition:function(bj){var X=this.bounds(),Y=bj.charAt(0).toLowerCase()+bj.slice(1);
if(ap(X[Y])){return this._transformPoint(X[Y]());
}return X.center();
},redraw:function(Y){if(Y){var bj=this.options;
var X;
this.shapeVisual.redraw(this._visualOptions(Y));
if(this._diffNumericOptions(Y,[be,af,bf,bg])){this.bounds(new aS(bj.x,bj.y,bj.width,bj.height));
X=true;
}if(Y.connectors){bj.connectors=Y.connectors;
this._updateConnectors();
}bj=A(bj,Y);
if(Y.rotation||X){this._rotate();
}if(bj.content){this.content(bj.content);
}}},_updateConnectors:function(){var Y=this.connections();
this.connectors=[];
this._createConnectors();
var X;
var bk;
var bl;
for(var bj=0;
bj<Y.length;
bj++){X=Y[bj];
bk=X.source();
bl=X.target();
if(bk.shape&&bk.shape===this){X.source(this.getConnector(bk.options.name)||null);
}else{if(bl.shape&&bl.shape===this){X.target(this.getConnector(bl.options.name)||null);
}}X.updateModel();
}},_diffNumericOptions:O.diffNumericOptions,_visualOptions:function(X){return{data:X.path,source:X.source,hover:X.hover,fill:X.fill,stroke:X.stroke,startCap:X.startCap,endCap:X.endCap};
},_triggerBoundsChange:function(){if(this.diagram){this.diagram.trigger(au,{item:this,bounds:this._bounds.clone()});
}},_transformPoint:function(Y){var bj=this.rotate(),X=this.bounds(),bk=X.topLeft();
if(bj.angle){Y.rotate(bj.center().plus(bk),360-bj.angle);
}return Y;
},_transformedBounds:function(){var X=this.bounds(),bj=X.topLeft(),Y=X.bottomRight();
return aS.fromPoints(this.diagram.modelToView(bj),this.diagram.modelToView(Y));
},_rotatedBounds:function(){var X=this.bounds().rotatedBounds(this.rotate().angle),bj=X.topLeft(),Y=X.bottomRight();
return aS.fromPoints(bj,Y);
},_rotate:function(){var X=this.options.rotation;
if(X&&X.angle){this.rotate(X.angle);
}this._rotationOffset=new aM();
},_hover:function(bl){var bj=this.options,Y=bj.hover,bk=bj.stroke,X=bj.fill;
if(bl&&ao(Y.stroke)){bk=A({},bk,Y.stroke);
}if(bl&&ao(Y.fill)){X=Y.fill;
}this.shapeVisual.redraw({stroke:bk,fill:X});
if(bj.editable&&bj.editable.connect){this.diagram._showConnectors(this,bl);
}},_hitTest:function(bk){if(this.visible()){var Y=this.bounds(),bj,X=this.rotate().angle;
if(bk.isEmpty&&!bk.isEmpty()){return al.rects(bk,Y,X?X:0);
}else{bj=bk.clone().rotate(Y.center(),X);
if(Y.contains(bj)){return this;
}}}},toJSON:function(){return{shapeId:this.options.id};
}});
aZ.createShapeVisual=function(X){delete X.diagram;
var Y=A({},X,{x:0,y:0});
var bl=Y.visual;
var bk=(Y.type+"").toLocaleLowerCase();
var bj;
if(ap(bl)){bj=bl.call(this,Y);
}else{if(Y.path){Y.data=Y.path;
bj=new aL(Y);
a8(bj);
}else{if(bk=="rectangle"){bj=new aT(Y);
}else{if(bk=="circle"){bj=new j(Y);
}else{if(bk=="text"){bj=new a2(Y);
}else{if(bk=="image"){bj=new ah(Y);
}else{bj=new aL(Y);
}}}}}}return bj;
};
function a8(Y){var X=Y.drawingContainer().clippedBBox(null);
if(X.origin.x!==0||X.origin.y!==0){Y.position(-X.origin.x,-X.origin.y);
}}var q=Q.extend({init:function(X,bk,Y){var bj=this;
Q.fn.init.call(bj,Y);
this.updateOptionsFromModel();
this._initRouter();
bj.path=new O.Polyline(bj.options);
bj.path.fill(a9);
bj.visual.append(bj.path);
bj._sourcePoint=bj._targetPoint=new aM();
bj.source(X);
bj.target(bk);
bj.content(bj.options.content);
bj.definers=[];
if(L(Y)&&Y.points){bj.points(Y.points);
}bj.refresh();
},options:{hover:{stroke:{}},startCap:aH,endCap:aH,points:[],selectable:true,fromConnector:c,toConenctor:c},_setOptionsFromModel:function(X){this.updateOptionsFromModel(X||this.dataItem);
},updateOptionsFromModel:function(bj){if(this.diagram&&this.diagram._isEditable){var X=this.diagram._dataMap;
var bk=ab(bj||this.dataItem);
if(bj){if(L(bk.from)){var Y=X[bk.from];
if(Y&&L(bk.fromConnector)){Y=Y.getConnector(bk.fromConnector);
}this.source(Y);
}else{if(L(bk.fromX)&&L(bk.fromY)){this.source(new aM(bk.fromX,bk.fromY));
}}if(L(bk.to)){var bl=X[bk.to];
if(bl&&L(bk.toConnector)){bl=bl.getConnector(bk.toConnector);
}this.target(bl);
}else{if(L(bk.toX)&&L(bk.toY)){this.target(new aM(bk.toX,bk.toY));
}}if(L(bk.type)&&this.type()!==bk.type){this.points([]);
this.type(bk.type);
}this.dataItem=bj;
this._template();
this.redraw(this.options);
}else{this.options=A({},bk,this.options);
}}},updateModel:function(Y){if(this.diagram&&this.diagram._isEditable){if(this.diagram.connectionsDataSource){var X=this.diagram.connectionsDataSource.getByUid(this.dataItem.uid);
if(X){this.diagram._suspendModelRefresh();
if(L(this.options.fromX)&&this.options.fromX!==null){l("from",X);
l("fromConnector",X);
X.set("fromX",this.options.fromX);
X.set("fromY",this.options.fromY);
}else{X.set("from",this.options.from);
if(L(X.fromConnector)){X.set("fromConnector",this.sourceConnector?this.sourceConnector.options.name:null);
}l("fromX",X);
l("fromY",X);
}if(L(this.options.toX)&&this.options.toX!==null){l("to",X);
l("toConnector",X);
X.set("toX",this.options.toX);
X.set("toY",this.options.toY);
}else{X.set("to",this.options.to);
if(L(X.toConnector)){X.set("toConnector",this.targetConnector?this.targetConnector.options.name:null);
}l("toX",X);
l("toY",X);
}if(L(this.options.type)&&L(X.type)){X.set("type",this.options.type);
}this.dataItem=X;
this.diagram._resumeModelRefresh();
if(Y){this.diagram._syncConnectionChanges();
}}}}},sourcePoint:function(){return this._resolvedSourceConnector?this._resolvedSourceConnector.position():this._sourcePoint;
},source:function(bk,bl){var X;
if(ao(bk)){var bj=bk instanceof aZ;
var Y=this.options.fromConnector||c;
if(bj&&!bk.getConnector(Y)){return;
}if(bl&&this.diagram){this.diagram.undoRedoService.addCompositeItem(new O.ConnectionEditUnit(this,bk));
}if(bk!==ba){this.from=bk;
}this._removeFromSourceConnector();
if(bk===null){if(this.sourceConnector){this._sourcePoint=this._resolvedSourceConnector.position();
this._clearSourceConnector();
this._setFromOptions(null,this._sourcePoint);
}}else{if(bk instanceof u){X=bk.shape.dataItem;
if(X){this._setFromOptions(X.id);
}this.sourceConnector=bk;
this.sourceConnector.connections.push(this);
}else{if(bk instanceof aM){this._setFromOptions(null,bk);
this._sourcePoint=bk;
if(this.sourceConnector){this._clearSourceConnector();
}}else{if(bj){X=bk.dataItem;
if(X){this._setFromOptions(X.id);
}this.sourceConnector=bk.getConnector(Y);
this.sourceConnector.connections.push(this);
}}}}this.refresh();
}return this.sourceConnector?this.sourceConnector:this._sourcePoint;
},_setFromOptions:function(X,Y){this.options.from=X;
if(Y){this.options.fromX=Y.x;
this.options.fromY=Y.y;
}else{this.options.fromX=null;
this.options.fromY=null;
}},sourceDefiner:function(X){if(X){if(X instanceof O.PathDefiner){X.left=null;
this._sourceDefiner=X;
this.source(X.point);
}else{throw"The sourceDefiner needs to be a PathDefiner.";
}}else{if(!this._sourceDefiner){this._sourceDefiner=new O.PathDefiner(this.sourcePoint(),null,null);
}return this._sourceDefiner;
}},targetPoint:function(){return this._resolvedTargetConnector?this._resolvedTargetConnector.position():this._targetPoint;
},target:function(bk,bl){var X;
if(ao(bk)){var bj=bk instanceof aZ;
var Y=this.options.toConnector||c;
if(bj&&!bk.getConnector(Y)){return;
}if(bl&&this.diagram){this.diagram.undoRedoService.addCompositeItem(new O.ConnectionEditUnit(this,ba,bk));
}if(bk!==ba){this.to=bk;
}this._removeFromTargetConnector();
if(bk===null){if(this.targetConnector){this._targetPoint=this._resolvedTargetConnector.position();
this._clearTargetConnector();
this._setToOptions(null,this._targetPoint);
}}else{if(bk instanceof u){X=bk.shape.dataItem;
if(X){this._setToOptions(X.id);
}this.targetConnector=bk;
this.targetConnector.connections.push(this);
}else{if(bk instanceof aM){this._setToOptions(null,bk);
this._targetPoint=bk;
if(this.targetConnector){this._clearTargetConnector();
}}else{if(bj){X=bk.dataItem;
if(X){this._setToOptions(X.id);
}this.targetConnector=bk.getConnector(Y);
this.targetConnector.connections.push(this);
}}}}this.refresh();
}return this.targetConnector?this.targetConnector:this._targetPoint;
},_setToOptions:function(X,Y){this.options.to=X;
if(Y){this.options.toX=Y.x;
this.options.toY=Y.y;
}else{this.options.toX=null;
this.options.toY=null;
}},targetDefiner:function(X){if(X){if(X instanceof O.PathDefiner){X.right=null;
this._targetDefiner=X;
this.target(X.point);
}else{throw"The sourceDefiner needs to be a PathDefiner.";
}}else{if(!this._targetDefiner){this._targetDefiner=new O.PathDefiner(this.targetPoint(),null,null);
}return this._targetDefiner;
}},_updateConnectors:function(){this._updateConnector(this.source(),"source");
this._updateConnector(this.target(),"target");
},_updateConnector:function(bl,bm){var bo=this;
var bj=bo.diagram;
if(bl instanceof u&&!bj.getShapeById(bl.shape.id)){var Y=bl.shape.dataItem;
var X=bl.options.name;
var bn=function(){var bp=bj._dataMap[Y.id];
bl=bp.getConnector(X);
bo[bm](bl,false);
bo.updateModel();
};
if(bj._dataMap[Y.id]){bn();
}else{var bk=bj._inactiveShapeItems.getByUid(Y.uid);
if(bk){bj._deferredConnectionUpdates.push(bk.onActivate(bn));
}}}else{bo[bm](bl,false);
}},content:function(X){var Y=this._content(X);
if(L(X)){this._alignContent();
}return Y;
},_createContentVisual:function(X){var Y;
if(ap(X.visual)){Y=X.visual.call(this,X);
}else{if(X.text){Y=new a2(X);
}}if(Y){this._contentVisual=Y;
Y._includeInBBox=false;
this.visual.append(Y);
}return Y;
},_updateContentVisual:function(X){if(ap(X.visual)){this.visual.remove(this._contentVisual);
this._createContentVisual(X);
}else{this._contentVisual.redraw(X);
}},_alignContent:function(){if(this._contentVisual){var bp=r;
var bt=this.allPoints();
var bl=ax.floor(bt.length/2);
var bu=bl-1;
while(bu>0&&bt[bu].equals(bt[bl])){bu--;
bl++;
}var bm=bt[bl];
var bv=bt[bu];
var bj=this._contentVisual._measure();
var bw=bj.width;
var bn=bj.height;
var X=bt.length%2===0;
var bk=bv.distanceTo(bm);
if(X&&bt.length>2&&bk>0&&((bv.y===bm.y&&bk<bw)||(bv.x===bm.x&&bk<bn))){X=false;
bp=0;
}var bs;
if(X){var Y=kendo.util.deg(ax.atan2(bm.y-bv.y,bm.x-bv.x));
bs=new aM((bm.x-bv.x)/2+bv.x,(bm.y-bv.y)/2+bv.y);
if(ax.abs(Y)===90){bs.x+=bp;
bs.y-=bn/2;
}else{if(Y%180===0){bs.x-=bw/2;
bs.y-=bn+bp;
}else{if(Y<-90||(0<Y&&Y<90)){bs.y-=bn;
}else{if(Y<0||Y>90){bs.x-=bw;
bs.y-=bn;
}}}}}else{var bo=ax.floor(bt.length/2);
bs=bt[bo].clone();
bv=bt[bo-1];
bm=bt[bo+1];
var bq=bv.x<=bs.x&&bm.x<=bs.x?bp:-bj.width-bp;
var br=bv.y<=bs.y&&bm.y<=bs.y?bp:-bj.height-bp;
bs.x+=bq;
bs.y+=br;
}this._contentVisual.position(bs);
}},select:function(bk){var Y=this.diagram,bj,X;
if(this._canSelect()){if(this.isSelected!==bk){this.isSelected=bk;
bj=[];
X=[];
if(this.isSelected){this.adorner=new s(this,this.options.selection);
Y._adorn(this.adorner,true);
Y._selectedItems.push(this);
bj.push(this);
}else{if(this.adorner){Y._adorn(this.adorner,false);
bc.remove(Y._selectedItems,this);
this.adorner=ba;
X.push(this);
}}if(this.adorner){this.adorner.refresh();
}if(!Y._internalSelection){Y._selectionChanged(bj,X);
}return true;
}}},bounds:function(X){if(X&&!ar(X)){this._bounds=X;
}else{return this._bounds;
}},type:function(Y){var X=this.options;
if(Y){if(Y!==X.type){X.type=Y;
this._initRouter();
this.refresh();
}}else{return X.type;
}},_initRouter:function(){var X=(this.options.type||"").toLowerCase();
if(X==g){this._router=new h(this);
}else{this._router=new aN(this);
}},points:function(bl){if(bl){this.definers=[];
for(var Y=0;
Y<bl.length;
Y++){var X=bl[Y];
if(X instanceof O.Point){this.definers.push(new O.PathDefiner(X));
}else{if(X.hasOwnProperty("x")&&X.hasOwnProperty("y")){this.definers.push(new O.PathDefiner(new aM(X.x,X.y)));
}else{throw"A Connection point needs to be a Point or an object with x and y properties.";
}}}}else{var bk=[];
if(ao(this.definers)){for(var bj=0;
bj<this.definers.length;
bj++){bk.push(this.definers[bj].point);
}}return bk;
}},allPoints:function(){var Y=[this.sourcePoint()];
if(this.definers){for(var X=0;
X<this.definers.length;
X++){Y.push(this.definers[X].point);
}}Y.push(this.targetPoint());
return Y;
},refresh:function(){this._resolveConnectors();
this._refreshPath();
this._alignContent();
if(this.adorner){this.adorner.refresh();
}},_resolveConnectors:function(){var bj=this,bl,bn,bk=bj.source(),bm=bj.target(),X,Y;
if(bk instanceof aM){bl=bk;
}else{if(bk instanceof u){if(an(bk)){X=bk.shape;
}else{bj._resolvedSourceConnector=bk;
bl=bk.position();
}}}if(bm instanceof aM){bn=bm;
}else{if(bm instanceof u){if(an(bm)){Y=bm.shape;
}else{bj._resolvedTargetConnector=bm;
bn=bm.position();
}}}if(bl){if(Y){bj._resolvedTargetConnector=o(bl,Y);
}}else{if(X){if(bn){bj._resolvedSourceConnector=o(bn,X);
}else{if(Y){this._resolveAutoConnectors(X,Y);
}}}}},_resolveAutoConnectors:function(X,Y){var bl=az;
var bk=az;
var br=X.connectors;
var bv;
var bm,bn;
var bt,bx;
var bo,bp;
var bq,bu;
var bs,bw;
var bj;
for(bs=0;
bs<br.length;
bs++){bq=br[bs];
if(!an(bq)){bt=bq.position();
bv=Y.connectors;
for(bw=0;
bw<bv.length;
bw++){bu=bv[bw];
if(!an(bu)){bx=bu.position();
bj=ax.round(bt.distanceTo(bx));
if(bj<bl&&this.diagram&&this._testRoutePoints(bt,bx,bq,bu)){bl=bj;
bm=bq;
bn=bu;
}if(bj<bk){bo=bq;
bp=bu;
bk=bj;
}}}}}if(bm){bo=bm;
bp=bn;
}this._resolvedSourceConnector=bo;
this._resolvedTargetConnector=bp;
},_testRoutePoints:function(bo,br,bn,bq){var bm=this._router;
var bj=true;
if(bm instanceof h){var bk=bm.routePoints(bo,br,bn,bq),bp,X,bl;
bk.unshift(bo);
bk.push(br);
for(var Y=1;
Y<bk.length;
Y++){bp=bk[Y-1];
X=bk[Y];
bl=new aS(ax.min(bp.x,X.x),ax.min(bp.y,X.y),ax.abs(bp.x-X.x),ax.abs(bp.y-X.y));
if(bl.width>0){bl.x++;
bl.width-=2;
}if(bl.height>0){bl.y++;
bl.height-=2;
}if(!bl.isEmpty()&&this.diagram._shapesQuadTree.hitTestRect(bl)){bj=false;
break;
}}}return bj;
},redraw:function(X){if(X){this.options=A({},this.options,X);
var Y=this.options.points;
if(L(Y)&&Y.length>0){this.points(Y);
this._refreshPath();
}if((X&&X.content)||X.text){this.content(X.content);
}this.path.redraw({fill:X.fill,stroke:X.stroke,startCap:X.startCap,endCap:X.endCap});
}},clone:function(){var X=this.serialize();
if(this.diagram&&this.diagram._isEditable&&L(this.dataItem)){X.options.dataItem=n(this.dataItem);
}return new q(this.from,this.to,X.options);
},serialize:function(){var X=this.from.toJSON?this.from.toJSON:this.from.toString(),bj=this.to.toJSON?this.to.toJSON:this.to.toString();
var Y=A({},{options:this.options,from:X,to:bj});
if(L(this.dataItem)){Y.dataItem=this.dataItem.toString();
}Y.options.points=this.points();
return Y;
},_hitTest:function(bk){if(this.visible()){var Y=new aM(bk.x,bk.y),X=this.sourcePoint(),bj=this.targetPoint();
if(bk.isEmpty&&!bk.isEmpty()&&bk.contains(X)&&bk.contains(bj)){return this;
}if(this._router.hitTest(Y)){return this;
}}},_hover:function(Y){var X=(this.options.stroke||{}).color;
if(Y&&ao(this.options.hover.stroke.color)){X=this.options.hover.stroke.color;
}this.path.redraw({stroke:{color:X}});
},_refreshPath:function(){if(!L(this.path)){return;
}this._drawPath();
this.bounds(this._router.getBounds());
},_drawPath:function(){if(this._router){this._router.route();
}var Y=this.sourcePoint();
var bj=this.targetPoint();
var X=this.points();
this.path.redraw({points:[Y].concat(X,[bj])});
},_clearSourceConnector:function(){bc.remove(this.sourceConnector.connections,this);
this.sourceConnector=ba;
this._resolvedSourceConnector=ba;
},_clearTargetConnector:function(){bc.remove(this.targetConnector.connections,this);
this.targetConnector=ba;
this._resolvedTargetConnector=ba;
},_removeFromSourceConnector:function(){if(this.sourceConnector){bc.remove(this.sourceConnector.connections,this);
}},_removeFromTargetConnector:function(){if(this.targetConnector){bc.remove(this.targetConnector.connections,this);
}},toJSON:function(){var X=this;
var Y,bk,bj;
if(X.from&&X.from.toJSON){Y=X.from.toJSON();
}else{bj=X._sourcePoint;
Y={x:bj.x,y:bj.y};
}if(X.to&&X.to.toJSON){bk=X.to.toJSON();
}else{bj=X._targetPoint;
bk={x:bj.x,y:bj.y};
}return{from:Y,to:bk};
}});
var P=bd.extend({init:function(X,bj){var Y=this;
kendo.destroy(X);
bd.fn.init.call(Y,X,bj);
Y._initTheme();
Y._initElements();
Y._extendLayoutOptions(Y.options);
Y._initDefaults(bj);
Y._initCanvas();
Y.mainLayer=new ae({id:"main-layer"});
Y.canvas.append(Y.mainLayer);
Y._shapesQuadTree=new a0(Y);
Y._pan=new aM();
Y._adorners=[];
Y.adornerLayer=new ae({id:"adorner-layer"});
Y.canvas.append(Y.adornerLayer);
Y._createHandlers();
Y._initialize();
Y._fetchFreshData();
Y._createGlobalToolBar();
Y._resizingAdorner=new aU(Y,{editable:Y.options.editable});
Y._connectorsAdorner=new v(Y);
Y._adorn(Y._resizingAdorner,true);
Y._adorn(Y._connectorsAdorner,true);
Y.selector=new aY(Y);
Y._clipboard=[];
Y.pauseMouseHandlers=false;
Y._createShapes();
Y._createConnections();
if(Y.options.layout){Y.layout(Y.options.layout);
}Y.zoom(Y.options.zoom);
Y.canvas.draw();
},options:{name:"Diagram",theme:"default",layout:"",zoomRate:0.1,zoom:1,zoomMin:0,zoomMax:2,dataSource:{},draggable:true,template:"",autoBind:true,editable:{rotate:{},resize:{},text:true,tools:[],drag:{snap:{size:10,angle:10}},remove:true},pannable:{key:"ctrl"},selectable:{key:"none"},tooltip:{enabled:true,format:"{0}"},copy:{enabled:true,offsetX:20,offsetY:20},shapeDefaults:O.shapeDefaults({undoable:true}),connectionDefaults:{editable:{tools:[]},type:g},shapes:[],connections:[]},events:[bh,bi,aK,aX,av,au,i,m,aD,aE,"toolBarClick","save","cancel","edit","remove","add","dataBound",U,S,T],items:function(){return a();
},_createGlobalToolBar:function(){var X=this.options.editable;
if(X){var Y=X.tools;
if(this._isEditable&&Y!==false&&(!Y||Y.length===0)){Y=["createShape","undo","redo","rotateClockwise","rotateAnticlockwise"];
}if(Y&&Y.length){this.toolBar=new R(this,{tools:Y||{},click:aP(this._toolBarClick,this),modal:false});
this.toolBar.element.css({textAlign:"left"});
this.element.prepend(this.toolBar.element);
this._resize();
}}},createShape:function(){if((this.editor&&this.editor.end())||!this.editor){var X=this.dataSource;
var bm=X.view()||[];
var bj=bm.length;
var bk=x(X,{});
var bl=this._createShape(bk,{});
if(!this.trigger("add",{shape:bl})){X.insert(bj,bk);
var Y=this._inactiveShapeItems.getByUid(bk.uid);
Y.element=bl;
this.edit(bl);
}}},_createShape:function(X,Y){Y=A({},this.options.shapeDefaults,Y);
Y.dataItem=X;
var bj=new aZ(Y,this);
return bj;
},createConnection:function(){if(((this.editor&&this.editor.end())||!this.editor)){var Y=this.connectionsDataSource;
var bl=Y.view()||[];
var bj=bl.length;
var bk=x(Y,{});
var X=this._createConnection(bk);
if(!this.trigger("add",{connection:X})){this._connectionsDataMap[bk.uid]=X;
Y.insert(bj,bk);
this.addConnection(X,false);
this.edit(X);
}}},_createConnection:function(Y,bk,bl){var bj=A({},this.options.connectionDefaults);
bj.dataItem=Y;
var X=new q(bk||new aM(),bl||new aM(),bj);
return X;
},editModel:function(Y,bl){this.cancelEdit();
var bk,bm;
var bj=this.options.editable;
if(bl=="shape"){bk=bj.shapeEditors;
bm=bj.shapeTemplate;
}else{if(bl=="connection"){var X=aP(t,this);
bk=A({},{from:X,to:X},bj.connectionEditors);
bm=bj.connectionTemplate;
}else{return;
}}this.editor=new aO(this.element,{update:aP(this._update,this),cancel:aP(this._cancel,this),model:Y,type:bl,target:this,editors:bk,template:bm});
this.trigger("edit",this._editArgs());
},edit:function(Y){if(Y.dataItem){var X=Y instanceof aZ?"shape":"connection";
this.editModel(Y.dataItem,X);
}},cancelEdit:function(){if(this.editor){this._getEditDataSource().cancelChanges(this.editor.model);
this._destroyEditor();
}},saveEdit:function(){if(this.editor&&this.editor.end()&&!this.trigger("save",this._editArgs())){this._getEditDataSource().sync();
}},_update:function(){if(this.editor&&this.editor.end()&&!this.trigger("save",this._editArgs())){this._getEditDataSource().sync();
this._destroyEditor();
}},_cancel:function(){if(this.editor&&!this.trigger("cancel",this._editArgs())){var Y=this.editor.model;
this._getEditDataSource().cancelChanges(Y);
var X=this._connectionsDataMap[Y.uid]||this._dataMap[Y.id];
if(X){X._setOptionsFromModel(Y);
}this._destroyEditor();
}},_getEditDataSource:function(){return this.editor.options.type==="shape"?this.dataSource:this.connectionsDataSource;
},_editArgs:function(){var X={container:this.editor.element};
X[this.editor.options.type]=this.editor.model;
return X;
},_destroyEditor:function(){if(this.editor){this.editor.close();
this.editor=null;
}},_initElements:function(){this.wrapper=this.element.empty().css("position","relative").attr("tabindex",0).addClass("k-widget k-diagram");
this.scrollable=a("<div />").appendTo(this.element);
},_initDefaults:function(bl){var bj=this.options;
var Y=bj.editable;
var bk=bj.shapeDefaults;
var X=bj.connectionDefaults;
var bm=(bl||{}).shapeDefaults;
if(Y===false){bk.editable=false;
X.editable=false;
}else{w(Y,bk.editable,["drag","remove","connect"]);
w(Y,X.editable,["drag","remove"]);
}if(bm&&bm.connectors){bj.shapeDefaults.connectors=bm.connectors;
}},_initCanvas:function(){var X=a("<div class='k-layer'></div>").appendTo(this.scrollable)[0];
var Y=this.viewport();
this.canvas=new f(X,{width:Y.width||C,height:Y.height||B});
},_createHandlers:function(){var Y=this;
var X=Y.element;
X.on(aF,aP(Y._wheel,Y));
if(!kendo.support.touch&&!kendo.support.mobileOS){Y.toolService=new a5(Y);
this.scroller.wrapper.on("mousemove"+aI,aP(Y._mouseMove,Y)).on("mouseup"+aI,aP(Y._mouseUp,Y)).on("mousedown"+aI,aP(Y._mouseDown,Y)).on("mouseover"+aI,aP(Y._mouseover,Y)).on("mouseout"+aI,aP(Y._mouseout,Y));
X.on("keydown"+aI,aP(Y._keydown,Y));
}else{Y._userEvents=new kendo.UserEvents(X,{multiTouch:true,tap:aP(Y._tap,Y)});
Y._userEvents.bind(["gesturestart","gesturechange","gestureend"],{gesturestart:aP(Y._gestureStart,Y),gesturechange:aP(Y._gestureChange,Y),gestureend:aP(Y._gestureEnd,Y)});
Y.toolService=new a5(Y);
if(Y.options.pannable!==false){Y.scroller.enable();
}}this._syncHandler=aP(Y._syncChanges,Y);
Y._resizeHandler=aP(Y.resize,Y,false);
kendo.onResize(Y._resizeHandler);
this.bind(bi,aP(Y._destroyToolBar,Y));
this.bind(aK,aP(Y._destroyToolBar,Y));
},_tap:function(X){var bk=this.toolService;
var bj=this._caculateMobilePosition(X);
bk._updateHoveredItem(bj);
if(bk.hoveredItem){var Y=bk.hoveredItem;
if(this.options.selectable!==false){this._destroyToolBar();
if(Y.isSelected){Y.select(false);
}else{this.select(Y,{addToSelection:true});
}this._createToolBar();
}this.trigger("click",{item:Y,point:bj});
}},_caculateMobilePosition:function(X){return this.documentToModel(aM(X.x.location,X.y.location));
},_gestureStart:function(X){this._destroyToolBar();
this.scroller.disable();
var bj=this.documentToModel(new aM(X.center.x,X.center.y));
var Y={point:bj,zoom:this.zoom()};
if(this.trigger(bi,Y)){return;
}this._gesture=X;
this._initialCenter=bj;
},_gestureChange:function(Y){var bl=this._gesture;
var bj=this._initialCenter;
var X=this.documentToView(new aM(Y.center.x,Y.center.y));
var bm=Y.distance/bl.distance;
var bo=this._zoom;
var bn=false;
if(ax.abs(bm-1)>=aC){this._zoom=bo=this._getValidZoom(bo*bm);
this.options.zoom=bo;
this._gesture=Y;
bn=true;
}var bp=bj.times(bo);
var bk=X.minus(bp);
if(bn||this._pan.distanceTo(bk)>=aB){this._panTransform(bk);
this._updateAdorners();
}Y.preventDefault();
},_gestureEnd:function(){if(this.options.pannable!==false){this.scroller.enable();
}this.trigger(bh,{point:this._initialCenter,zoom:this.zoom()});
},_resize:function(){var X=this.viewport();
if(this.canvas){this.canvas.size(X);
}if(this.scrollable&&this.toolBar){this.scrollable.height(X.height);
}},_mouseover:function(X){var Y=X.target._kendoNode;
if(Y&&Y.srcElement._hover){Y.srcElement._hover(true,Y.srcElement);
}},_mouseout:function(X){var Y=X.target._kendoNode;
if(Y&&Y.srcElement._hover){Y.srcElement._hover(false,Y.srcElement);
}},_initTheme:function(){var X=this,bk=z.ui.themes||{},Y=((X.options||{}).theme||"").toLowerCase(),bj=(bk[Y]||{}).diagram;
X.options=A({},bj,X.options);
if(X.options.editable===true){A(X.options,{editable:(bj||{}).editable});
}},_createShapes:function(){var bl=this,Y=bl.options,bk=Y.shapes,bj,X;
for(X=0;
X<bk.length;
X++){bj=bk[X];
bl.addShape(bj);
}},_createConnections:function(){var bk=this,bm=bk.options,bj=bm.connectionDefaults,Y=bm.connections,X,bn,bo,bl;
for(bl=0;
bl<Y.length;
bl++){X=Y[bl];
bn=bk._findConnectionTarget(X.from);
bo=bk._findConnectionTarget(X.to);
bk.connect(bn,bo,A({},bj,X));
}},_findConnectionTarget:function(Y){var X=this;
var bj=ar(Y)?Y:Y.shapeId||Y.id;
var bk;
if(bj){bk=X.getShapeById(bj);
if(Y.connector){bk=bk.getConnector(Y.connector);
}}else{bk=new aM(Y.x||0,Y.y||0);
}return bk;
},destroy:function(){var X=this;
bd.fn.destroy.call(X);
if(this._userEvents){this._userEvents.destroy();
}kendo.unbindResize(X._resizeHandler);
X.clear();
X.element.off(aI);
X.scroller.wrapper.off(aI);
X.canvas.destroy(true);
X.canvas=ba;
X._destroyEditor();
X.destroyScroller();
X._destroyGlobalToolBar();
X._destroyToolBar();
},destroyScroller:function(){var X=this.scroller;
if(!X){return;
}X.destroy();
X.element.remove();
this.scroller=null;
},save:function(){var bj={shapes:[],connections:[]};
var Y,X,bk;
for(Y=0;
Y<this.shapes.length;
Y++){bk=this.shapes[Y];
if(bk.options.serializable){bj.shapes.push(bk.options);
}}for(Y=0;
Y<this.connections.length;
Y++){X=this.connections[Y];
bj.connections.push(A({},X.options,X.toJSON()));
}return bj;
},focus:function(){if(!this.element.is(kendo._activeElement())){var bj=this.element,bm=bj[0],X=[],bl=[],Y=document.documentElement,bk;
do{bm=bm.parentNode;
if(bm.scrollHeight>bm.clientHeight){X.push(bm);
bl.push(bm.scrollTop);
}}while(bm!=Y);
bj.focus();
for(bk=0;
bk<X.length;
bk++){X[bk].scrollTop=bl[bk];
}}},load:function(X){this.clear();
this.setOptions(X);
this._createShapes();
this._createConnections();
},setOptions:function(X){A(this.options,X);
},clear:function(){var X=this;
X.select(false);
X.mainLayer.clear();
X._shapesQuadTree.clear();
X._initialize();
},connect:function(bk,bl,bj){var X;
if(this.connectionsDataSource&&this._isEditable){var Y=this.connectionsDataSource.add({});
X=this._connectionsDataMap[Y.uid];
X.source(bk);
X.target(bl);
X.redraw(bj);
X.updateModel();
}else{X=new q(bk,bl,A({},this.options.connectionDefaults,bj));
this.addConnection(X);
}return X;
},connected:function(bj,bk){for(var Y=0;
Y<this.connections.length;
Y++){var X=this.connections[Y];
if(X.from==bj&&X.to==bk){return true;
}}return false;
},addConnection:function(X,Y){if(Y!==false){this.undoRedoService.add(new O.AddConnectionUnit(X,this),false);
}X.diagram=this;
X._setOptionsFromModel();
X.refresh();
this.mainLayer.append(X.visual);
this.connections.push(X);
this.trigger(i,{added:[X],removed:[]});
return X;
},_addConnection:function(X,bk){var Y=this.connectionsDataSource;
var bj;
if(Y&&this._isEditable){bj=x(Y,n(X.dataItem));
X.dataItem=bj;
X.updateModel();
if(!this.trigger("add",{connection:X})){this._connectionsDataMap[bj.uid]=X;
Y.add(bj);
this.addConnection(X,bk);
X._updateConnectors();
return X;
}}else{if(!this.trigger("add",{connection:X})){this.addConnection(X,bk);
X._updateConnectors();
return X;
}}},addShape:function(X,Y){var bj,bk=this.options.shapeDefaults;
if(X instanceof aZ){bk=A({},bk,Y);
X.redraw(Y);
bj=X;
}else{if(!(X instanceof kendo.Class)){bk=A({},bk,X||{});
bj=new aZ(bk);
}else{return;
}}if(bk.undoable){this.undoRedoService.add(new O.AddShapeUnit(bj,this),false);
}this.shapes.push(bj);
bj.diagram=this;
this.mainLayer.append(bj.visual);
this._shapesQuadTree.insert(bj);
this.trigger(i,{added:[bj],removed:[]});
if(bj.hasOwnProperty("layout")){bj.layout(bj);
}return bj;
},_addShape:function(bk,bm){var bl=this;
var Y=bl.dataSource;
var X;
if(Y&&this._isEditable){X=x(Y,n(bk.dataItem));
bk.dataItem=X;
bk.updateModel();
if(!this.trigger("add",{shape:bk})){this.dataSource.add(X);
var bj=this._inactiveShapeItems.getByUid(X.uid);
bj.element=bk;
bj.undoable=bm;
return bk;
}}else{if(!this.trigger("add",{shape:bk})){return this.addShape(bk,{undoable:bm});
}}},remove:function(bk,bm){bk=am(bk)?bk.slice(0):[bk];
var Y=a1(bk);
var bl=Y.shapes;
var X=Y.connections;
var bj;
if(!L(bm)){bm=true;
}if(bm){this.undoRedoService.begin();
}this._suspendModelRefresh();
for(bj=bl.length-1;
bj>=0;
bj--){this._removeItem(bl[bj],bm,X);
}for(bj=X.length-1;
bj>=0;
bj--){this._removeItem(X[bj],bm);
}this._resumeModelRefresh();
if(bm){this.undoRedoService.commit(false);
}this.trigger(i,{added:[],removed:bk});
},_removeShapeDataItem:function(X){if(this._isEditable){this.dataSource.remove(X.dataItem);
delete this._dataMap[X.dataItem.id];
}},_removeConnectionDataItem:function(X){if(this._isEditable){this.connectionsDataSource.remove(X.dataItem);
delete this._connectionsDataMap[X.dataItem.uid];
}},_triggerRemove:function(bl){var bm=[];
var bk,X,Y;
for(var bj=0;
bj<bl.length;
bj++){bk=bl[bj];
Y=bk.options.editable;
if(bk instanceof aZ){X={shape:bk};
}else{X={connection:bk};
}if(Y&&Y.remove!==false&&!this.trigger("remove",X)){bm.push(bk);
}}return bm;
},undo:function(){this.undoRedoService.undo();
},redo:function(){this.undoRedoService.redo();
},select:function(bk,bm){if(ao(bk)){bm=A({addToSelection:false},bm);
var X=bm.addToSelection,bl=[],bn=[],bj,Y;
if(!X){this.deselect();
}this._internalSelection=true;
if(bk instanceof Array){bl=bk;
}else{if(bk instanceof Q){bl=[bk];
}}for(bj=0;
bj<bl.length;
bj++){Y=bl[bj];
if(Y.select(true)){bn.push(Y);
}}this._selectionChanged(bn,[]);
this._internalSelection=false;
}else{return this._selectedItems;
}},selectAll:function(){this.select(this.shapes.concat(this.connections));
},selectArea:function(bk){var X,bj,Y;
this._internalSelection=true;
var bl=[];
if(bk instanceof aS){bj=this.shapes.concat(this.connections);
for(X=0;
X<bj.length;
X++){Y=bj[X];
if((!bk||Y._hitTest(bk))&&Y.options.enable){if(Y.select(true)){bl.push(Y);
}}}}this._selectionChanged(bl,[]);
this._internalSelection=false;
},deselect:function(bk){this._internalSelection=true;
var X=[],bl=[],Y,bj;
if(bk instanceof Array){bl=bk;
}else{if(bk instanceof Q){bl.push(bk);
}else{if(!ao(bk)){bl=this._selectedItems.slice(0);
}}}for(bj=0;
bj<bl.length;
bj++){Y=bl[bj];
if(Y.select(false)){X.push(Y);
}}this._selectionChanged([],X);
this._internalSelection=false;
},toFront:function(Y,bk){if(!Y){Y=this._selectedItems.slice();
}var bj=this._getDiagramItems(Y),X;
if(!L(bk)||bk){X=ak(this.mainLayer,bj.visuals);
var bl=new a4(this,Y,X);
this.undoRedoService.add(bl);
}else{this.mainLayer.toFront(bj.visuals);
this._fixOrdering(bj,true);
}},toBack:function(Y,bk){if(!Y){Y=this._selectedItems.slice();
}var bj=this._getDiagramItems(Y),X;
if(!L(bk)||bk){X=ak(this.mainLayer,bj.visuals);
var bl=new a3(this,Y,X);
this.undoRedoService.add(bl);
}else{this.mainLayer.toBack(bj.visuals);
this._fixOrdering(bj,false);
}},bringIntoView:function(bj,bl){var bo=this.viewport();
var X=new O.RectAlign(bo);
var Y,bn,bm,bk;
if(bo.width===0||bo.height===0){return;
}bl=A({animate:false,align:"center middle"},bl);
if(bl.align=="none"){bl.align="center middle";
}if(bj instanceof Q){bn=bj.bounds(a7);
}else{if(am(bj)){bn=this.boundingBox(bj);
}else{if(bj instanceof aS){bn=bj.clone();
}}}bm=bn.clone();
bn.zoom(this._zoom);
if(bn.width>bo.width||bn.height>bo.height){this._zoom=this._getValidZoom(ax.min(bo.width/bm.width,bo.height/bm.height));
bn=bm.clone().zoom(this._zoom);
}this._zoomMainLayer();
Y=bn.clone();
X.align(bn,bl.align);
bk=bn.topLeft().minus(Y.topLeft());
this.pan(bk.times(-1),bl.animate);
},alignShapes:function(X){if(at(X)){X="Left";
}var bk=this.select(),bo,bj,Y;
if(bk.length===0){return;
}switch(X.toLowerCase()){case"left":case"top":bo=ay;
break;
case"right":case"bottom":bo=aA;
break;
}for(Y=0;
Y<bk.length;
Y++){bj=bk[Y];
if(bj instanceof aZ){switch(X.toLowerCase()){case"left":bo=ax.min(bo,bj.options.x);
break;
case"top":bo=ax.min(bo,bj.options.y);
break;
case"right":bo=ax.max(bo,bj.options.x);
break;
case"bottom":bo=ax.max(bo,bj.options.y);
break;
}}}var bm=[];
var bl=[];
for(Y=0;
Y<bk.length;
Y++){bj=bk[Y];
if(bj instanceof aZ){bl.push(bj);
bm.push(bj.bounds());
switch(X.toLowerCase()){case"left":case"right":bj.position(new aM(bo,bj.options.y));
break;
case"top":case"bottom":bj.position(new aM(bj.options.x,bo));
break;
}}}var bn=new O.TransformUnit(bl,bm);
this.undoRedoService.add(bn,false);
},zoom:function(bl,X){if(bl){var bj=X?X.point:new O.Point(0,0);
bl=this._zoom=this._getValidZoom(bl);
if(!at(bj)){bj=new O.Point(ax.round(bj.x),ax.round(bj.y));
var bm=bj.times(bl);
var bk=this.modelToView(bj);
var Y=bk.minus(bm);
this._storePan(new O.Point(ax.round(Y.x),ax.round(Y.y)));
}if(X){X.zoom=bl;
}this._panTransform();
this._updateAdorners();
}return this._zoom;
},_getPan:function(Y){var X=this.canvas;
if(!X.translate){Y=Y.plus(this._pan);
}return Y;
},pan:function(Y,X){if(Y instanceof aM){var bk=this;
var bj=bk.scroller;
Y=bk._getPan(Y);
Y=Y.times(-1);
if(X){bj.animatedScrollTo(Y.x,Y.y,function(){bk._updateAdorners();
});
}else{bj.scrollTo(Y.x,Y.y);
bk._updateAdorners();
}}},viewport:function(){var X=this.element;
var bj=X.width();
var Y=X.height();
if(this.toolBar){Y-=this.toolBar.element.outerHeight();
}return new aS(0,0,bj,Y);
},copy:function(){if(this.options.copy.enabled){this._clipboard=[];
this._copyOffset=1;
for(var X=0;
X<this._selectedItems.length;
X++){var Y=this._selectedItems[X];
this._clipboard.push(Y);
}}},cut:function(){if(this.options.copy.enabled){this._clipboard=[];
this._copyOffset=0;
for(var X=0;
X<this._selectedItems.length;
X++){var Y=this._selectedItems[X];
this._clipboard.push(Y);
}this.remove(this._clipboard,true);
}},paste:function(){if(this._clipboard.length>0){var bl,Y,bk;
var bm={};
var bj=a1(this._clipboard);
var X=bj.connections;
var bo=bj.shapes;
var bn={x:this._copyOffset*this.options.copy.offsetX,y:this._copyOffset*this.options.copy.offsetY};
this.deselect();
for(bk=0;
bk<bo.length;
bk++){bl=bo[bk];
Y=bl.clone();
bm[bl.id]=Y;
Y.position(new aM(bl.options.x+bn.x,bl.options.y+bn.y));
Y.diagram=this;
Y=this._addShape(Y);
if(Y){Y.select();
}}for(bk=0;
bk<X.length;
bk++){bl=X[bk];
Y=this._addConnection(bl.clone());
if(Y){this._updateCopiedConnection(Y,bl,"source",bm,bn);
this._updateCopiedConnection(Y,bl,"target",bm,bn);
Y.select(true);
Y.updateModel();
}}this._syncChanges();
this._copyOffset+=1;
}},_updateCopiedConnection:function(X,bo,Y,bl,bm){var bn,bk,bq;
var bp=bo[Y]();
var bj=this;
if(bp instanceof u&&bl[bp.shape.id]){bq=bl[bp.shape.id];
if(bj.getShapeById(bq.id)){X[Y](bq.getConnector(bp.options.name));
}else{bk=bj._inactiveShapeItems.getByUid(bq.dataItem.uid);
if(bk){bn=function(br){bq=bj._dataMap[br.id];
X[Y](bq.getConnector(bp.options.name));
X.updateModel();
};
bj._deferredConnectionUpdates.push(bk.onActivate(bn));
}}}else{X[Y](new aM(bo[Y+"Point"]().x+bm.x,bo[Y+"Point"]().y+bm.y));
}},boundingBox:function(bk,bl){var bm=aS.empty(),bn,X=ao(bk)?this._getDiagramItems(bk):{shapes:this.shapes};
if(X.shapes.length>0){var bj=X.shapes[0];
bm=bj.bounds(aW);
for(var Y=1;
Y<X.shapes.length;
Y++){bj=X.shapes[Y];
bn=bj.bounds(aW);
if(bl===true){bn.x-=bj._rotationOffset.x;
bn.y-=bj._rotationOffset.y;
}bm=bm.union(bn);
}}return bm;
},_containerOffset:function(){var X=this.element.offset();
if(this.toolBar){X.top+=this.toolBar.element.outerHeight();
}return X;
},documentToView:function(Y){var X=this._containerOffset();
return new aM(Y.x-X.left,Y.y-X.top);
},viewToDocument:function(Y){var X=this._containerOffset();
return new aM(Y.x+X.left,Y.y+X.top);
},viewToModel:function(X){return this._transformWithMatrix(X,this._matrixInvert);
},modelToView:function(X){return this._transformWithMatrix(X,this._matrix);
},modelToLayer:function(X){return this._transformWithMatrix(X,this._layerMatrix);
},layerToModel:function(X){return this._transformWithMatrix(X,this._layerMatrixInvert);
},documentToModel:function(X){var Y=this.documentToView(X);
if(!this.canvas.translate){Y.x=Y.x+this.scroller.scrollLeft;
Y.y=Y.y+this.scroller.scrollTop;
}return this.viewToModel(Y);
},modelToDocument:function(X){return this.viewToDocument(this.modelToView(X));
},_transformWithMatrix:function(bj,Y){var bk=bj;
if(bj instanceof aM){if(Y){bk=Y.apply(bj);
}}else{var bl=this._transformWithMatrix(bj.topLeft(),Y),X=this._transformWithMatrix(bj.bottomRight(),Y);
bk=aS.fromPoints(bl,X);
}return bk;
},setDataSource:function(X){this.options.dataSource=X;
this._dataSource();
if(this.options.autoBind){this.dataSource.fetch();
}},setConnectionsDataSource:function(X){this.options.connectionsDataSource=X;
this._connectionDataSource();
if(this.options.autoBind){this.connectionsDataSource.fetch();
}},layout:function(bk){this.isLayouting=true;
var bl;
if(at(bk)){bk=this.options.layout;
}if(at(bk)||at(bk.type)){bl="Tree";
}else{bl=bk.type;
}var bj;
switch(bl.toLowerCase()){case"tree":bj=new O.TreeLayout(this);
break;
case"layered":bj=new O.LayeredLayout(this);
break;
case"forcedirected":case"force":case"spring":case"springembedder":bj=new O.SpringLayout(this);
break;
default:throw"Layout algorithm '"+bl+"' is not supported.";
}var Y=new O.LayoutState(this);
var X=bj.layout(bk);
if(X){var bm=new O.LayoutUndoUnit(Y,X,bk?bk.animate:null);
this.undoRedoService.add(bm);
}this.isLayouting=false;
},getShapeById:function(Y){var X;
X=bc.first(this.shapes,function(bj){return bj.visual.id===Y;
});
if(X){return X;
}X=bc.first(this.connections,function(bj){return bj.visual.id===Y;
});
return X;
},_extendLayoutOptions:function(X){if(X.layout){X.layout=A(O.LayoutBase.fn.defaultOptions||{},X.layout);
}},_selectionChanged:function(Y,X){if(Y.length||X.length){this.trigger(aX,{selected:Y,deselected:X});
}},_getValidZoom:function(X){return ax.min(ax.max(X,this.options.zoomMin),this.options.zoomMax);
},_panTransform:function(bj){var X=this,Y=bj||X._pan;
if(X.canvas.translate){X.scroller.scrollTo(Y.x,Y.y);
X._zoomMainLayer();
}else{X._storePan(Y);
X._transformMainLayer();
}},_finishPan:function(){this.trigger(aK,{total:this._pan,delta:Number.NaN});
},_storePan:function(X){this._pan=X;
this._storeViewMatrix();
},_zoomMainLayer:function(){var Y=this._zoom;
var X=new p(0,0,Y,Y);
X.render(this.mainLayer);
this._storeLayerMatrix(X);
this._storeViewMatrix();
},_transformMainLayer:function(){var X=this._pan,bj=this._zoom;
var Y=new p(X.x,X.y,bj,bj);
Y.render(this.mainLayer);
this._storeLayerMatrix(Y);
this._storeViewMatrix();
},_storeLayerMatrix:function(X){this._layerMatrix=X.toMatrix();
this._layerMatrixInvert=X.invert().toMatrix();
},_storeViewMatrix:function(){var X=this._pan,bj=this._zoom;
var Y=new p(X.x,X.y,bj,bj);
this._matrix=Y.toMatrix();
this._matrixInvert=Y.invert().toMatrix();
},_toIndex:function(Y,X){var bj=this._getDiagramItems(Y);
this.mainLayer.toIndex(bj.visuals,X);
this._fixOrdering(bj,false);
},_fixOrdering:function(bk,bm){var bl=bm?this.shapes.length-1:0,X=bm?this.connections.length-1:0,Y,bj;
for(Y=0;
Y<bk.shapes.length;
Y++){bj=bk.shapes[Y];
bc.remove(this.shapes,bj);
bc.insert(this.shapes,bj,bl);
}for(Y=0;
Y<bk.cons.length;
Y++){bj=bk.cons[Y];
bc.remove(this.connections,bj);
bc.insert(this.connections,bj,X);
}},_getDiagramItems:function(bk){var Y,bl={},X=bk;
bl.visuals=[];
bl.shapes=[];
bl.cons=[];
if(!bk){X=this._selectedItems.slice();
}else{if(!am(bk)){X=[bk];
}}for(Y=0;
Y<X.length;
Y++){var bj=X[Y];
if(bj instanceof aZ){bl.shapes.push(bj);
bl.visuals.push(bj.visual);
}else{if(bj instanceof q){bl.cons.push(bj);
bl.visuals.push(bj.visual);
}}}return bl;
},_removeItem:function(X,bj,Y){X.select(false);
if(X instanceof aZ){this._removeShapeDataItem(X);
this._removeShape(X,bj,Y);
}else{if(X instanceof q){this._removeConnectionDataItem(X);
this._removeConnection(X,bj);
}}this.mainLayer.remove(X.visual);
},_removeShape:function(bm,bp,bl){var bj,X,Y,bn=[],bo=[];
this.toolService._removeHover();
if(bp){this.undoRedoService.addCompositeItem(new N(bm));
}bc.remove(this.shapes,bm);
this._shapesQuadTree.remove(bm);
for(bj=0;
bj<bm.connectors.length;
bj++){Y=bm.connectors[bj];
for(var bk=0;
bk<Y.connections.length;
bk++){X=Y.connections[bk];
if(!bl||!z.inArray(X,bl)){if(X.sourceConnector==Y){bn.push(X);
}else{if(X.targetConnector==Y){bo.push(X);
}}}}}for(bj=0;
bj<bn.length;
bj++){bn[bj].source(null,bp);
bn[bj].updateModel();
}for(bj=0;
bj<bo.length;
bj++){bo[bj].target(null,bp);
bo[bj].updateModel();
}},_removeConnection:function(X,Y){if(X.sourceConnector){bc.remove(X.sourceConnector.connections,X);
}if(X.targetConnector){bc.remove(X.targetConnector.connections,X);
}if(Y){this.undoRedoService.addCompositeItem(new M(X));
}bc.remove(this.connections,X);
},_removeDataItems:function(bk,bl){var bj,X,bm,Y;
bk=am(bk)?bk:[bk];
while(bk.length){bj=bk.shift();
bm=this._dataMap[bj.uid];
if(bm){this._removeShapeConnections(bm);
this._removeItem(bm,false);
delete this._dataMap[bj.uid];
if(bl&&bj.hasChildren&&bj.loaded()){X=bj.children.data();
for(Y=0;
Y<X.length;
Y++){bk.push(X[Y]);
}}}}},_removeShapeConnections:function(bj){var X=bj.connections();
var Y;
if(X){for(Y=0;
Y<X.length;
Y++){this._removeItem(X[Y],false);
}}},_addDataItem:function(X,bk){if(!L(X)){return;
}var bj=this._dataMap[X.id];
if(bj){return bj;
}var Y=A({},this.options.shapeDefaults);
Y.dataItem=X;
bj=new aZ(Y,this);
this.addShape(bj,{undoable:bk!==false});
this._dataMap[X.id]=bj;
return bj;
},_addDataItemByUid:function(X){if(!L(X)){return;
}var bj=this._dataMap[X.uid];
if(bj){return bj;
}var Y=A({},this.options.shapeDefaults);
Y.dataItem=X;
bj=new aZ(Y,this);
this.addShape(bj);
this._dataMap[X.uid]=bj;
return bj;
},_addDataItems:function(bk,bl){var bj,Y,bn,bm,X;
for(Y=0;
Y<bk.length;
Y++){bj=bk[Y];
bn=this._addDataItemByUid(bj);
bm=this._addDataItemByUid(bl);
if(bm&&!this.connected(bm,bn)){X=this.connect(bm,bn);
}}},_refreshSource:function(Y){var bn=this,bl=Y.node,X=Y.action,bk=Y.items,bm=bn.options,bj;
if(Y.field){return;
}if(X=="remove"){this._removeDataItems(Y.items,true);
}else{var bo;
if((!X||X==="itemloaded")&&!this._bindingRoots){this._bindingRoots=true;
bo=true;
}if(!X&&!bl){bn.clear();
}this._addDataItems(bk,bl);
for(bj=0;
bj<bk.length;
bj++){bk[bj].load();
}if(bo){this.trigger("dataBound");
this._bindingRoots=false;
}}if(bm.layout){bn.layout(bm.layout);
}},_mouseDown:function(X){var Y=this._calculatePosition(X);
if(X.which==1&&this.toolService.start(Y,this._meta(X))){this._destroyToolBar();
X.preventDefault();
}},_addItem:function(X){if(X instanceof aZ){this.addShape(X);
}else{if(X instanceof q){this.addConnection(X);
}}},_mouseUp:function(X){var Y=this._calculatePosition(X);
if(X.which==1&&this.toolService.end(Y,this._meta(X))){this._createToolBar();
X.preventDefault();
}},_createToolBar:function(){var Y=this.toolService.diagram;
if(!this.singleToolBar&&Y.select().length===1){var bk=Y.select()[0];
if(bk&&bk.options.editable!==false){var bj=bk.options.editable;
var bq=bj.tools;
if(this._isEditable&&bq.length===0){if(bk instanceof aZ){bq=["edit","rotateClockwise","rotateAnticlockwise"];
}else{if(bk instanceof q){bq=["edit"];
}}if(bj&&bj.remove!==false){bq.push("delete");
}}if(bq&&bq.length){var bl=20;
var bm;
this.singleToolBar=new R(Y,{tools:bq,click:aP(this._toolBarClick,this),modal:true});
var bo=this.singleToolBar._popup.element.outerWidth();
var bn=this.singleToolBar._popup.element.outerHeight();
if(bk instanceof aZ){var bp=this.modelToView(bk.bounds(aW));
bm=aM(bp.x,bp.y).minus(aM((bo-bp.width)/2,bn+bl));
}else{if(bk instanceof q){var X=this.modelToView(bk.bounds());
bm=aM(X.x,X.y).minus(aM((bo-X.width-20)/2,bn+bl));
}}if(bm){if(!this.canvas.translate){bm=bm.minus(aM(this.scroller.scrollLeft,this.scroller.scrollTop));
}bm=this.viewToDocument(bm);
bm=aM(ax.max(bm.x,0),ax.max(bm.y,0));
this.singleToolBar.showAt(bm);
}else{this._destroyToolBar();
}}}}},_toolBarClick:function(X){this.trigger("toolBarClick",X);
this._destroyToolBar();
},_mouseMove:function(X){if(this.pauseMouseHandlers){return;
}var Y=this._calculatePosition(X);
if((X.which===0||X.which==1)&&this.toolService.move(Y,this._meta(X))){X.preventDefault();
}},_keydown:function(X){if(this.toolService.keyDown(X.keyCode,this._meta(X))){X.preventDefault();
}},_wheel:function(Y){var X=aG(Y),bk=this._calculatePosition(Y),bj=A(this._meta(Y),{delta:X});
if(this.toolService.wheel(bk,bj)){Y.preventDefault();
}},_meta:function(X){return{ctrlKey:X.ctrlKey,metaKey:X.metaKey,altKey:X.altKey,shiftKey:X.shiftKey};
},_calculatePosition:function(X){var bk=(X.pageX===ba?X.originalEvent:X),bj=new aM(bk.pageX,bk.pageY),Y=this.documentToModel(bj);
return Y;
},_normalizePointZoom:function(X){return X.times(1/this.zoom());
},_initialize:function(){this.shapes=[];
this._selectedItems=[];
this.connections=[];
this._dataMap={};
this._connectionsDataMap={};
this._inactiveShapeItems=new aj();
this._deferredConnectionUpdates=[];
this.undoRedoService=new bb({undone:this._syncHandler,redone:this._syncHandler});
this.id=O.randomId();
},_fetchFreshData:function(){var X=this;
X._dataSource();
if(X._isEditable){X._connectionDataSource();
}if(X.options.autoBind){if(X._isEditable){this._loadingShapes=true;
this._loadingConnections=true;
X.dataSource.fetch();
X.connectionsDataSource.fetch();
}else{X.dataSource.fetch();
}}},_dataSource:function(){if(L(this.options.connectionsDataSource)){this._isEditable=true;
var Y=this.options.dataSource||{};
var X=am(Y)?{data:Y}:Y;
if(this.dataSource&&this._shapesRefreshHandler){this.dataSource.unbind("change",this._shapesRefreshHandler).unbind("requestStart",this._shapesRequestStartHandler).unbind("error",this._shapesErrorHandler);
}else{this._shapesRefreshHandler=aP(this._refreshShapes,this);
this._shapesRequestStartHandler=aP(this._shapesRequestStart,this);
this._shapesErrorHandler=aP(this._error,this);
}this.dataSource=kendo.data.DataSource.create(X).bind("change",this._shapesRefreshHandler).bind("requestStart",this._shapesRequestStartHandler).bind("error",this._shapesErrorHandler);
}else{this._treeDataSource();
this._isEditable=false;
}},_connectionDataSource:function(){var Y=this.options.connectionsDataSource;
if(Y){var X=am(Y)?{data:Y}:Y;
if(this.connectionsDataSource&&this._connectionsRefreshHandler){this.connectionsDataSource.unbind("change",this._connectionsRefreshHandler).unbind("requestStart",this._connectionsRequestStartHandler).unbind("error",this._connectionsErrorHandler);
}else{this._connectionsRefreshHandler=aP(this._refreshConnections,this);
this._connectionsRequestStartHandler=aP(this._connectionsRequestStart,this);
this._connectionsErrorHandler=aP(this._connectionsError,this);
}this.connectionsDataSource=kendo.data.DataSource.create(X).bind("change",this._connectionsRefreshHandler).bind("requestStart",this._connectionsRequestStartHandler).bind("error",this._connectionsErrorHandler);
}},_shapesRequestStart:function(X){if(X.type=="read"){this._loadingShapes=true;
}},_connectionsRequestStart:function(X){if(X.type=="read"){this._loadingConnections=true;
}},_error:function(){this._loadingShapes=false;
},_connectionsError:function(){this._loadingConnections=false;
},_refreshShapes:function(X){if(X.action==="remove"){if(this._shouldRefresh()){this._removeShapes(X.items);
}}else{if(X.action==="itemchange"){if(this._shouldRefresh()){this._updateShapes(X.items,X.field);
}}else{if(X.action==="add"){this._inactiveShapeItems.add(X.items);
}else{if(X.action==="sync"){this._syncShapes(X.items);
}else{this.refresh();
}}}}},_shouldRefresh:function(){return !this._suspended;
},_suspendModelRefresh:function(){this._suspended=(this._suspended||0)+1;
},_resumeModelRefresh:function(){this._suspended=ax.max((this._suspended||0)-1,0);
},refresh:function(){this._loadingShapes=false;
if(!this._loadingConnections){this._rebindShapesAndConnections();
}},_rebindShapesAndConnections:function(){this.clear();
this._addShapes(this.dataSource.view());
if(this.connectionsDataSource){this._addConnections(this.connectionsDataSource.view(),false);
}if(this.options.layout){this.layout(this.options.layout);
}this._redrawConnections();
this.trigger("dataBound");
},refreshConnections:function(){this._loadingConnections=false;
if(!this._loadingShapes){this._rebindShapesAndConnections();
}},_redrawConnections:function(){var X=this.connections;
for(var Y=0;
Y<X.length;
Y++){X[Y].refresh();
}},_removeShapes:function(bk){var X=this._dataMap;
var bj,Y;
for(Y=0;
Y<bk.length;
Y++){bj=bk[Y];
if(X[bj.id]){this.remove(X[bj.id],false);
X[bj.id]=null;
}}},_syncShapes:function(){var X=this;
var Y=X._inactiveShapeItems;
Y.forEach(function(bk){var bj=bk.dataItem;
var bl=bk.element;
if(!bj.isNew()){if(bl){bl._setOptionsFromModel();
X.addShape(bl,{undoable:bk.undoable});
X._dataMap[bj.id]=bl;
}else{X._addDataItem(bj);
}bk.activate();
Y.remove(bj);
}});
},_updateShapes:function(bk,Y){for(var bj=0;
bj<bk.length;
bj++){var X=bk[bj];
var bl=this._dataMap[X.id];
if(bl){bl.updateOptionsFromModel(X,Y);
}}},_addShapes:function(X){for(var Y=0;
Y<X.length;
Y++){this._addDataItem(X[Y],false);
}},_refreshConnections:function(X){if(X.action==="remove"){if(this._shouldRefresh()){this._removeConnections(X.items);
}}else{if(X.action==="add"){this._addConnections(X.items);
}else{if(X.action==="sync"){}else{if(X.action==="itemchange"){if(this._shouldRefresh()){this._updateConnections(X.items);
}}else{this.refreshConnections();
}}}}},_removeConnections:function(Y){for(var X=0;
X<Y.length;
X++){this.remove(this._connectionsDataMap[Y[X].uid],false);
this._connectionsDataMap[Y[X].uid]=null;
}},_updateConnections:function(bk){for(var bj=0;
bj<bk.length;
bj++){var Y=bk[bj];
var X=this._connectionsDataMap[Y.uid];
X.updateOptionsFromModel(Y);
}},_addConnections:function(X,bl){var bk=X.length;
for(var bj=0;
bj<bk;
bj++){var Y=X[bj];
this._addConnectionDataItem(Y,bl);
}},_addConnectionDataItem:function(Y,bm){if(!this._connectionsDataMap[Y.uid]){var bj=this._validateConnector(Y.from);
if(!L(bj)||bj===null){bj=new aM(Y.fromX,Y.fromY);
}var bl=this._validateConnector(Y.to);
if(!L(bl)||bl===null){bl=new aM(Y.toX,Y.toY);
}if(L(bj)&&L(bl)){var bk=A({},this.options.connectionDefaults);
bk.dataItem=Y;
var X=new q(bj,bl,bk);
this._connectionsDataMap[Y.uid]=X;
this.addConnection(X,bm);
}}},_validateConnector:function(Y){var X;
if(L(Y)&&Y!==null){X=this._dataMap[Y];
}return X;
},_treeDataSource:function(){var bj=this,Y=bj.options,X=Y.dataSource;
X=am(X)?{data:X}:X;
if(!X.fields){X.fields=[{field:"text"},{field:"url"},{field:"spriteCssClass"},{field:"imageUrl"}];
}if(bj.dataSource&&bj._refreshHandler){bj._unbindDataSource();
}bj._refreshHandler=aP(bj._refreshSource,bj);
bj._errorHandler=aP(bj._error,bj);
bj.dataSource=ag.create(X).bind(i,bj._refreshHandler).bind(Z,bj._errorHandler);
},_unbindDataSource:function(){var X=this;
X.dataSource.unbind(i,X._refreshHandler).unbind(Z,X._errorHandler);
},_adorn:function(X,Y){if(Y!==ba&&X){if(Y){this._adorners.push(X);
this.adornerLayer.append(X.visual);
}else{bc.remove(this._adorners,X);
this.adornerLayer.remove(X.visual);
}}},_showConnectors:function(X,Y){if(Y){this._connectorsAdorner.show(X);
}else{this._connectorsAdorner.destroy();
}},_updateAdorners:function(){var Y=this._adorners;
for(var bj=0;
bj<Y.length;
bj++){var X=Y[bj];
if(X.refreshBounds){X.refreshBounds();
}X.refresh();
}},_refresh:function(){for(var X=0;
X<this.connections.length;
X++){this.connections[X].refresh();
}},_destroyToolBar:function(){if(this.singleToolBar){this.singleToolBar.hide();
this.singleToolBar.destroy();
this.singleToolBar=null;
}},_destroyGlobalToolBar:function(){if(this.toolBar){this.toolBar.hide();
this.toolBar.destroy();
this.toolBar=null;
}},exportDOMVisual:function(){var bl=this.canvas._viewBox;
var bk=ad.transform().translate(-bl.x,-bl.y);
var bm=new ad.Rect([0,0],[bl.width,bl.height]);
var X=V.Path.fromRect(bm);
var bn=new V.Group({transform:bk});
var Y=new V.Group({clip:X});
var bj=this.canvas.drawingElement.children[0];
Y.append(bn);
bn.children.push(bj);
return Y;
},exportVisual:function(){var Y=ad.transform().scale(1/this._zoom);
var bj=new V.Group({transform:Y});
var X=this.mainLayer.drawingElement;
bj.children.push(X);
return bj;
},_syncChanges:function(){this._syncShapeChanges();
this._syncConnectionChanges();
},_syncShapeChanges:function(){if(this.dataSource&&this._isEditable){this.dataSource.sync();
}},_syncConnectionChanges:function(){var X=this;
if(X.connectionsDataSource&&X._isEditable){a.when.apply(a,X._deferredConnectionUpdates).then(function(){X.connectionsDataSource.sync();
});
X.deferredConnectionUpdates=[];
}}});
z.ExportMixin.extend(P.fn,true);
if(kendo.PDFMixin){kendo.PDFMixin.extend(P.fn);
}function ac(X){var Y={};
X=X||{};
if(L(X.text)&&X.text!==null){Y.text=X.text;
}if(L(X.x)&&X.x!==null){Y.x=X.x;
}if(L(X.y)&&X.y!==null){Y.y=X.y;
}if(L(X.width)&&X.width!==null){Y.width=X.width;
}if(L(X.height)&&X.height!==null){Y.height=X.height;
}if(L(X.type)&&X.type!==null){Y.type=X.type;
}return Y;
}function ab(X){var Y={};
X=X||{};
if(L(X.text)&&X.text!==null){Y.content=X.text;
}if(L(X.type)&&X.type!==null){Y.type=X.type;
}if(L(X.from)&&X.from!==null){Y.from=X.from;
}if(L(X.fromConnector)&&X.fromConnector!==null){Y.fromConnector=X.fromConnector;
}if(L(X.fromX)&&X.fromX!==null){Y.fromX=X.fromX;
}if(L(X.fromY)&&X.fromY!==null){Y.fromY=X.fromY;
}if(L(X.to)&&X.to!==null){Y.to=X.to;
}if(L(X.toConnector)&&X.toConnector!==null){Y.toConnector=X.toConnector;
}if(L(X.toX)&&X.toX!==null){Y.toX=X.toX;
}if(L(X.toY)&&X.toY!==null){Y.toY=X.toY;
}return Y;
}var R=kendo.Observable.extend({init:function(X,Y){kendo.Observable.fn.init.call(this);
this.diagram=X;
this.options=A({},this.options,Y);
this._tools=[];
this.createToolBar();
this.createTools();
this.appendTools();
if(this.options.modal){this.createPopup();
}this.bind(this.events,Y);
},events:["click"],createPopup:function(){this.container=a("<div/>").append(this.element);
this._popup=this.container.kendoPopup({}).getKendoPopup();
},appendTools:function(){for(var X=0;
X<this._tools.length;
X++){var Y=this._tools[X];
if(Y.buttons&&Y.buttons.length||!L(Y.buttons)){this._toolBar.add(Y);
}}},createToolBar:function(){this.element=a("<div/>");
this._toolBar=this.element.kendoToolBar({click:aP(this.click,this),resizable:false}).getKendoToolBar();
this.element.css("border","none");
},createTools:function(){for(var X=0;
X<this.options.tools.length;
X++){this.createTool(this.options.tools[X]);
}},createTool:function(X){var Y=(aq(X)?X.name:X)+"Tool";
if(this[Y]){this[Y](X);
}else{this._tools.push(X);
}},showAt:function(X){if(this._popup){this._popup.open(X.x,X.y);
}},hide:function(){if(this._popup){this._popup.close();
}},newGroup:function(){return{type:"buttonGroup",buttons:[]};
},editTool:function(){this._tools.push({spriteCssClass:"k-icon k-i-pencil",showText:"overflow",type:"button",text:"Edit",attributes:this._setAttributes({action:"edit"})});
},deleteTool:function(){this._tools.push({spriteCssClass:"k-icon k-i-close",showText:"overflow",type:"button",text:"Delete",attributes:this._setAttributes({action:"delete"})});
},rotateAnticlockwiseTool:function(X){this._appendGroup("rotate");
this._rotateGroup.buttons.push({spriteCssClass:"k-icon k-i-rotateccw",showText:"overflow",text:"RotateAnticlockwise",group:"rotate",attributes:this._setAttributes({action:"rotateAnticlockwise",step:X.step})});
},rotateClockwiseTool:function(X){this._appendGroup("rotate");
this._rotateGroup.buttons.push({spriteCssClass:"k-icon k-i-rotatecw",attributes:this._setAttributes({action:"rotateClockwise",step:X.step}),showText:"overflow",text:"RotateClockwise",group:"rotate"});
},createShapeTool:function(){this._appendGroup("create");
this._createGroup.buttons.push({spriteCssClass:"k-icon k-i-shape",showText:"overflow",text:"CreateShape",group:"create",attributes:this._setAttributes({action:"createShape"})});
},createConnectionTool:function(){this._appendGroup("create");
this._createGroup.buttons.push({spriteCssClass:"k-icon k-i-connector",showText:"overflow",text:"CreateConnection",group:"create",attributes:this._setAttributes({action:"createConnection"})});
},undoTool:function(){this._appendGroup("history");
this._historyGroup.buttons.push({spriteCssClass:"k-icon k-i-undo",showText:"overflow",text:"Undo",group:"history",attributes:this._setAttributes({action:"undo"})});
},redoTool:function(){this._appendGroup("history");
this._historyGroup.buttons.push({spriteCssClass:"k-icon k-i-redo",showText:"overflow",text:"Redo",group:"history",attributes:this._setAttributes({action:"redo"})});
},_appendGroup:function(X){var Y="_"+X+"Group";
if(!this[Y]){this[Y]=this.newGroup();
this._tools.push(this[Y]);
}},_setAttributes:function(Y){var X={};
if(Y.action){X[kendo.attr("action")]=Y.action;
}if(Y.step){X[kendo.attr("step")]=Y.step;
}return X;
},_getAttributes:function(bj){var Y={};
var X=bj.attr(kendo.attr("action"));
if(X){Y.action=X;
}var bk=bj.attr(kendo.attr("step"));
if(bk){Y.step=bk;
}return Y;
},click:function(bj){var Y=this._getAttributes(a(bj.target));
var X=Y.action;
if(X){this[X](Y);
}this.trigger("click",this.eventData(X));
},eventData:function(X){var bj=this.selectedElements(),bk=[],Y=[];
if(bj instanceof aZ){bk.push(bj);
}else{Y.push(bj);
}return{shapes:bk,connections:Y,action:X};
},"delete":function(){var X=this.diagram;
var Y=X._triggerRemove(this.selectedElements());
if(Y.length){this.diagram.remove(Y,true);
this.diagram._syncChanges();
}},edit:function(){this.diagram.edit(this.selectedElements()[0]);
},rotateClockwise:function(Y){var X=parseFloat(Y.step||90);
this._rotate(X);
},rotateAnticlockwise:function(Y){var X=parseFloat(Y.step||90);
this._rotate(-X);
},_rotate:function(Y){var X=this.diagram._resizingAdorner;
X.angle(X.angle()+Y);
X.rotate();
},selectedElements:function(){return this.diagram.select();
},createShape:function(){this.diagram.createShape();
},createConnection:function(){this.diagram.createConnection();
},undo:function(){this.diagram.undo();
},redo:function(){this.diagram.redo();
},destroy:function(){this.diagram=null;
this.element=null;
this.options=null;
if(this._toolBar){this._toolBar.destroy();
}if(this._popup){this._popup.destroy();
}}});
var W=kendo.Observable.extend({init:function(X,Y){kendo.Observable.fn.init.call(this);
this.options=aa(true,{},this.options,Y);
this.element=X;
this.model=this.options.model;
this.fields=this._getFields();
this._initContainer();
this.createEditable();
},options:{editors:{}},_initContainer:function(){this.wrapper=this.element;
},createEditable:function(){var X=this.options;
this.editable=new kendo.ui.Editable(this.wrapper,{fields:this.fields,target:X.target,clearContainer:false,model:this.model});
},_isEditable:function(X){return this.model.editable&&this.model.editable(X);
},_getFields:function(){var bj=[];
var bk=this.model.fields;
for(var Y in bk){var bl={};
if(this._isEditable(Y)){var X=this.options.editors[Y];
if(X){bl.editor=X;
}bl.field=Y;
bj.push(bl);
}}return bj;
},end:function(){return this.editable.end();
},destroy:function(){this.editable.destroy();
this.editable.element.find("["+kendo.attr("container-for")+"]").empty();
this.model=this.wrapper=this.element=this.columns=this.editable=null;
}});
var aO=W.extend({init:function(X,Y){W.fn.init.call(this,X,Y);
this.bind(this.events,this.options);
this.open();
},events:["update","cancel"],options:{window:{modal:true,resizable:false,draggable:true,title:"Edit",visible:false}},_initContainer:function(){var Y=this;
this.wrapper=a('<div class="k-popup-edit-form"/>').attr(kendo.attr("uid"),this.model.uid);
var X="";
if(this.options.template){X+=this._renderTemplate();
this.fields=[];
}else{X+=this._renderFields();
}X+=this._renderButtons();
this.wrapper.append(a('<div class="k-edit-form-container"/>').append(X));
this.window=new kendo.ui.Window(this.wrapper,this.options.window);
this.window.bind("close",function(bj){if(bj.userTriggered){bj.sender.element.focus();
Y._cancelClick(bj);
}});
this._attachButtonEvents();
},_renderTemplate:function(){var X=this.options.template;
if(typeof X==="string"){X=window.unescape(X);
}X=kendo.template(X)(this.model);
return X;
},_renderFields:function(){var Y="";
for(var bj=0;
bj<this.fields.length;
bj++){var X=this.fields[bj];
Y+='<div class="k-edit-label"><label for="'+X.field+'">'+(X.field||"")+"</label></div>";
if(this._isEditable(X.field)){Y+="<div "+kendo.attr("container-for")+'="'+X.field+'" class="k-edit-field"></div>';
}}return Y;
},_renderButtons:function(){var X='<div class="k-edit-buttons k-state-default">';
X+=this._createButton("update");
X+=this._createButton("cancel");
X+="</div>";
return X;
},_createButton:function(X){return kendo.template(e)(K[X]);
},_attachButtonEvents:function(){this._cancelClickHandler=aP(this._cancelClick,this);
this.window.element.on(m+aI,"a.k-diagram-cancel",this._cancelClickHandler);
this._updateClickHandler=aP(this._updateClick,this);
this.window.element.on(m+aI,"a.k-diagram-update",this._updateClickHandler);
},_updateClick:function(X){X.preventDefault();
this.trigger("update");
},_cancelClick:function(X){X.preventDefault();
this.trigger("cancel");
},open:function(){this.window.center().open();
},close:function(){this.window.bind("deactivate",aP(this.destroy,this)).close();
},destroy:function(){this.window.close().destroy();
this.window.element.off(m+aI,"a.k-diagram-cancel",this._cancelClickHandler);
this.window.element.off(m+aI,"a.k-diagram-update",this._updateClickHandler);
this._cancelClickHandler=null;
this._editUpdateClickHandler=null;
this.window=null;
W.fn.destroy.call(this);
}});
function t(X,bj){var Y=this.dataSource.reader.model;
if(Y){var bk=Y.fn.fields.text?"text":Y.idField;
a("<input name='"+bj.field+"' />").appendTo(X).kendoDropDownList({dataValueField:Y.idField,dataTextField:bk,dataSource:this.dataSource.data().toJSON(),optionLabel:" ",valuePrimitive:true});
}}function ai(X){this.dataItem=X;
this.callbacks=[];
}ai.fn=ai.prototype={onActivate:function(X){var Y=a.Deferred();
this.callbacks.push({callback:X,deferred:Y});
return Y;
},activate:function(){var X=this.callbacks;
var bj;
for(var Y=0;
Y<X.length;
Y++){bj=this.callbacks[Y];
bj.callback(this.dataItem);
bj.deferred.resolve();
}this.callbacks=[];
}};
function aj(){this.items={};
}aj.fn=aj.prototype={add:function(Y){for(var X=0;
X<Y.length;
X++){this.items[Y[X].uid]=new ai(Y[X]);
}},forEach:function(X){for(var Y in this.items){X(this.items[Y]);
}},getByUid:function(X){return this.items[X];
},remove:function(X){delete this.items[X.uid];
}};
var aR=k.extend({init:function(){this.shapes=[];
},_add:function(Y,X){this.shapes.push({bounds:X,shape:Y});
Y._quadNode=this;
},insert:function(Y,X){this._add(Y,X);
},remove:function(bj){var bk=this.shapes;
var Y=bk.length;
for(var X=0;
X<Y;
X++){if(bk[X].shape===bj){bk.splice(X,1);
break;
}}},hitTestRect:function(bj){var bk=this.shapes;
var Y=bk.length;
for(var X=0;
X<Y;
X++){if(this._testRect(bk[X].shape,bj)){return true;
}}},_testRect:function(bj,Y){var X=bj.rotate().angle;
return al.rects(Y,bj.bounds(),-X);
},_overlaps:function(Y,bk){var bj=Y.bottomRight();
var bl=bk.bottomRight();
var X=!(bj.x<bk.x||bj.y<bk.y||bl.x<Y.x||bl.y<Y.y);
return X;
}});
var aQ=aR.extend({init:function(X){aR.fn.init.call(this);
this.children=[];
this.rect=X;
},inBounds:function(bl){var bk=this.rect;
var bj=bk.bottomRight();
var X=bl.bottomRight();
var Y=bk.x<=bl.x&&bk.y<=bl.y&&X.x<=bj.x&&X.y<=bj.y;
return Y;
},overlapsBounds:function(X){return this._overlaps(this.rect,X);
},insert:function(bm,X){var bk=false;
var Y=this.children;
var bl=Y.length;
if(this.inBounds(X)){if(!bl&&this.shapes.length<4){this._add(bm,X);
}else{if(!bl){this._initChildren();
}for(var bj=0;
bj<Y.length;
bj++){if(Y[bj].insert(bm,X)){bk=true;
break;
}}if(!bk){this._add(bm,X);
}}bk=true;
}return bk;
},_initChildren:function(){var bm=this.rect,bj=this.children,bo=this.shapes,X=bm.center(),bl=bm.width/2,bk=bm.height/2,Y,bn;
bj.push(new aQ(new aS(bm.x,bm.y,bl,bk)),new aQ(new aS(X.x,bm.y,bl,bk)),new aQ(new aS(bm.x,X.y,bl,bk)),new aQ(new aS(X.x,X.y,bl,bk)));
for(bn=bo.length-1;
bn>=0;
bn--){for(Y=0;
Y<bj.length;
Y++){if(bj[Y].insert(bo[bn].shape,bo[bn].bounds)){bo.splice(bn,1);
break;
}}}},hitTestRect:function(bl){var bj;
var X=this.children;
var bk=X.length;
var Y=false;
if(this.overlapsBounds(bl)){if(aR.fn.hitTestRect.call(this,bl)){Y=true;
}else{for(bj=0;
bj<bk;
bj++){if(X[bj].hitTestRect(bl)){Y=true;
break;
}}}}return Y;
}});
var a0=k.extend({ROOT_SIZE:1000,init:function(X){X.bind(au,aP(this._boundsChange,this));
X.bind(av,aP(this._boundsChange,this));
this.initRoots();
},initRoots:function(){this.rootMap={};
this.root=new aR();
},clear:function(){this.initRoots();
},_boundsChange:function(X){if(X.item._quadNode){X.item._quadNode.remove(X.item);
this.insert(X.item);
}},insert:function(bk){var X=bk.bounds(aW);
var Y=this.ROOT_SIZE;
var bj=this.getSectors(X);
var bl=bj[0][0];
var bm=bj[1][0];
if(this.inRoot(bj)){this.root.insert(bk,X);
}else{if(!this.rootMap[bl]){this.rootMap[bl]={};
}if(!this.rootMap[bl][bm]){this.rootMap[bl][bm]=new aQ(new aS(bl*Y,bm*Y,Y,Y));
}this.rootMap[bl][bm].insert(bk,X);
}},remove:function(X){if(X._quadNode){X._quadNode.remove(X);
}},inRoot:function(X){return X[0].length>1||X[1].length>1;
},getSectors:function(bk){var bl=this.ROOT_SIZE;
var X=bk.bottomRight();
var Y=ax.floor(X.x/bl);
var bj=ax.floor(X.y/bl);
var bm=[[],[]];
for(var bn=ax.floor(bk.x/bl);
bn<=Y;
bn++){bm[0].push(bn);
}for(var bo=ax.floor(bk.y/bl);
bo<=bj;
bo++){bm[1].push(bo);
}return bm;
},hitTestRect:function(X){var bj=this.getSectors(X);
var bl,bn,bk,bm;
var Y;
if(this.root.hitTestRect(X)){return true;
}for(bl=0;
bl<bj[0].length;
bl++){bk=bj[0][bl];
for(bn=0;
bn<bj[1].length;
bn++){bm=bj[1][bn];
Y=(this.rootMap[bk]||{})[bm];
if(Y&&Y.hitTestRect(X)){return true;
}}}return false;
}});
function n(X){var Y=X;
if(X instanceof kendo.data.Model){Y=X.toJSON();
Y[X.idField]=X._defaultId;
}return Y;
}function a1(bj){var X=[];
var bl=[];
var Y,bk;
for(bk=0;
bk<bj.length;
bk++){Y=bj[bk];
if(Y instanceof aZ){bl.push(Y);
}else{X.push(Y);
}}return{shapes:bl,connections:X};
}function x(X,Y){if(X.reader.model){return new X.reader.model(Y);
}return new kendo.data.ObservableObject(Y);
}function l(X,Y){if(L(Y[X])){Y.set(X,null);
}}function w(bl,X,bj){var Y;
for(var bk=0;
bk<bj.length;
bk++){Y=bj[bk];
if(X&&!L(X[Y])){X[Y]=bl[Y];
}}}z.ui.plugin(P);
A(O,{Shape:aZ,Connection:q,Connector:u,DiagramToolBar:R,QuadNode:aQ,QuadRoot:aR,ShapesQuadTree:a0});
})(window.kendo.jQuery);
})();
(function(){})();
return window.kendo;
},typeof define=="function"&&define.amd?define:function(a,b){b();
});
